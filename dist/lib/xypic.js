!function () { "use strict"; var e = { 401: function (e, t) { MathJax._.components.global.isObject, MathJax._.components.global.combineConfig, t.PV = MathJax._.components.global.combineDefaults, MathJax._.components.global.combineWithMathJax, t.NI = MathJax._.components.global.MathJax }, 771: function (e, t) { t.v = MathJax._.core.MmlTree.MML.MML }, 376: function (e, t) { t.Ls = MathJax._.core.MmlTree.MmlNode.TEXCLASS, MathJax._.core.MmlTree.MmlNode.TEXCLASSNAMES, MathJax._.core.MmlTree.MmlNode.indentAttributes, t.oI = MathJax._.core.MmlTree.MmlNode.AbstractMmlNode, MathJax._.core.MmlTree.MmlNode.AbstractMmlTokenNode, MathJax._.core.MmlTree.MmlNode.AbstractMmlLayoutNode, MathJax._.core.MmlTree.MmlNode.AbstractMmlBaseNode, MathJax._.core.MmlTree.MmlNode.AbstractMmlEmptyNode, MathJax._.core.MmlTree.MmlNode.TextNode, MathJax._.core.MmlTree.MmlNode.XMLNode }, 226: function (e, t) { MathJax._.util.BBox.BBoxStyleAdjust, t.bK = MathJax._.util.BBox.BBox }, 238: function (e, t) { t.VK = MathJax._.input.tex.Configuration.Configuration, MathJax._.input.tex.Configuration.ConfigurationHandler, MathJax._.input.tex.Configuration.ParserConfiguration }, 953: function (e, t) { t.Z = MathJax._.input.tex.ParseMethods.default }, 166: function (e, t) { MathJax._.input.tex.SymbolMap.AbstractSymbolMap, MathJax._.input.tex.SymbolMap.RegExpMap, MathJax._.input.tex.SymbolMap.AbstractParseMap, MathJax._.input.tex.SymbolMap.CharacterMap, MathJax._.input.tex.SymbolMap.DelimiterMap, MathJax._.input.tex.SymbolMap.MacroMap, t.QQ = MathJax._.input.tex.SymbolMap.CommandMap, t.QM = MathJax._.input.tex.SymbolMap.EnvironmentMap }, 847: function (e, t) { t.Z = MathJax._.input.tex.TexError.default }, 789: function (e, t) { t.Z = MathJax._.input.tex.TexParser.default }, 361: function (e, t) { t.Z = MathJax._.input.tex.base.BaseMethods.default }, 81: function (e, t) { MathJax._.output.chtml.Wrapper.FONTSIZE, MathJax._.output.chtml.Wrapper.SPACE, t.wO = MathJax._.output.chtml.Wrapper.CHTMLWrapper }, 748: function (e, t) { t.w = MathJax._.output.chtml.Wrappers_ts.CHTMLWrappers }, 952: function (e, t) { t.y = MathJax._.output.svg.Wrapper.SVGWrapper }, 84: function (e, t) { t.N = MathJax._.output.svg.Wrappers_ts.SVGWrappers } }, t = {}; function n(r) { var i = t[r]; if (void 0 !== i) return i.exports; var a = t[r] = { exports: {} }; return e[r](a, a.exports, n), a.exports } !function () { var e = n(401); (0, e.PV)(e.NI._, "output", { common: { Wrapper: {} }, chtml: { Wrapper: {}, Wrappers_ts: {} }, svg: { Wrapper: {}, Wrappers_ts: {} } }); var t = n(238), r = n(166), i = n(361), a = n(953), o = n(789), u = n(847); function s(e, t) { return console.error(e, t), new u.Z(e, t) } var c = { whiteSpaceRegex: /^(\s+|%[^\r\n]*(\r\n|\r|\n)?)+/, lengthResolution: 128, interpolationResolution: 5, machinePrecision: 1e-12 }; function h(e) { return h = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, h(e) } function l(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function m(e, t, n) { return t && l(e.prototype, t), n && l(e, n), e } function p(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && f(e, t) } function f(e, t) { return f = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, f(e, t) } function d(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = v(e); if (t) { var i = v(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return y(this, n) } } function y(e, t) { if (t && ("object" === h(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function v(e) { return v = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, v(e) } function x(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } var g = function e() { x(this, e) }, w = function (e) { p(n, e); var t = d(n); function n(e) { var r; return x(this, n), (r = t.call(this)).get = e, r } return m(n, [{ key: "isEmpty", get: function () { return !1 } }, { key: "isDefined", get: function () { return !0 } }, { key: "getOrElse", value: function (e) { return this.get } }, { key: "flatMap", value: function (e) { return e(this.get) } }, { key: "map", value: function (e) { return new n(e(this.get)) } }, { key: "foreach", value: function (e) { e(this.get) } }, { key: "toString", value: function () { return "Some(" + this.get + ")" } }], [{ key: "unapply", value: function (e) { return new n(e.get) } }]), n }(g), S = function (e) { p(n, e); var t = d(n); function n() { return x(this, n), t.call(this) } return m(n, [{ key: "isEmpty", get: function () { return !0 } }, { key: "isDefined", get: function () { return !1 } }, { key: "getOrElse", value: function (e) { return e } }, { key: "flatMap", value: function (e) { return this } }, { key: "foreach", value: function (e) { } }, { key: "map", value: function (e) { return this } }, { key: "toString", value: function () { return "None" } }], [{ key: "unapply", value: function (e) { return new w(e) } }]), n }(g); function b(e) { return b = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, b(e) } function C(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function k(e, t, n) { return t && C(e.prototype, t), n && C(e, n), e } function M(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && P(e, t) } function P(e, t) { return P = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, P(e, t) } function B(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = E(e); if (t) { var i = E(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return O(this, n) } } function O(e, t) { if (t && ("object" === b(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function E(e) { return E = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, E(e) } function A(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } g.Some = w, g.None = S, g.empty = new S; var L = function e() { A(this, e) }, j = function (e) { M(n, e); var t = B(n); function n(e, r) { var i; return A(this, n), (i = t.call(this)).head = e, i.tail = r, i } return k(n, [{ key: "isEmpty", get: function () { return !1 } }, { key: "at", value: function (e) { if (e < 0 || e >= this.length()) throw Error("no such element at " + e + ". index must be lower than " + this.length() + "."); for (var t = this, n = 0; n < e; n++)t = t.tail; return t.head } }, { key: "length", value: function () { for (var e = this, t = 0; !e.isEmpty;)t++, e = e.tail; return t } }, { key: "prepend", value: function (e) { return new n(e, this) } }, { key: "append", value: function (e) { var t = new n(e, L.empty); return this.reverse().foreach((function (e) { t = new n(e, t) })), t } }, { key: "concat", value: function (e) { var t = e; return this.reverse().foreach((function (e) { t = new n(e, t) })), t } }, { key: "foldLeft", value: function (e, t) { var n, r; for (n = t(e, this.head), r = this.tail; !r.isEmpty;)n = t(n, r.head), r = r.tail; return n } }, { key: "foldRight", value: function (e, t) { return this.tail.isEmpty ? t(this.head, e) : t(this.head, this.tail.foldRight(e, t)) } }, { key: "map", value: function (e) { return new n(e(this.head), this.tail.map(e)) } }, { key: "flatMap", value: function (e) { return e(this.head).concat(this.tail.flatMap(e)) } }, { key: "foreach", value: function (e) { for (var t = this; !t.isEmpty;)e(t.head), t = t.tail } }, { key: "reverse", value: function () { var e = L.empty; return this.foreach((function (t) { e = new n(t, e) })), e } }, { key: "mkString", value: function () { var e, t, r, i, a; switch (arguments.length) { case 0: e = t = r = ""; break; case 1: t = arguments[0], e = r = ""; break; case 2: e = arguments[0], t = arguments[1], r = ""; break; default: e = arguments[0], t = arguments[1], r = arguments[2] }for (i = e + this.head.toString(), a = this.tail; a instanceof n;)i += t + a.head.toString(), a = a.tail; return i += r } }, { key: "toString", value: function () { return this.mkString("[", ", ", "]") } }], [{ key: "unapply", value: function (e) { return new g.Some([e.head, e.tail]) } }]), n }(L); L.Cons = j; var D = function (e) { M(n, e); var t = B(n); function n() { return A(this, n), t.call(this) } return k(n, [{ key: "isEmpty", get: function () { return !0 } }, { key: "at", value: function (e) { throw new Error("cannot get element from an empty list.") } }, { key: "length", value: function () { return 0 } }, { key: "prepend", value: function (e) { return new j(e, L.empty) } }, { key: "append", value: function (e) { return new j(e, L.empty) } }, { key: "concat", value: function (e) { return e } }, { key: "foldLeft", value: function (e, t) { return e } }, { key: "foldRight", value: function (e, t) { return e } }, { key: "flatMap", value: function (e) { return this } }, { key: "map", value: function (e) { return this } }, { key: "foreach", value: function (e) { } }, { key: "reverse", value: function () { return this } }, { key: "mkString", value: function () { switch (arguments.length) { case 0: case 1: return ""; case 2: return arguments[0]; default: return arguments[0] + arguments[2] } } }, { key: "toString", value: function () { return "[]" } }], [{ key: "unapply", value: function (e) { return new g.Some(e) } }]), n }(L); function T(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } L.Nil = D, L.empty = new D, L.fromArray = function (e) { var t, n; for (t = L.empty, n = e.length - 1; n >= 0;)t = new j(e[n], t), n -= 1; return t }; var R = function () { function e(t, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.head = t, this.tail = n } var t, n, r; return t = e, r = [{ key: "unapply", value: function (e) { return new Option.Some([e.head, e.tail]) } }], (n = [{ key: "toString", value: function () { return "(" + this.head + "~" + this.tail + ")" } }]) && T(t.prototype, n), r && T(t, r), e }(); function F(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function G(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function V(e, t, n) { return t && G(e.prototype, t), n && G(e, n), e } var _ = function () { function e() { F(this, e), this.cases = [] } return V(e, [{ key: "Case", value: function (e, t) { return this.cases.push([e, t]), this } }, { key: "match", value: function (e) { var t, n, r, i; for (t = 0, n = this.cases.length; t < n;) { if (e instanceof (r = this.cases[t][0]) && (i = r.unapply(e)).isDefined) return this.cases[t][1](i.get); t += 1 } throw new I(e) } }]), e }(), I = function () { function e(t) { F(this, e), this.obj = t } return V(e, [{ key: "toString", value: function () { return "MatchError(" + this.obj + ")" } }]), e }(); function z(e) { return z = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, z(e) } function Q(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && W(e, t) } function W(e, t) { return W = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, W(e, t) } function N(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = X(e); if (t) { var i = X(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return U(this, n) } } function U(e, t) { if (t && ("object" === z(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function X(e) { return X = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, X(e) } function H(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function q(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function J(e, t, n) { return t && q(e.prototype, t), n && q(e, n), e } var Z = function () { function e(t, n) { H(this, e), this.source = t, this.offset = void 0 === n ? 0 : n, this._index = null, this._line = null } return J(e, [{ key: "index", value: function () { if (null !== this._index) return this._index; this._index = [], this._index.push(0); for (var e = 0; e < this.source.length;)"\n" === this.source.charAt(e) && this._index.push(e + 1), e += 1; return this._index.push(this.source.length), this._index } }, { key: "line", value: function () { var e, t, n; if (null !== this._line) return this._line; for (e = 0, t = this.index().length - 1; e + 1 < t;)n = t + e >> 1, this.offset < this.index()[n] ? t = n : e = n; return this._line = e + 1, this._line } }, { key: "column", value: function () { return this.offset - this.index()[this.line() - 1] + 1 } }, { key: "lineContents", value: function () { var e, t; return e = this.index(), t = this.line(), this.source.substring(e[t - 1], e[t]) } }, { key: "toString", value: function () { return this.line().toString() + "." + this.column() } }, { key: "longString", value: function () { var e, t; for (e = this.lineContents() + "\n", t = 0; t < this.column();)"\t" === this.lineContents().charAt(t) ? e += "\t" : e += " ", t += 1; return e += "^" } }, { key: "isLessThan", value: function (t) { return t instanceof e ? this.offset < t.offset : this.line() < t.line() || this.line() === t.line() && this.column() < t.column() } }]), e }(), Y = function () { function e(t, n, r) { H(this, e), this.source = t, this.offset = n, this.context = r } return J(e, [{ key: "first", value: function () { return this.offset < this.source.length ? this.source.charAt(this.offset) : e.EofCh } }, { key: "rest", value: function () { return this.offset < this.source.length ? new e(this.source, this.offset + 1, this.context) : this } }, { key: "pos", value: function () { return new Z(this.source, this.offset) } }, { key: "atEnd", value: function () { return this.offset >= this.source.length } }, { key: "drop", value: function (e) { var t, n; for (t = this, n = e; n > 0;)t = t.rest(), n -= 1; return t } }]), e }(); Y.EofCh = "\x03"; var $ = function () { function e() { H(this, e) } return J(e, null, [{ key: "parse", value: function (e, t) { return e.apply(t) } }, { key: "parseAll", value: function (t, n) { return t.andl((function () { return e.eos() })).apply(n) } }, { key: "parseString", value: function (t, n) { var r = new Y(n, 0, { lastNoSuccess: void 0 }); return e.parse(t, r) } }, { key: "parseAllString", value: function (t, n) { var r = new Y(n, 0, { lastNoSuccess: void 0 }); return e.parseAll(t, r) } }, { key: "_handleWhiteSpace", value: function (e) { var t = e.context.whiteSpaceRegex, n = e.source, r = e.offset, i = t.exec(n.substring(r, n.length)); return null !== i ? r + i[0].length : r } }, { key: "literal", value: function (t) { return new ie((function (n) { var r, i, a, o, u, s; for (r = n.source, i = n.offset, o = 0, u = a = e._handleWhiteSpace(n); o < t.length && u < r.length && t.charAt(o) === r.charAt(u);)o += 1, u += 1; return o === t.length ? new ee(t, n.drop(u - i)) : (s = a === r.length ? "end of source" : "`" + r.charAt(a) + "'", new ne("`" + t + "' expected but " + s + " found", n.drop(a - i))) })) } }, { key: "regex", value: function (e) { if ("/^" !== e.toString().substring(0, 2)) throw "regex must start with `^' but " + e; return new ie((function (t) { var n, r, i, a; return n = t.source, r = t.offset, null !== (i = e.exec(n.substring(r, n.length))) ? new ee(i[0], t.drop(i[0].length)) : (a = r === n.length ? "end of source" : "`" + n.charAt(r) + "'", new ne("string matching regex " + e + " expected but " + a + " found", t)) })) } }, { key: "regexLiteral", value: function (t) { if ("/^" !== t.toString().substring(0, 2)) throw "regex must start with `^' but " + t; return new ie((function (n) { var r, i, a, o, u; return r = n.source, i = n.offset, a = e._handleWhiteSpace(n), null !== (o = t.exec(r.substring(a, r.length))) ? new ee(o[0], n.drop(a + o[0].length - i)) : (u = a === r.length ? "end of source" : "`" + r.charAt(a) + "'", new ne("string matching regex " + t + " expected but " + u + " found", n.drop(a - i))) })) } }, { key: "eos", value: function () { return new ie((function (t) { var n, r; return n = t.source, t.offset, r = e._handleWhiteSpace(t), n.length === r ? new ee("", t) : new ne("end of source expected but `" + n.charAt(r) + "' found", t) })) } }, { key: "commit", value: function (e) { return new ie((function (t) { var n = e()(t); return (new _).Case(ee, (function (e) { return n })).Case(re, (function (e) { return n })).Case(ne, (function (e) { return new re(e[0], e[1]) })).match(n) })) } }, { key: "elem", value: function (t) { return e.accept(t).named('"' + t + '"') } }, { key: "accept", value: function (t) { return e.acceptIf((function (e) { return e === t }), (function (e) { return "`" + t + "' expected but `" + e + "' found" })) } }, { key: "acceptIf", value: function (e, t) { return new ie((function (n) { return e(n.first()) ? new ee(n.first(), n.rest()) : new ne(t(n.first()), n) })) } }, { key: "failure", value: function (e) { return new ie((function (t) { return new ne(e, t) })) } }, { key: "err", value: function (e) { return new ie((function (t) { return new re(e, t) })) } }, { key: "success", value: function (e) { return new ie((function (t) { return new ee(e, t) })) } }, { key: "log", value: function (e, t) { return new ie((function (n) { console.log("trying " + t + " at " + n); var r = e().apply(n); return console.log(t + " --\x3e " + r), r })) } }, { key: "rep", value: function (t) { var n = e.success(L.empty); return e.rep1(t).or((function () { return n })) } }, { key: "rep1", value: function (e) { return new ie((function (t) { var n, r, i, a; if (n = [], r = t, (a = (i = e()).apply(t)) instanceof ee) { for (; a instanceof ee;)n.push(a.result), r = a.next, a = i.apply(r); return new ee(L.fromArray(n), r) } return a })) } }, { key: "repN", value: function (t, n) { return 0 === t ? e.success(FP.List.empty) : new ie((function (e) { var r, i, a, o; for (r = [], i = e, o = (a = n()).apply(i); o instanceof ee;) { if (r.push(o.result), i = o.next, t === r.length) return new ee(L.fromArray(r), i); o = a.apply(i) } return o })) } }, { key: "repsep", value: function (t, n) { var r = e.success(L.empty); return e.rep1sep(t, n).or((function () { return r })) } }, { key: "rep1sep", value: function (t, n) { return t().and(e.rep(n().andr(t))).to((function (e) { return new L.Cons(e.head, e.tail) })) } }, { key: "chainl1", value: function (t, n, r) { return t().and(e.rep(r().and(n))).to((function (e) { return e.tail.foldLeft(e.head, (function (e, t) { return t.head(e, t.tail) })) })) } }, { key: "chainr1", value: function (e, t, n, r) { return e().and(this.rep(t().and(e))).to((function (e) { return new L.Cons(new R(n, e.head), e.tail).foldRight(r, (function (e, t) { return e.head(e.tail, t) })) })) } }, { key: "opt", value: function (t) { return t().to((function (e) { return new g.Some(e) })).or((function () { return e.success(g.empty) })) } }, { key: "not", value: function (e) { return new ie((function (t) { return e().apply(t).successful ? new ne("Expected failure", t) : new ee(g.empty, t) })) } }, { key: "guard", value: function (e) { return new ie((function (t) { var n = e().apply(t); return n.successful ? new ee(n.result, t) : n })) } }, { key: "mkList", value: function (e) { return new L.Cons(e.head, e.tail) } }, { key: "fun", value: function (e) { return function () { return e } } }, { key: "lazyParser", value: function (t) { var n, r; return t instanceof String || "string" == typeof t ? (n = e.literal(t), function () { return n }) : t instanceof Function ? t : t instanceof Object ? t instanceof ie ? function () { return t } : t instanceof RegExp ? (r = e.regexLiteral(t), function () { return r }) : e.err("unhandlable type") : e.err("unhandlable type") } }, { key: "seq", value: function () { var t, n, r; if (0 === (t = arguments.length)) return e.err("at least one element must be specified"); for (n = e.lazyParser(arguments[0])(), r = 1; r < t;)n = n.and(e.lazyParser(arguments[r])), r += 1; return n } }, { key: "or", value: function () { var t, n, r; if (0 === (t = arguments.length)) return e.err("at least one element must be specified"); for (n = e.lazyParser(arguments[0])(), r = 1; r < t;)n = n.or(e.lazyParser(arguments[r])), r += 1; return n } }]), e }(), K = function () { function e() { H(this, e) } return J(e, [{ key: "isEmpty", value: function () { return !this.successful } }, { key: "getOrElse", value: function (e) { return this.isEmpty ? e() : this.get() } }]), e }(); $.ParseResult = K; var ee = function (e) { Q(n, e); var t = N(n); function n(e, r) { var i; return H(this, n), (i = t.call(this)).result = e, i.next = r, i } return J(n, [{ key: "successful", get: function () { return !0 } }, { key: "map", value: function (e) { return new n(e(this.result), this.next) } }, { key: "mapPartial", value: function (e, t) { try { return new n(e(this.result), this.next) } catch (e) { if (e instanceof I) return new ne(t(this.result), this.next); throw e } } }, { key: "flatMapWithNext", value: function (e) { return e(this.result).apply(this.next) } }, { key: "append", value: function (e) { return this } }, { key: "get", value: function () { return this.result } }, { key: "toString", value: function () { return "[" + this.next.pos() + "] parsed: " + this.result } }], [{ key: "unapply", value: function (e) { return new g.Some([e.result, e.next]) } }]), n }(K); $.Success = ee; var te = function (e) { Q(n, e); var t = N(n); function n() { return H(this, n), t.call(this) } return J(n, [{ key: "successful", get: function () { return !1 } }, { key: "_setLastNoSuccess", value: function () { var e = this.next.context; void 0 !== e.lastNoSuccess && this.next.pos().isLessThan(e.lastNoSuccess.next.pos()) || (e.lastNoSuccess = this) } }, { key: "map", value: function (e) { return this } }, { key: "mapPartial", value: function (e, t) { return this } }, { key: "flatMapWithNext", value: function (e) { return this } }, { key: "get", value: function () { return $.error("No result when parsing failed") } }]), n }(K); $.NoSuccess = te; var ne = function (e) { Q(n, e); var t = N(n); function n(e, r) { var i; return H(this, n), (i = t.call(this)).msg = e, i.next = r, i._setLastNoSuccess(), i } return J(n, [{ key: "append", value: function (e) { var t = e(); if (t instanceof ee) return t; if (t instanceof te) return t.next.pos().isLessThan(this.next.pos()) ? this : t; throw new I(t) } }, { key: "toString", value: function () { return "[" + this.next.pos() + "] failure: " + this.msg + "\n\n" + this.next.pos().longString() } }], [{ key: "unapply", value: function (e) { return new g.Some([e.msg, e.next]) } }]), n }(te); $.Failure = ne; var re = function (e) { Q(n, e); var t = N(n); function n(e, r) { var i; return H(this, n), (i = t.call(this)).msg = e, i.next = r, i._setLastNoSuccess(), i } return J(n, [{ key: "append", value: function (e) { return this } }, { key: "toString", value: function () { return "[" + this.next.pos() + "] error: " + this.msg + "\n\n" + this.next.pos().longString() } }], [{ key: "unapply", value: function (e) { return new g.Some([e.msg, e.next]) } }]), n }(te); $.ParseError = re; var ie = function () { function e(t) { H(this, e), this.apply = t, this.name = "" } return J(e, [{ key: "named", value: function (e) { return this.name = e, this } }, { key: "toString", value: function () { return "Parser (" + this.name + ")" } }, { key: "flatMap", value: function (t) { var n = this; return new e((function (e) { return n.apply(e).flatMapWithNext(t) })) } }, { key: "map", value: function (t) { var n = this; return new e((function (e) { return n.apply(e).map(t) })) } }, { key: "append", value: function (t) { var n = this; return new e((function (e) { return n.apply(e).append((function () { return t().apply(e) })) })) } }, { key: "and", value: function (e) { return this.flatMap((function (t) { return e().map((function (e) { return new R(t, e) })) })).named("~") } }, { key: "andr", value: function (e) { return this.flatMap((function (t) { return e().map((function (e) { return e })) })).named("~>") } }, { key: "andl", value: function (e) { return this.flatMap((function (t) { return e().map((function (e) { return t })) })).named("<~") } }, { key: "or", value: function (e) { return this.append(e).named("|") } }, { key: "andOnce", value: function (e) { var t = this; return new ae((function () { return t.flatMap((function (t) { return $.commit(e).map((function (e) { return new R(t, e) })) })).named("~!") })) } }, { key: "longestOr", value: function (t) { var n = this; return new e((function (e) { var r, i; return r = n.apply(e), i = t()(e), r.successful ? i.successful ? i.next.pos().isLessThan(r.next.pos()) ? r : i : r : i.successful ? i : r instanceof re || i.next.pos().isLessThan(r.next.pos()) ? r : i })).named("|||") } }, { key: "to", value: function (e) { return this.map(e).named(this.toString() + "^^") } }, { key: "ret", value: function (t) { var n = this; return new e((function (e) { return n.apply(e).map((function (e) { return t() })) })).named(this.toString() + "^^^") } }, { key: "toIfPossible", value: function (t, n) { void 0 === n && (n = function (e) { return "Constructor function not defined at " + e }); var r = this; return new e((function (e) { return r.apply(e).mapPartial(t, n) })).named(this.toString() + "^?") } }, { key: "into", value: function (e) { return this.flatMap(e) } }, { key: "rep", value: function () { var e = this; return $.rep((function () { return e })) } }, { key: "chain", value: function (e) { var t, n; return t = this, n = function () { return t }, $.chainl1(n, n, e) } }, { key: "rep1", value: function () { var e = this; return $.rep1((function () { return e })) } }, { key: "opt", value: function () { var e = this; return $.opt((function () { return e })) } }]), e }(); $.Parser = ie; var ae = function (e) { Q(n, e); var t = N(n); function n(e) { return H(this, n), t.call(this, e) } return J(n, [{ key: "and", value: function (e) { var t = this; return new n((function () { return t.flatMap((function (t) { return $.commit(e).map((function (e) { return R(t, e) })) })) })).named("~") } }]), n }(ie); $.OnceParser = ae; var oe = n(376), ue = n(771); function se(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function ce(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function he(e, t, n) { return t && ce(e.prototype, t), n && ce(e, n), e } var le = function () { function e() { se(this, e), this.userDirMap = {} } return he(e, [{ key: "get", value: function (e) { return this.userDirMap[e] } }, { key: "put", value: function (e, t) { this.userDirMap[e] = t } }]), e }(), me = function () { function e() { se(this, e), this.userModifierMap = {} } return he(e, [{ key: "get", value: function (t) { var n = e.embeddedModifierMap[t]; return void 0 !== n ? n : this.userModifierMap[t] } }, { key: "put", value: function (t, n) { void 0 === e.embeddedModifierMap[t] && (this.userModifierMap[t] = n) } }]), e }(), pe = { repositories: { modifierRepository: new me, dirRepository: new le }, xypicCommandIdCounter: 0, xypicCommandMap: {}, textObjectIdCounter: 0, wrapperOfTextObjectMap: {} }; function fe(e) { return fe = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, fe(e) } function de(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function ye(e, t, n) { return t && de(e.prototype, t), n && de(e, n), e } function ve(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && xe(e, t) } function xe(e, t) { return xe = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, xe(e, t) } function ge(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = Se(e); if (t) { var i = Se(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return we(this, n) } } function we(e, t) { if (t && ("object" === fe(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function Se(e) { return Se = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, Se(e) } function be(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } var Ce = function e() { be(this, e) }, ke = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { var a; be(this, n), (a = t.call(this, e, r, i)).textMmls = i, a.texClass = oe.Ls.ORD; var o = r["data-cmd-id"], u = pe.xypicCommandMap[o]; a.cmd = u; for (var s = JSON.parse(r["data-text-mml-ids"]), c = 0, h = s.length; c < h; c++)i[c].xypicTextObjectId = s[c]; return a } return n }(oe.oI); ke.defaults = oe.oI.defaults, (Ce.xypic = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { return be(this, n), t.call(this, e, r, i) } return ye(n, [{ key: "kind", get: function () { return "xypic" } }, { key: "toString", value: function () { return this.kind + "(" + this.cmd + ")" } }]), n }(ke)).defaults = ke.defaults, ue.v[Ce.xypic.prototype.kind] = Ce.xypic, Ce.xypic.newdir = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { return be(this, n), t.call(this, e, r, i) } return ye(n, [{ key: "kind", get: function () { return "xypic-newdir" } }, { key: "toString", value: function () { return this.kind + "(" + this.cmd + ")" } }]), n }(ke), Ce.xypic.newdir.defaults = ke.defaults, ue.v[Ce.xypic.newdir.prototype.kind] = Ce.xypic.newdir, Ce.xypic.includegraphics = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { return be(this, n), t.call(this, e, r, i) } return ye(n, [{ key: "kind", get: function () { return "xypic-includegraphics" } }, { key: "toString", value: function () { return this.kind + "(" + this.cmd + ")" } }]), n }(ke), Ce.xypic.includegraphics.defaults = ke.defaults, ue.v[Ce.xypic.includegraphics.prototype.kind] = Ce.xypic.includegraphics, Ce.PosDecor = function () { function e(t, n) { be(this, e), this.pos = t, this.decor = n } return ye(e, [{ key: "toString", value: function () { return this.pos.toString() + " " + this.decor } }]), e }(), (Ce.Pos = function e() { be(this, e) }).Coord = function () { function e(t, n) { be(this, e), this.coord = t, this.pos2s = n } return ye(e, [{ key: "toString", value: function () { return this.coord.toString() + " " + this.pos2s.mkString(" ") } }]), e }(), Ce.Pos.Plus = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "+(" + this.coord + ")" } }]), e }(), Ce.Pos.Minus = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "-(" + this.coord + ")" } }]), e }(), Ce.Pos.Skew = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "!(" + this.coord + ")" } }]), e }(), Ce.Pos.Cover = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return ".(" + this.coord + ")" } }]), e }(), Ce.Pos.Then = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return ",(" + this.coord + ")" } }]), e }(), Ce.Pos.SwapPAndC = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return ";(" + this.coord + ")" } }]), e }(), Ce.Pos.SetBase = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return ":(" + this.coord + ")" } }]), e }(), Ce.Pos.SetYBase = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "::(" + this.coord + ")" } }]), e }(), Ce.Pos.ConnectObject = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "**(" + this.object + ")" } }]), e }(), Ce.Pos.DropObject = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "*(" + this.object + ")" } }]), e }(), Ce.Pos.Place = function () { function e(t) { be(this, e), this.place = t } return ye(e, [{ key: "toString", value: function () { return "?(" + this.place + ")" } }]), e }(), Ce.Pos.PushCoord = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "@+(" + this.coord + ")" } }]), e }(), Ce.Pos.EvalCoordThenPop = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "@-(" + this.coord + ")" } }]), e }(), Ce.Pos.LoadStack = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "@=(" + this.coord + ")" } }]), e }(), Ce.Pos.DoCoord = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "@@(" + this.coord + ")" } }]), e }(), Ce.Pos.InitStack = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "@i" } }]), e }(), Ce.Pos.EnterFrame = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "@(" } }]), e }(), Ce.Pos.LeaveFrame = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "@)" } }]), e }(), Ce.Pos.SavePos = function () { function e(t) { be(this, e), this.id = t } return ye(e, [{ key: "toString", value: function () { return '="' + this.id + '"' } }]), e }(), Ce.Pos.SaveMacro = function () { function e(t, n) { be(this, e), this.macro = t, this.id = n } return ye(e, [{ key: "toString", value: function () { return "=(" + this.macro + ' "' + this.id + '")' } }]), e }(), Ce.Pos.SaveBase = function () { function e(t) { be(this, e), this.id = t } return ye(e, [{ key: "toString", value: function () { return '=:"' + this.id + '"' } }]), e }(), Ce.Pos.SaveStack = function () { function e(t) { be(this, e), this.id = t } return ye(e, [{ key: "toString", value: function () { return '=@"' + this.id + '"' } }]), e }(), (Ce.Coord = function e() { be(this, e) }).Vector = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "toString", value: function () { return this.vector.toString() } }]), e }(), Ce.Coord.C = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "c" } }]), e }(), Ce.Coord.P = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "p" } }]), e }(), Ce.Coord.X = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "x" } }]), e }(), Ce.Coord.Y = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "y" } }]), e }(), Ce.Coord.Id = function () { function e(t) { be(this, e), this.id = t } return ye(e, [{ key: "toString", value: function () { return '"' + this.id + '"' } }]), e }(), Ce.Coord.Group = function () { function e(t) { be(this, e), this.posDecor = t } return ye(e, [{ key: "toString", value: function () { return "{" + this.posDecor + "}" } }]), e }(), Ce.Coord.StackPosition = function () { function e(t) { be(this, e), this.number = t } return ye(e, [{ key: "toString", value: function () { return "s{" + this.number + "}" } }]), e }(), Ce.Coord.DeltaRowColumn = function () { function e(t, n, r) { be(this, e), this.prefix = t, this.dr = n, this.dc = r } return ye(e, [{ key: "toString", value: function () { return "[" + ("" === this.prefix ? "" : '"' + this.prefix + '"') + this.dr + "," + this.dc + "]" } }]), e }(), Ce.Coord.Hops = function () { function e(t, n) { be(this, e), this.prefix = t, this.hops = n } return ye(e, [{ key: "toString", value: function () { return "[" + ("" === this.prefix ? "" : '"' + this.prefix + '"') + this.hops.mkString("") + "]" } }]), e }(), Ce.Coord.HopsWithPlace = function () { function e(t, n, r) { be(this, e), this.prefix = t, this.hops = n, this.place = r } return ye(e, [{ key: "toString", value: function () { return "[" + ("" === this.prefix ? "" : '"' + this.prefix + '"') + this.hops.mkString("") + this.place + "]" } }]), e }(), (Ce.Vector = function e() { be(this, e) }).InCurBase = function () { function e(t, n) { be(this, e), this.x = t, this.y = n } return ye(e, [{ key: "toString", value: function () { return "(" + this.x + ", " + this.y + ")" } }]), e }(), Ce.Vector.Abs = function () { function e(t, n) { be(this, e), this.x = t, this.y = n } return ye(e, [{ key: "toString", value: function () { return "<" + this.x + ", " + this.y + ">" } }]), e }(), Ce.Vector.Angle = function () { function e(t) { be(this, e), this.degree = t } return ye(e, [{ key: "toString", value: function () { return "a(" + this.degree + ")" } }]), e }(), Ce.Vector.Dir = function () { function e(t, n) { be(this, e), this.dir = t, this.dimen = n } return ye(e, [{ key: "toString", value: function () { return "/" + this.dir + " " + this.dimen + "/" } }]), e }(), Ce.Vector.Corner = function () { function e(t, n) { be(this, e), this.corner = t, this.factor = n } return ye(e, [{ key: "toString", value: function () { return this.corner.toString() + "(" + this.factor + ")" } }]), e }(), (Ce.Corner = function e() { be(this, e) }).L = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "L" } }]), e }(), Ce.Corner.R = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "R" } }]), e }(), Ce.Corner.D = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "D" } }]), e }(), Ce.Corner.U = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "U" } }]), e }(), Ce.Corner.CL = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "CL" } }]), e }(), Ce.Corner.CR = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "CR" } }]), e }(), Ce.Corner.CD = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "CD" } }]), e }(), Ce.Corner.CU = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "CU" } }]), e }(), Ce.Corner.LD = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "LD" } }]), e }(), Ce.Corner.RD = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "RD" } }]), e }(), Ce.Corner.LU = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "LU" } }]), e }(), Ce.Corner.RU = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "RU" } }]), e }(), Ce.Corner.NearestEdgePoint = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "E" } }]), e }(), Ce.Corner.PropEdgePoint = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "P" } }]), e }(), Ce.Corner.Axis = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "A" } }]), e }(), (Ce.Place = function () { function e(t, n, r, i) { be(this, e), this.shaveP = t, this.shaveC = n, this.factor = r, this.slide = i } return ye(e, [{ key: "compound", value: function (e) { return new Ce.Place(this.shaveP + e.shaveP, this.shaveC + e.shaveC, void 0 === e.factor ? this.factor : e.factor, e.slide) } }, { key: "toString", value: function () { for (var e = "", t = 0; t < this.shaveP; t++)e += "<"; for (var n = 0; n < this.shaveC; n++)e += ">"; return void 0 !== this.factor && (e += "(" + this.factor + ")"), this.slide.dimen.foreach((function (t) { e += "/" + t + "/" })), e } }]), e }()).Factor = function () { function e(t) { be(this, e), this.factor = t } return ye(e, [{ key: "isIntercept", get: function () { return !1 } }, { key: "toString", value: function () { return this.factor.toString() } }]), e }(), Ce.Place.Intercept = function () { function e(t) { be(this, e), this.pos = t } return ye(e, [{ key: "isIntercept", get: function () { return !0 } }, { key: "toString", value: function () { return "!{" + this.pos + "}" } }]), e }(), Ce.Slide = function () { function e(t) { be(this, e), this.dimen = t } return ye(e, [{ key: "toString", value: function () { return this.dimen.getOrElse("") } }]), e }(), Ce.Object = function () { function e(t, n) { be(this, e), this.modifiers = t, this.object = n } return ye(e, [{ key: "dirVariant", value: function () { return this.object.dirVariant() } }, { key: "dirMain", value: function () { return this.object.dirMain() } }, { key: "isDir", value: function () { return this.object.isDir() } }, { key: "toString", value: function () { return this.modifiers.mkString() + this.object.toString() } }]), e }(), (Ce.ObjectBox = function () { function e() { be(this, e) } return ye(e, [{ key: "isEmpty", get: function () { return !1 } }, { key: "dirVariant", value: function () { } }, { key: "dirMain", value: function () { } }, { key: "isDir", value: function () { return !1 } }]), e }()).Text = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).math = e, r } return ye(n, [{ key: "toString", value: function () { return "{" + this.math.toString() + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Empty = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "isEmpty", get: function () { return !0 } }, { key: "toString", value: function () { return "{}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Xymatrix = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).xymatrix = e, r } return ye(n, [{ key: "toString", value: function () { return this.xymatrix.toString() } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Txt = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).width = e, i.textObject = r, i } return ye(n, [{ key: "toString", value: function () { return "\\txt" + this.width + "{" + this.textObject.toString() + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Txt.Width = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return n }(Ce.ObjectBox), Ce.ObjectBox.Txt.Width.Vector = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).vector = e, r } return ye(n, [{ key: "toString", value: function () { return this.vector.toString() } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Txt.Width.Default = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.WrapUpObject = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).object = e, r } return ye(n, [{ key: "toString", value: function () { return "\\object" + this.object.toString() } }]), n }(Ce.ObjectBox), Ce.ObjectBox.CompositeObject = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).objects = e, r } return ye(n, [{ key: "toString", value: function () { return "\\composite{" + this.objects.mkString(" * ") + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Xybox = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).posDecor = e, r } return ye(n, [{ key: "toString", value: function () { return "\\xybox{" + this.posDecor.toString() + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Cir = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).radius = e, i.cir = r, i } return ye(n, [{ key: "toString", value: function () { return "\\cir" + this.radius + "{" + this.cir + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Cir.Radius = function e() { be(this, e) }, Ce.ObjectBox.Cir.Radius.Vector = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "toString", value: function () { return this.vector.toString() } }]), e }(), Ce.ObjectBox.Cir.Radius.Default = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "" } }]), e }(), Ce.ObjectBox.Cir.Cir = function e() { be(this, e) }, Ce.ObjectBox.Cir.Cir.Segment = function () { function e(t, n, r) { be(this, e), this.startDiag = t, this.orient = n, this.endDiag = r } return ye(e, [{ key: "toString", value: function () { return this.startDiag.toString() + this.orient + this.endDiag } }]), e }(), Ce.ObjectBox.Cir.Cir.Full = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "" } }]), e }(), Ce.ObjectBox.Dir = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).variant = e, i.main = r, i } return ye(n, [{ key: "dirVariant", value: function () { return this.variant } }, { key: "dirMain", value: function () { return this.main } }, { key: "isDir", value: function () { return !0 } }, { key: "toString", value: function () { return "\\dir" + this.variant + "{" + this.main + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Curve = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { var a; return be(this, n), (a = t.call(this)).modifiers = e, a.objects = r, a.poslist = i, a } return ye(n, [{ key: "dirVariant", value: function () { return "" } }, { key: "dirMain", value: function () { return "-" } }, { key: "isDir", value: function () { return !1 } }, { key: "toString", value: function () { return "\\curve" + this.modifiers.mkString("") + "{" + this.objects.mkString(" ") + " " + this.poslist.mkString("&") + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Curve.Modifier = function e() { be(this, e) }, Ce.ObjectBox.Curve.Modifier.p = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~p" } }]), e }(), Ce.ObjectBox.Curve.Modifier.P = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~P" } }]), e }(), Ce.ObjectBox.Curve.Modifier.l = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~l" } }]), e }(), Ce.ObjectBox.Curve.Modifier.L = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~L" } }]), e }(), Ce.ObjectBox.Curve.Modifier.c = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~c" } }]), e }(), Ce.ObjectBox.Curve.Modifier.C = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~C" } }]), e }(), Ce.ObjectBox.Curve.Modifier.pc = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~pc" } }]), e }(), Ce.ObjectBox.Curve.Modifier.pC = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~pC" } }]), e }(), Ce.ObjectBox.Curve.Modifier.Pc = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~Pc" } }]), e }(), Ce.ObjectBox.Curve.Modifier.PC = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~PC" } }]), e }(), Ce.ObjectBox.Curve.Modifier.lc = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~lc" } }]), e }(), Ce.ObjectBox.Curve.Modifier.lC = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~lC" } }]), e }(), Ce.ObjectBox.Curve.Modifier.Lc = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~Lc" } }]), e }(), Ce.ObjectBox.Curve.Modifier.LC = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~LC" } }]), e }(), Ce.ObjectBox.Curve.Modifier.cC = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~cC" } }]), e }(), Ce.ObjectBox.Curve.Object = function e() { be(this, e) }, Ce.ObjectBox.Curve.Object.Drop = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "~*" + this.object } }]), e }(), Ce.ObjectBox.Curve.Object.Connect = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "~**" + this.object } }]), e }(), Ce.ObjectBox.Curve.PosList = function e() { be(this, e) }, Ce.ObjectBox.Curve.PosList.CurPos = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "" } }]), e }(), Ce.ObjectBox.Curve.PosList.Pos = function () { function e(t) { be(this, e), this.pos = t } return ye(e, [{ key: "toString", value: function () { return this.pos.toString() } }]), e }(), Ce.ObjectBox.Curve.PosList.AddStack = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~@" } }]), e }(), (Ce.Modifier = function e() { be(this, e) }).Vector = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).vector = e, r } return ye(n, [{ key: "toString", value: function () { return "!" + this.vector } }]), n }(Ce.Modifier), Ce.Modifier.RestoreOriginalRefPoint = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "!" } }]), n }(Ce.Modifier), Ce.Modifier.AddOp = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).op = e, i.size = r, i } return ye(n, [{ key: "toString", value: function () { return this.op.toString() + " " + this.size } }]), n }(Ce.Modifier), Ce.Modifier.AddOp.Grow = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "+" } }]), e }(), Ce.Modifier.AddOp.Shrink = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "-" } }]), e }(), Ce.Modifier.AddOp.Set = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "=" } }]), e }(), Ce.Modifier.AddOp.GrowTo = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "+=" } }]), e }(), Ce.Modifier.AddOp.ShrinkTo = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "-=" } }]), e }(), Ce.Modifier.AddOp.VactorSize = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "isDefault", get: function () { return !1 } }, { key: "toString", value: function () { return this.vector.toString() } }]), e }(), Ce.Modifier.AddOp.DefaultSize = function () { function e() { be(this, e) } return ye(e, [{ key: "isDefault", get: function () { return !0 } }, { key: "toString", value: function () { return "" } }]), e }(), Ce.Modifier.Shape = function e() { be(this, e) }, Ce.Modifier.Shape.Point = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[.]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.Rect = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.Alphabets = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).alphabets = e, r } return ye(n, [{ key: "toString", value: function () { return "[" + this.alphabets + "]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.DefineShape = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).shape = e, r } return ye(n, [{ key: "toString", value: function () { return "[" + this.shape + "]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.Circle = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[o]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.L = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[l]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.R = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[r]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.U = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[u]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.D = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[d]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.C = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "[c]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.ChangeColor = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).colorName = e, r } return ye(n, [{ key: "toString", value: function () { return "[" + this.colorName + "]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.CompositeModifiers = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).modifiers = e, r } return ye(n, [{ key: "toString", value: function () { return this.modifiers.mkString("") } }]), n }(Ce.Modifier), Ce.Modifier.Shape.Frame = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).main = e, i.options = r, i } return ye(n, [{ key: "toString", value: function () { return "[F" + this.main + this.options.mkString("") + "]" } }]), n }(Ce.Modifier), Ce.Modifier.Shape.Frame.Radius = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "toString", value: function () { return ":" + this.vector } }]), e }(), Ce.Modifier.Shape.Frame.Color = function () { function e(t) { be(this, e), this.colorName = t } return ye(e, [{ key: "toString", value: function () { return ":" + this.colorName } }]), e }(), Ce.Modifier.Invisible = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "i" } }]), n }(Ce.Modifier), Ce.Modifier.Hidden = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "h" } }]), n }(Ce.Modifier), Ce.Modifier.Direction = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).direction = e, r } return ye(n, [{ key: "toString", value: function () { return this.direction.toString() } }]), n }(Ce.Modifier), (Ce.Direction = function e() { be(this, e) }).Compound = function () { function e(t, n) { be(this, e), this.dir = t, this.rots = n } return ye(e, [{ key: "toString", value: function () { return this.dir.toString() + this.rots.mkString() } }]), e }(), Ce.Direction.Diag = function () { function e(t) { be(this, e), this.diag = t } return ye(e, [{ key: "toString", value: function () { return this.diag.toString() } }]), e }(), Ce.Direction.Vector = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "toString", value: function () { return "v" + this.vector.toString() } }]), e }(), Ce.Direction.ConstructVector = function () { function e(t) { be(this, e), this.posDecor = t } return ye(e, [{ key: "toString", value: function () { return "q{" + this.posDecor.toString() + "}" } }]), e }(), Ce.Direction.RotVector = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "toString", value: function () { return ":" + this.vector.toString() } }]), e }(), Ce.Direction.RotAntiCW = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "_" } }]), e }(), Ce.Direction.RotCW = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "^" } }]), e }(), (Ce.Diag = function e() { be(this, e) }).Default = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "" } }]), e }(), Ce.Diag.Angle = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return this.symbol } }]), e }(), Ce.Diag.LD = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "ld" } }, { key: "ang", get: function () { return -3 * Math.PI / 4 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.RD : new Ce.Diag.LU } }]), n }(Ce.Diag.Angle), Ce.Diag.RD = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "rd" } }, { key: "ang", get: function () { return -Math.PI / 4 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.RU : new Ce.Diag.LD } }]), n }(Ce.Diag.Angle), Ce.Diag.LU = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "lu" } }, { key: "ang", get: function () { return 3 * Math.PI / 4 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.LD : new Ce.Diag.RU } }]), n }(Ce.Diag.Angle), Ce.Diag.RU = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "ru" } }, { key: "ang", get: function () { return Math.PI / 4 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.LU : new Ce.Diag.RD } }]), n }(Ce.Diag.Angle), Ce.Diag.L = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "l" } }, { key: "ang", get: function () { return Math.PI } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.D : new Ce.Diag.U } }]), n }(Ce.Diag.Angle), Ce.Diag.R = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "r" } }, { key: "ang", get: function () { return 0 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.U : new Ce.Diag.D } }]), n }(Ce.Diag.Angle), Ce.Diag.D = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "d" } }, { key: "ang", get: function () { return -Math.PI / 2 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.R : new Ce.Diag.L } }]), n }(Ce.Diag.Angle), Ce.Diag.U = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "symbol", get: function () { return "u" } }, { key: "ang", get: function () { return Math.PI / 2 } }, { key: "turn", value: function (e) { return "^" === e ? new Ce.Diag.L : new Ce.Diag.R } }]), n }(Ce.Diag.Angle), Ce.ObjectBox.Frame = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).radius = e, i.main = r, i } return ye(n, [{ key: "toString", value: function () { return "\\frm" + this.radius + "{" + this.main + "}" } }]), n }(Ce.ObjectBox), Ce.ObjectBox.Frame.Radius = function e() { be(this, e) }, Ce.ObjectBox.Frame.Radius.Vector = function () { function e(t) { be(this, e), this.vector = t } return ye(e, [{ key: "toString", value: function () { return this.vector.toString() } }]), e }(), Ce.ObjectBox.Frame.Radius.Default = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "" } }]), e }(), Ce.Decor = function () { function e(t) { be(this, e), this.commands = t } return ye(e, [{ key: "toString", value: function () { return this.commands.mkString(" ") } }]), e }(), (Ce.Command = function e() { be(this, e) }).Save = function () { function e(t) { be(this, e), this.pos = t } return ye(e, [{ key: "toString", value: function () { return "\\save " + this.pos } }]), e }(), Ce.Command.Restore = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "\\restore" } }]), e }(), Ce.Command.Pos = function () { function e(t) { be(this, e), this.pos = t } return ye(e, [{ key: "toString", value: function () { return "\\POS " + this.pos } }]), e }(), Ce.Command.AfterPos = function () { function e(t, n) { be(this, e), this.decor = t, this.pos = n } return ye(e, [{ key: "toString", value: function () { return "\\afterPOS{" + this.decor + "} " + this.pos } }]), e }(), Ce.Command.Drop = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "\\drop " + this.object } }]), e }(), Ce.Command.Connect = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "\\connect " + this.object } }]), e }(), Ce.Command.Relax = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "\\relax" } }]), e }(), Ce.Command.Ignore = function () { function e(t, n) { be(this, e), this.pos = t, this.decor = n } return ye(e, [{ key: "toString", value: function () { return "\\ignore{" + this.pos + " " + this.decor + "}" } }]), e }(), Ce.Command.ShowAST = function () { function e(t, n) { be(this, e), this.pos = t, this.decor = n } return ye(e, [{ key: "toString", value: function () { return "\\xyshowAST{" + this.pos + " " + this.decor + "}" } }]), e }(), Ce.Command.Path = function () { function e(t) { be(this, e), this.path = t } return ye(e, [{ key: "toString", value: function () { return "\\PATH " + this.path } }]), e }(), Ce.Command.AfterPath = function () { function e(t, n) { be(this, e), this.decor = t, this.path = n } return ye(e, [{ key: "toString", value: function () { return "\\afterPATH{" + this.decor + "} " + this.path } }]), e }(), Ce.Command.Path.Path = function () { function e(t) { be(this, e), this.pathElements = t } return ye(e, [{ key: "toString", value: function () { return this.pathElements.mkString("[", ", ", "]") } }]), e }(), Ce.Command.Path.SetBeforeAction = function () { function e(t) { be(this, e), this.posDecor = t } return ye(e, [{ key: "toString", value: function () { return "~={" + this.posDecor + "}" } }]), e }(), Ce.Command.Path.SetAfterAction = function () { function e(t) { be(this, e), this.posDecor = t } return ye(e, [{ key: "toString", value: function () { return "~/{" + this.posDecor + "}" } }]), e }(), Ce.Command.Path.AddLabelNextSegmentOnly = function () { function e(t) { be(this, e), this.labels = t } return ye(e, [{ key: "toString", value: function () { return "~<{" + this.labels + "}" } }]), e }(), Ce.Command.Path.AddLabelLastSegmentOnly = function () { function e(t) { be(this, e), this.labels = t } return ye(e, [{ key: "toString", value: function () { return "~>{" + this.labels + "}" } }]), e }(), Ce.Command.Path.AddLabelEverySegment = function () { function e(t) { be(this, e), this.labels = t } return ye(e, [{ key: "toString", value: function () { return "~+{" + this.labels + "}" } }]), e }(), Ce.Command.Path.StraightSegment = function () { function e(t) { be(this, e), this.segment = t } return ye(e, [{ key: "toString", value: function () { return "'" + this.segment } }]), e }(), Ce.Command.Path.TurningSegment = function () { function e(t, n) { be(this, e), this.turn = t, this.segment = n } return ye(e, [{ key: "toString", value: function () { return "`" + this.turn + " " + this.segment } }]), e }(), Ce.Command.Path.LastSegment = function () { function e(t) { be(this, e), this.segment = t } return ye(e, [{ key: "toString", value: function () { return this.segment.toString() } }]), e }(), Ce.Command.Path.Turn = function e() { be(this, e) }, Ce.Command.Path.Turn.Diag = function () { function e(t, n) { be(this, e), this.diag = t, this.radius = n } return ye(e, [{ key: "toString", value: function () { return this.diag.toString() + " " + this.radius } }]), e }(), Ce.Command.Path.Turn.Cir = function () { function e(t, n) { be(this, e), this.cir = t, this.radius = n } return ye(e, [{ key: "toString", value: function () { return this.cir.toString() + " " + this.radius } }]), e }(), Ce.Command.Path.TurnRadius = function e() { be(this, e) }, Ce.Command.Path.TurnRadius.Default = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "" } }]), e }(), Ce.Command.Path.TurnRadius.Dimen = function () { function e(t) { be(this, e), this.dimen = t } return ye(e, [{ key: "toString", value: function () { return "/" + this.dimen } }]), e }(), Ce.Command.Path.Segment = function () { function e(t, n, r) { be(this, e), this.pos = t, this.slide = n, this.labels = r } return ye(e, [{ key: "toString", value: function () { return this.pos.toString() + " " + this.slide + " " + this.labels } }]), e }(), Ce.Command.Path.Labels = function () { function e(t) { be(this, e), this.labels = t } return ye(e, [{ key: "toString", value: function () { return this.labels.mkString(" ") } }]), e }(), Ce.Command.Path.Label = function e(t, n, r) { be(this, e), this.anchor = t, this.it = n, this.aliasOption = r }, Ce.Command.Path.Label.Above = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { return be(this, n), t.call(this, e, r, i) } return ye(n, [{ key: "toString", value: function () { return "^(" + this.anchor + " " + this.it + " " + this.aliasOption + ")" } }]), n }(Ce.Command.Path.Label), Ce.Command.Path.Label.Below = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { return be(this, n), t.call(this, e, r, i) } return ye(n, [{ key: "toString", value: function () { return "_(" + this.anchor + " " + this.it + " " + this.aliasOption + ")" } }]), n }(Ce.Command.Path.Label), Ce.Command.Path.Label.At = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { return be(this, n), t.call(this, e, r, i) } return ye(n, [{ key: "toString", value: function () { return "|(" + this.anchor + " " + this.it + " " + this.aliasOption + ")" } }]), n }(Ce.Command.Path.Label), Ce.Command.Ar = function () { function e(t, n) { be(this, e), this.forms = t, this.path = n } return ye(e, [{ key: "toString", value: function () { return "\\ar " + this.forms.mkString(" ") + " " + this.path } }]), e }(), Ce.Command.Ar.Form = function e() { be(this, e) }, Ce.Command.Ar.Form.BuildArrow = function (e) { ve(n, e); var t = ge(n); function n(e, r, i, a) { var o; return be(this, n), (o = t.call(this)).variant = e, o.tailTip = r, o.stemConn = i, o.headTip = a, o } return ye(n, [{ key: "toString", value: function () { return "@" + this.variant + "{" + this.tailTip.toString() + ", " + this.stemConn.toString() + ", " + this.headTip.toString() + "}" } }]), n }(Ce.Command.Ar.Form), Ce.Command.Ar.Form.ChangeVariant = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).variant = e, r } return ye(n, [{ key: "toString", value: function () { return "@" + this.variant } }]), n }(Ce.Command.Ar.Form), Ce.Command.Ar.Form.Tip = function e() { be(this, e) }, Ce.Command.Ar.Form.Tip.Tipchars = function () { function e(t) { be(this, e), this.tipchars = t } return ye(e, [{ key: "toString", value: function () { return this.tipchars } }]), e }(), Ce.Command.Ar.Form.Tip.Object = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "*" + this.object } }]), e }(), Ce.Command.Ar.Form.Tip.Dir = function () { function e(t) { be(this, e), this.dir = t } return ye(e, [{ key: "toString", value: function () { return this.dir } }]), e }(), Ce.Command.Ar.Form.Conn = function e() { be(this, e) }, Ce.Command.Ar.Form.Conn.Connchars = function () { function e(t) { be(this, e), this.connchars = t } return ye(e, [{ key: "toString", value: function () { return this.connchars } }]), e }(), Ce.Command.Ar.Form.Conn.Object = function () { function e(t) { be(this, e), this.object = t } return ye(e, [{ key: "toString", value: function () { return "*" + this.object } }]), e }(), Ce.Command.Ar.Form.Conn.Dir = function () { function e(t) { be(this, e), this.dir = t } return ye(e, [{ key: "toString", value: function () { return this.dir } }]), e }(), Ce.Command.Ar.Form.ChangeStem = function () { function e(t) { be(this, e), this.connchar = t } return ye(e, [{ key: "toString", value: function () { return "@" + this.connchar } }]), e }(), Ce.Command.Ar.Form.DashArrowStem = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "@!" } }]), e }(), Ce.Command.Ar.Form.CurveArrow = function () { function e(t, n) { be(this, e), this.direction = t, this.dist = n } return ye(e, [{ key: "toString", value: function () { return "@/" + this.direction + " " + this.dist + "/" } }]), e }(), Ce.Command.Ar.Form.CurveFitToDirection = function () { function e(t, n) { be(this, e), this.outDirection = t, this.inDirection = n } return ye(e, [{ key: "toString", value: function () { return "@(" + this.outDirection + "," + this.inDirection + ")" } }]), e }(), Ce.Command.Ar.Form.CurveWithControlPoints = function () { function e(t) { be(this, e), this.coord = t } return ye(e, [{ key: "toString", value: function () { return "@`{" + this.coord + "}" } }]), e }(), Ce.Command.Ar.Form.AddShape = function () { function e(t) { be(this, e), this.shape = t } return ye(e, [{ key: "toString", value: function () { return "@[" + this.shape + "]" } }]), e }(), Ce.Command.Ar.Form.AddModifiers = function () { function e(t) { be(this, e), this.modifiers = t } return ye(e, [{ key: "toString", value: function () { return "@*{" + this.modifiers.mkString(" ") + "}" } }]), e }(), Ce.Command.Ar.Form.Slide = function () { function e(t) { be(this, e), this.slideDimen = t } return ye(e, [{ key: "toString", value: function () { return "@<" + this.slideDimen + ">" } }]), e }(), Ce.Command.Ar.Form.LabelAt = function () { function e(t, n) { be(this, e), this.anchor = t, this.it = n } return ye(e, [{ key: "toString", value: function () { return "|" + this.anchor + " " + this.it } }]), e }(), Ce.Command.Ar.Form.LabelAbove = function () { function e(t, n) { be(this, e), this.anchor = t, this.it = n } return ye(e, [{ key: "toString", value: function () { return "^" + this.anchor + " " + this.it } }]), e }(), Ce.Command.Ar.Form.LabelBelow = function () { function e(t, n) { be(this, e), this.anchor = t, this.it = n } return ye(e, [{ key: "toString", value: function () { return "_" + this.anchor + " " + this.it } }]), e }(), Ce.Command.Ar.Form.ReverseAboveAndBelow = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "@?" } }]), e }(), Ce.Command.Xymatrix = function () { function e(t, n) { be(this, e), this.setup = t, this.rows = n } return ye(e, [{ key: "toString", value: function () { return "\\xymatrix" + this.setup + "{\n" + this.rows.mkString("", "\\\\\n", "") + "\n}" } }]), e }(), Ce.Command.Xymatrix.Setup = function e() { be(this, e) }, Ce.Command.Xymatrix.Setup.Prefix = function () { function e(t) { be(this, e), this.prefix = t } return ye(e, [{ key: "toString", value: function () { return '"' + this.prefix + '"' } }]), e }(), Ce.Command.Xymatrix.Setup.ChangeSpacing = function e(t, n) { be(this, e), this.addop = t, this.dimen = n }, Ce.Command.Xymatrix.Setup.ChangeSpacing.Row = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "@R" + this.addop + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.ChangeSpacing), Ce.Command.Xymatrix.Setup.ChangeSpacing.Column = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "@C" + this.addop + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.ChangeSpacing), Ce.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "@" + this.addop + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.ChangeSpacing), Ce.Command.Xymatrix.Setup.PretendEntrySize = function e(t) { be(this, e), this.dimen = t }, Ce.Command.Xymatrix.Setup.PretendEntrySize.Height = function (e) { ve(n, e); var t = ge(n); function n(e) { return be(this, n), t.call(this, e) } return ye(n, [{ key: "toString", value: function () { return "@!R=" + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.PretendEntrySize), Ce.Command.Xymatrix.Setup.PretendEntrySize.Width = function (e) { ve(n, e); var t = ge(n); function n(e) { return be(this, n), t.call(this, e) } return ye(n, [{ key: "toString", value: function () { return "@!C=" + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.PretendEntrySize), Ce.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth = function (e) { ve(n, e); var t = ge(n); function n(e) { return be(this, n), t.call(this, e) } return ye(n, [{ key: "toString", value: function () { return "@!=" + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.PretendEntrySize), Ce.Command.Xymatrix.Setup.FixGrid = function e() { be(this, e) }, Ce.Command.Xymatrix.Setup.FixGrid.Row = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "@!R" } }]), n }(Ce.Command.Xymatrix.Setup.FixGrid), Ce.Command.Xymatrix.Setup.FixGrid.Column = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "@!C" } }]), n }(Ce.Command.Xymatrix.Setup.FixGrid), Ce.Command.Xymatrix.Setup.FixGrid.RowAndColumn = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "@!" } }]), n }(Ce.Command.Xymatrix.Setup.FixGrid), Ce.Command.Xymatrix.Setup.AdjustEntrySize = function e(t, n) { be(this, e), this.addop = t, this.dimen = n }, Ce.Command.Xymatrix.Setup.AdjustEntrySize.Margin = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "@M" + this.addop + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.AdjustEntrySize), Ce.Command.Xymatrix.Setup.AdjustEntrySize.Width = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "@W" + this.addop + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.AdjustEntrySize), Ce.Command.Xymatrix.Setup.AdjustEntrySize.Height = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "@H" + this.addop + this.dimen } }]), n }(Ce.Command.Xymatrix.Setup.AdjustEntrySize), Ce.Command.Xymatrix.Setup.AdjustLabelSep = function () { function e(t, n) { be(this, e), this.addop = t, this.dimen = n } return ye(e, [{ key: "toString", value: function () { return "@L" + this.addop + this.dimen } }]), e }(), Ce.Command.Xymatrix.Setup.SetOrientation = function () { function e(t) { be(this, e), this.direction = t } return ye(e, [{ key: "toString", value: function () { return "@" + this.direction } }]), e }(), Ce.Command.Xymatrix.Setup.AddModifier = function () { function e(t) { be(this, e), this.modifier = t } return ye(e, [{ key: "toString", value: function () { return "@*" + this.modifier } }]), e }(), Ce.Command.Xymatrix.Row = function () { function e(t) { be(this, e), this.entries = t } return ye(e, [{ key: "toString", value: function () { return this.entries.mkString(" & ") } }]), e }(), Ce.Command.Xymatrix.Entry = function e() { be(this, e) }, Ce.Command.Xymatrix.Entry.SimpleEntry = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { var a; return be(this, n), (a = t.call(this)).modifiers = e, a.objectbox = r, a.decor = i, a } return ye(n, [{ key: "isEmpty", get: function () { return !1 } }, { key: "toString", value: function () { return this.modifiers.mkString("**{", "", "}") + " " + this.objectbox + " " + this.decor } }]), n }(Ce.Command.Xymatrix.Entry), Ce.Command.Xymatrix.Entry.ObjectEntry = function (e) { ve(n, e); var t = ge(n); function n(e, r, i) { var a; return be(this, n), (a = t.call(this)).object = e, a.pos = r, a.decor = i, a } return ye(n, [{ key: "isEmpty", get: function () { return !1 } }, { key: "toString", value: function () { return "*" + this.object + " " + this.pos + " " + this.decor } }]), n }(Ce.Command.Xymatrix.Entry), Ce.Command.Xymatrix.Entry.EmptyEntry = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).decor = e, r } return ye(n, [{ key: "isEmpty", get: function () { return !0 } }, { key: "toString", value: function () { return "" + this.decor } }]), n }(Ce.Command.Xymatrix.Entry), Ce.Command.Twocell = function () { function e(t, n, r) { be(this, e), this.twocell = t, this.switches = n, this.arrow = r } return ye(e, [{ key: "toString", value: function () { return this.twocell.toString() + this.switches.mkString("") + this.arrow } }]), e }(), Ce.Command.Twocell.Hops2cell = function e(t, n) { be(this, e), this.hops = t, this.maybeDisplace = n }, Ce.Command.Twocell.Twocell = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "\\xtwocell[" + this.hops + "]" + this.maybeDisplace.getOrElse("{}") } }]), n }(Ce.Command.Twocell.Hops2cell), Ce.Command.Twocell.UpperTwocell = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "\\xuppertwocell[" + this.hops + "]" + this.maybeDisplace.getOrElse("{}") } }]), n }(Ce.Command.Twocell.Hops2cell), Ce.Command.Twocell.LowerTwocell = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "\\xlowertwocell[" + this.hops + "]" + this.maybeDisplace.getOrElse("{}") } }]), n }(Ce.Command.Twocell.Hops2cell), Ce.Command.Twocell.CompositeMap = function (e) { ve(n, e); var t = ge(n); function n(e, r) { return be(this, n), t.call(this, e, r) } return ye(n, [{ key: "toString", value: function () { return "\\xcompositemap[" + this.hops + "]" + this.maybeDisplace.getOrElse("{}") } }]), n }(Ce.Command.Twocell.Hops2cell), Ce.Command.Twocell.Switch = function e() { be(this, e) }, Ce.Command.Twocell.Switch.UpperLabel = function () { function e(t) { be(this, e), this.label = t } return ye(e, [{ key: "toString", value: function () { return "^" + this.label } }]), e }(), Ce.Command.Twocell.Switch.LowerLabel = function () { function e(t) { be(this, e), this.label = t } return ye(e, [{ key: "toString", value: function () { return "_" + this.label } }]), e }(), Ce.Command.Twocell.Switch.SetCurvature = function () { function e(t) { be(this, e), this.nudge = t } return ye(e, [{ key: "toString", value: function () { return this.nudge.toString() } }]), e }(), Ce.Command.Twocell.Switch.DoNotSetCurvedArrows = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "\\omit" } }]), e }(), Ce.Command.Twocell.Switch.PlaceModMapObject = function () { function e() { be(this, e) } return ye(e, [{ key: "toString", value: function () { return "~!" } }]), e }(), Ce.Command.Twocell.Switch.ChangeHeadTailObject = function () { function e(t, n) { be(this, e), this.what = t, this.object = n } return ye(e, [{ key: "toString", value: function () { return "~" + this.what + "{" + this.object + "}" } }]), e }(), Ce.Command.Twocell.Switch.ChangeCurveObject = function () { function e(t, n, r) { be(this, e), this.what = t, this.spacer = n, this.maybeObject = r } return ye(e, [{ key: "toString", value: function () { return "~" + this.what + "{" + this.spacer + (this.maybeObject.isDefined ? "~**" + this.maybeObject.get : "") + "}" } }]), e }(), Ce.Command.Twocell.Label = function () { function e(t, n) { be(this, e), this.maybeNudge = t, this.labelObject = n } return ye(e, [{ key: "toString", value: function () { return this.maybeNudge.toString() + this.labelObject } }]), e }(), Ce.Command.Twocell.Nudge = function e() { be(this, e) }, Ce.Command.Twocell.Nudge.Number = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).number = e, r } return ye(n, [{ key: "toString", value: function () { return "<" + this.number + ">" } }]), n }(Ce.Command.Twocell.Nudge), Ce.Command.Twocell.Nudge.Omit = function (e) { ve(n, e); var t = ge(n); function n() { return be(this, n), t.call(this) } return ye(n, [{ key: "toString", value: function () { return "<\\omit>" } }]), n }(Ce.Command.Twocell.Nudge), Ce.Command.Twocell.Arrow = function e() { be(this, e) }, Ce.Command.Twocell.Arrow.WithOrientation = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).tok = e, i.labelObject = r, i } return ye(n, [{ key: "toString", value: function () { return "{[" + this.tok + "] " + this.labelObject + "}" } }]), n }(Ce.Command.Twocell.Arrow), Ce.Command.Twocell.Arrow.WithPosition = function (e) { ve(n, e); var t = ge(n); function n(e, r) { var i; return be(this, n), (i = t.call(this)).nudge = e, i.labelObject = r, i } return ye(n, [{ key: "toString", value: function () { return "{[" + this.nudge + "] " + this.labelObject + "}" } }]), n }(Ce.Command.Twocell.Arrow), Ce.Command.Newdir = function () { function e(t, n) { be(this, e), this.dirMain = t, this.compositeObject = n } return ye(e, [{ key: "toString", value: function () { return "\\newdir{" + this.dirMain + "}{" + this.compositeObject + "}" } }]), e }(), Ce.Pos.Xyimport = function e() { be(this, e) }, Ce.Pos.Xyimport.TeXCommand = function (e) { ve(n, e); var t = ge(n); function n(e, r, i, a, o) { var u; return be(this, n), (u = t.call(this)).width = e, u.height = r, u.xOffset = i, u.yOffset = a, u.graphics = o, u } return ye(n, [{ key: "toString", value: function () { return "\\xyimport(" + this.width + ", " + this.height + ")(" + this.xOffset + ", " + this.yOffset + "){" + this.graphics + "}" } }]), n }(Ce.Pos.Xyimport), Ce.Pos.Xyimport.Graphics = function (e) { ve(n, e); var t = ge(n); function n(e, r, i, a, o) { var u; return be(this, n), (u = t.call(this)).width = e, u.height = r, u.xOffset = i, u.yOffset = a, u.graphics = o, u } return ye(n, [{ key: "toString", value: function () { return "\\xyimport(" + this.width + ", " + this.height + ")(" + this.xOffset + ", " + this.yOffset + "){" + this.graphics + "}" } }]), n }(Ce.Pos.Xyimport), Ce.Command.Includegraphics = function () { function e(t, n, r) { be(this, e), this.isClipped = t, this.attributeList = n, this.filepath = r } return ye(e, [{ key: "isIncludegraphics", get: function () { return !0 } }, { key: "toString", value: function () { return "\\includegraphics" + (this.isClipped ? "*" : "") + this.attributeList.mkString("[", ",", "]") + "{" + this.filepath + "}" } }]), e }(), Ce.Command.Includegraphics.Attr = function e() { be(this, e) }, Ce.Command.Includegraphics.Attr.Width = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).dimen = e, r } return ye(n, [{ key: "toString", value: function () { return "width=" + this.dimen } }]), n }(Ce.Command.Includegraphics.Attr), Ce.Command.Includegraphics.Attr.Height = function (e) { ve(n, e); var t = ge(n); function n(e) { var r; return be(this, n), (r = t.call(this)).dimen = e, r } return ye(n, [{ key: "toString", value: function () { return "height=" + this.dimen } }]), n }(Ce.Command.Includegraphics.Attr); var Me = $.fun, Pe = $.elem, Be = function (e) { return Me($.elem(e)) }, Oe = $.literal, Ee = $.regex, Ae = $.regexLiteral, Le = function (e) { return Me($.literal(e)) }, je = $.seq, De = $.or, Te = function (e) { return $.lazyParser(e)().rep() }, Re = function (e) { return $.lazyParser(e)().rep1() }, Fe = function (e) { return $.lazyParser(e)().opt() }, Ge = $.success, Ve = function (e) { return function () { var t = e.memo; return void 0 === t && (t = e.memo = e()), t } }, _e = new $, Ie = { xy: Ve((function () { return _e.posDecor().to((function (e) { return e })) })), xybox: Ve((function () { return Oe("{").andr(_e.posDecor).andl(Le("}")).to((function (e) { return e })) })), xymatrixbox: Ve((function () { return _e.xymatrix().to((function (e) { return new Ce.PosDecor(new Ce.Pos.Coord(new Ce.Coord.C, L.empty), new Ce.Decor(L.empty.append(e))) })) })), posDecor: Ve((function () { return je(_e.pos, _e.decor).to((function (e) { return new Ce.PosDecor(e.head, e.tail) })) })), pos: Ve((function () { return je(_e.coord, Te(_e.pos2)).to((function (e) { return new Ce.Pos.Coord(e.head, e.tail) })) })), nonemptyPos: Ve((function () { return De(je(_e.nonemptyCoord, Te(_e.pos2)), je(_e.coord, Re(_e.pos2))).to((function (e) { return new Ce.Pos.Coord(e.head, e.tail) })) })), pos2: Ve((function () { return De(Oe("+").andr(_e.coord).to((function (e) { return new Ce.Pos.Plus(e) })), Oe("-").andr(_e.coord).to((function (e) { return new Ce.Pos.Minus(e) })), Oe("!").andr(_e.coord).to((function (e) { return new Ce.Pos.Skew(e) })), Oe(".").andr(_e.coord).to((function (e) { return new Ce.Pos.Cover(e) })), Oe(",").andr(_e.coord).to((function (e) { return new Ce.Pos.Then(e) })), Oe(";").andr(_e.coord).to((function (e) { return new Ce.Pos.SwapPAndC(e) })), Oe("::").andr(_e.coord).to((function (e) { return new Ce.Pos.SetYBase(e) })), Oe(":").andr(_e.coord).to((function (e) { return new Ce.Pos.SetBase(e) })), Oe("**").andr(_e.object).to((function (e) { return new Ce.Pos.ConnectObject(e) })), Oe("*").andr(_e.object).to((function (e) { return new Ce.Pos.DropObject(e) })), Oe("?").andr(_e.place).to((function (e) { return new Ce.Pos.Place(e) })), Oe("@+").andr(_e.coord).to((function (e) { return new Ce.Pos.PushCoord(e) })), Oe("@-").andr(_e.coord).to((function (e) { return new Ce.Pos.EvalCoordThenPop(e) })), Oe("@=").andr(_e.coord).to((function (e) { return new Ce.Pos.LoadStack(e) })), Oe("@@").andr(_e.coord).to((function (e) { return new Ce.Pos.DoCoord(e) })), Oe("@i").to((function () { return new Ce.Pos.InitStack })), Oe("@(").to((function () { return new Ce.Pos.EnterFrame })), Oe("@)").to((function () { return new Ce.Pos.LeaveFrame })), Oe("=:").andr(Le('"')).andr(_e.id).andl(Be('"')).to((function (e) { return new Ce.Pos.SaveBase(e) })), Oe("=@").andr(Le('"')).andr(_e.id).andl(Be('"')).to((function (e) { return new Ce.Pos.SaveStack(e) })), Oe("=").andr(Le('"')).andr(_e.id).andl(Be('"')).to((function (e) { return new Ce.Pos.SavePos(e) })), Oe("=").andr(_e.nonemptyCoord).andl(Le('"')).and(_e.id).andl(Be('"')).to((function (e) { return new Ce.Pos.SaveMacro(e.head, e.tail) })), _e.xyimport) })), coord: Ve((function () { return De(_e.nonemptyCoord, Ge("empty").to((function () { return new Ce.Coord.C }))) })), nonemptyCoord: Ve((function () { return De(Oe("c").to((function () { return new Ce.Coord.C })), Oe("p").to((function () { return new Ce.Coord.P })), Oe("x").to((function () { return new Ce.Coord.X })), Oe("y").to((function () { return new Ce.Coord.Y })), _e.vector().to((function (e) { return new Ce.Coord.Vector(e) })), Oe('"').andr(_e.id).andl(Be('"')).to((function (e) { return new Ce.Coord.Id(e) })), Oe("{").andr(_e.posDecor).andl(Le("}")).to((function (e) { return new Ce.Coord.Group(e) })), Oe("s").andr(Me(Ae(/^\d/))).to((function (e) { return new Ce.Coord.StackPosition(parseInt(e)) })), Oe("s").andr(Le("{")).and(_e.nonnegativeNumber).andl(Le("}")).to((function (e) { return new Ce.Coord.StackPosition(e) })), Oe("[").andr(Me(Fe(Oe('"').andr(_e.id).andl(Be('"'))).to((function (e) { return e.getOrElse("") })))).and(_e.number).andl(Le(",")).and(_e.number).andl(Le("]")).to((function (e) { return new Ce.Coord.DeltaRowColumn(e.head.head, e.head.tail, e.tail) })), Oe("[").andr(Me(Fe(Oe('"').andr(_e.id).andl(Be('"'))).to((function (e) { return e.getOrElse("") })))).and(Me(Te(Ee(/^[lrud]/)))).andl(Le("]")).to((function (e) { return new Ce.Coord.Hops(e.head, e.tail) })), Oe("[").andr(Me(Fe(Oe('"').andr(_e.id).andl(Be('"'))).to((function (e) { return e.getOrElse("") })))).and(Me(Re(Ee(/^[lrud]/)))).and(_e.place).andl(Le("]")).to((function (e) { return new Ce.Coord.DeltaRowColumn(e.head.head, e.head.tail, new Ce.Pos.Place(e.tail)) }))) })), vector: Ve((function () { return De(Oe("(").andr(_e.factor).andl(Le(",")).and(_e.factor).andl(Le(")")).to((function (e) { return new Ce.Vector.InCurBase(e.head, e.tail) })), Oe("<").andr(_e.dimen).andl(Le(",")).and(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Vector.Abs(e.head, e.tail) })), Oe("<").andr(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Vector.Abs(e, e) })), Oe("a").andr(Le("(")).andr(_e.number).andl(Le(")")).to((function (e) { return new Ce.Vector.Angle(e) })), Oe("/").andr(_e.direction).and(_e.looseDimen).andl(Le("/")).to((function (e) { return new Ce.Vector.Dir(e.head, e.tail) })), Oe("0").to((function (e) { return new Ce.Vector.Abs("0mm", "0mm") })), (function () { return _e.corner().and(Me($.opt(Me(Oe("(").andr(_e.factor).andl(Le(")")))).to((function (e) { return e.getOrElse(1) })))).to((function (e) { return new Ce.Vector.Corner(e.head, e.tail) })) })) })), corner: Ve((function () { return De(Ae(/^(CL|LC)/).to((function () { return new Ce.Corner.CL })), Ae(/^(CR|RC)/).to((function () { return new Ce.Corner.CR })), Ae(/^(CD|DC)/).to((function () { return new Ce.Corner.CD })), Ae(/^(CU|UC)/).to((function () { return new Ce.Corner.CU })), Ae(/^(LD|DL)/).to((function () { return new Ce.Corner.LD })), Ae(/^(RD|DR)/).to((function () { return new Ce.Corner.RD })), Ae(/^(LU|UL)/).to((function () { return new Ce.Corner.LU })), Ae(/^(RU|UR)/).to((function () { return new Ce.Corner.RU })), Oe("L").to((function () { return new Ce.Corner.L })), Oe("R").to((function () { return new Ce.Corner.R })), Oe("D").to((function () { return new Ce.Corner.D })), Oe("U").to((function () { return new Ce.Corner.U })), Oe("E").to((function () { return new Ce.Corner.NearestEdgePoint })), Oe("P").to((function () { return new Ce.Corner.PropEdgePoint })), Oe("A").to((function () { return new Ce.Corner.Axis }))) })), place: Ve((function () { return De(Oe("<").andr(_e.place).to((function (e) { return new Ce.Place(1, 0, void 0, void 0).compound(e) })), Oe(">").andr(_e.place).to((function (e) { return new Ce.Place(0, 1, void 0, void 0).compound(e) })), Oe("(").andr(_e.factor).andl(Le(")")).and(_e.place).to((function (e) { return new Ce.Place(0, 0, new Ce.Place.Factor(e.head), void 0).compound(e.tail) })), Oe("!").andr(Le("{")).andr(_e.pos).andl(Le("}")).and(_e.slide).to((function (e) { return new Ce.Place(0, 0, new Ce.Place.Intercept(e.head), e.tail) })), (function () { return _e.slide().to((function (e) { return new Ce.Place(0, 0, void 0, e) })) })) })), slide: Ve((function () { return De(Oe("/").andr(_e.dimen).andl(Le("/")).to((function (e) { return new Ce.Slide(new g.Some(e)) })), Ge("no slide").to((function () { return new Ce.Slide(g.empty) }))) })), factor: Ve(Me(Ae(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to((function (e) { return parseFloat(e) })))), number: Ve(Me(Ae(/^[+\-]?\d+/).to((function (e) { return parseInt(e) })))), nonnegativeNumber: Ve(Me(Ae(/^\d+/).to((function (e) { return parseInt(e) })))), unit: Ve(Me(Ae(/^(em|ex|px|pt|pc|in|cm|mm|mu)/).to((function (e) { return e })))), dimen: Ve((function () { return _e.factor().and(_e.unit).to((function (e) { return e.head.toString() + e.tail })) })), looseDimen: Ve((function () { return _e.looseFactor().and(_e.unit).to((function (e) { return e.head.toString() + e.tail })) })), looseFactor: Ve(Me(De(Ae(/^(\d \d*(\.\d*))/).to((function (e) { return parseFloat(e.replace(/ /, "")) })), Ae(/^[+\-]?(\d+(\.\d*)?|\d*\.\d+)/).to((function (e) { return parseFloat(e) }))))), id: Ve(Me(Ee(/^[^"]+/))), object: Ve((function () { return De(Te(_e.modifier).and(_e.objectbox).to((function (e) { return new Ce.Object(e.head, e.tail) }))) })), objectbox: Ve((function () { return De(_e.mathText, Oe("@").andr(_e.dir), Oe("\\dir").andr(_e.dir), Oe("\\cir").andr(_e.cirRadius).andl(Le("{")).and(_e.cir).andl(Le("}")).to((function (e) { return new Ce.ObjectBox.Cir(e.head, e.tail) })), Oe("\\frm").andr(_e.frameRadius).andl(Le("{")).and(_e.frameMain).andl(Le("}")).to((function (e) { return new Ce.ObjectBox.Frame(e.head, e.tail) })), Oe("\\object").andr(_e.object).to((function (e) { return new Ce.ObjectBox.WrapUpObject(e) })), Oe("\\composite").and(Le("{")).andr(_e.compositeObject).andl(Le("}")).to((function (e) { return new Ce.ObjectBox.CompositeObject(e) })), Oe("\\xybox").and(Le("{")).andr(_e.posDecor).andl(Le("}")).to((function (e) { return new Ce.ObjectBox.Xybox(e) })), Oe("\\xymatrix").andr(_e.xymatrix).to((function (e) { return new Ce.ObjectBox.Xymatrix(e) })), _e.txt, _e.curve, Ee(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)/).andl(Le("{")).and(_e.text).andl(Le("}")).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return _e.toMath(t.head + "{" + t.tail + "}", n) }))) })), compositeObject: Ve((function () { return _e.object().and(Me(Te(Oe("*").andr(_e.object)))).to((function (e) { return e.tail.prepend(e.head) })) })), mathText: Ve((function () { return Oe("{").andr(_e.text).andl(Be("}")).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return _e.toMath("\\hbox{$\\objectstyle{" + t + "}$}", n) })) })), toMath: function (e, t) { var n = t(e); return new Ce.ObjectBox.Text(n) }, textNodeCreator: Ve((function () { return new $.Parser((function (e) { return new $.Success(e.context.createTextNode, e) })) })), text: Ve((function () { return Ee(/^[^{}\\%]*/).and((function () { return De(Ee(/^(\\\{|\\\}|\\%|\\)/).to((function (e) { return e })), Pe("{").andr(_e.text).andl(Be("}")).to((function (e) { return "{" + e + "}" })), Ee(/^%[^\r\n]*(\r\n|\r|\n)?/).to((function (e) { return " " }))).and(Me(Ee(/^[^{}\\%]*/))).rep().to((function (e) { var t = ""; return e.foreach((function (e) { t += e.head + e.tail })), t })) })).to((function (e) { return e.head + e.tail })) })), txt: Ve((function () { return Oe("\\txt").andr(_e.txtWidth).and(Me(Ee(/^(\\[a-zA-Z@][a-zA-Z0-9@]+)?/))).andl(Le("{")).and(_e.text).andl(Le("}")).and(_e.textNodeCreator).to((function (e) { var t, n = e.head, r = e.tail, i = n.head.head, a = n.head.tail, o = n.tail, u = o.split("\\\\"); if (u.length <= 1) t = a + "{\\hbox{" + o + "}}"; else { t = "\\hbox{$\\begin{array}{c}\n"; for (var s = 0; s < u.length; s++)t += a + "{\\hbox{" + u[s].replace(/(^[\r\n\s]+)|([\r\n\s]+$)/g, "") + "}}", s != u.length - 1 && (t += "\\\\\n"); t += "\\end{array}$}" } return new Ce.ObjectBox.Txt(i, _e.toMath(t, r)) })) })), txtWidth: Ve((function () { return De(Oe("<").andr(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Vector.Abs(e, e) })).to((function (e) { return new Ce.ObjectBox.Txt.Width.Vector(e) })), Ge("default").to((function () { return new Ce.ObjectBox.Txt.Width.Default }))) })), dir: Ve((function () { return Ae(/^[\^_0123]/).opt().andl(Le("{")).and(_e.dirMain).andl(Le("}")).to((function (e) { return new Ce.ObjectBox.Dir(e.head.getOrElse(""), e.tail) })) })), dirMain: Ve((function () { return Ee(/^(-|\.|~|>|<|\(|\)|`|'|\||\*|\+|x|\/|o|=|:|[a-zA-Z@ ])+/).opt().to((function (e) { return e.getOrElse("") })) })), cirRadius: Ve((function () { return De(_e.vector().to((function (e) { return new Ce.ObjectBox.Cir.Radius.Vector(e) })), Ge("default").to((function () { return new Ce.ObjectBox.Cir.Radius.Default }))) })), frameRadius: Ve((function () { return De(_e.frameRadiusVector().to((function (e) { return new Ce.ObjectBox.Frame.Radius.Vector(e) })), Ge("default").to((function () { return new Ce.ObjectBox.Frame.Radius.Default }))) })), frameRadiusVector: Ve((function () { return De(Oe("<").andr(_e.dimen).andl(Le(",")).and(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Vector.Abs(e.head, e.tail) })), Oe("<").andr(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Vector.Abs(e, e) }))) })), frameMain: Ve((function () { return Ee(/^(((_|\^)?(\\\{|\\\}|\(|\)))|[\-=oe,\.\*]*)/) })), cir: Ve((function () { return De(_e.nonemptyCir, Ge("full").to((function () { return new Ce.ObjectBox.Cir.Cir.Full }))) })), nonemptyCir: Ve((function () { return _e.diag().and(Me(Ae(/^[_\^]/))).and(_e.diag).to((function (e) { return new Ce.ObjectBox.Cir.Cir.Segment(e.head.head, e.head.tail, e.tail) })) })), curve: Ve((function () { return Oe("\\crv").andr(_e.curveModifier).andl(Le("{")).and(_e.curveObject).and(_e.curvePoslist).andl(Le("}")).to((function (e) { return new Ce.ObjectBox.Curve(e.head.head, e.head.tail, e.tail) })) })), curveModifier: Ve((function () { return Te(Me(Oe("~").andr(_e.curveOption))) })), curveOption: Ve((function () { return De(Oe("p").to((function () { return new Ce.ObjectBox.Curve.Modifier.p })), Oe("P").to((function () { return new Ce.ObjectBox.Curve.Modifier.P })), Oe("l").to((function () { return new Ce.ObjectBox.Curve.Modifier.l })), Oe("L").to((function () { return new Ce.ObjectBox.Curve.Modifier.L })), Oe("c").to((function () { return new Ce.ObjectBox.Curve.Modifier.c })), Oe("C").to((function () { return new Ce.ObjectBox.Curve.Modifier.C })), Oe("pc").to((function () { return new Ce.ObjectBox.Curve.Modifier.pc })), Oe("pC").to((function () { return new Ce.ObjectBox.Curve.Modifier.pC })), Oe("Pc").to((function () { return new Ce.ObjectBox.Curve.Modifier.Pc })), Oe("PC").to((function () { return new Ce.ObjectBox.Curve.Modifier.PC })), Oe("lc").to((function () { return new Ce.ObjectBox.Curve.Modifier.lc })), Oe("lC").to((function () { return new Ce.ObjectBox.Curve.Modifier.lC })), Oe("Lc").to((function () { return new Ce.ObjectBox.Curve.Modifier.Lc })), Oe("LC").to((function () { return new Ce.ObjectBox.Curve.Modifier.LC })), Oe("cC").to((function () { return new Ce.ObjectBox.Curve.Modifier.cC }))) })), curveObject: Ve((function () { return Te(De(Oe("~*").andr(_e.object).to((function (e) { return new Ce.ObjectBox.Curve.Object.Drop(e) })), Oe("~**").andr(_e.object).to((function (e) { return new Ce.ObjectBox.Curve.Object.Connect(e) })))) })), curvePoslist: Ve((function () { return De(Oe("&").andr(_e.curvePoslist2).to((function (e) { return e.prepend(new Ce.ObjectBox.Curve.PosList.CurPos) })), Oe("~@").andr(Le("&")).andr(_e.curvePoslist2).to((function (e) { return e.prepend(new Ce.ObjectBox.Curve.PosList.AddStack) })), Oe("~@").to((function () { return L.empty.prepend(new Ce.ObjectBox.Curve.PosList.AddStack) })), _e.pos().andl(Le("&")).and(_e.curvePoslist2).to((function (e) { return e.tail.prepend(new Ce.ObjectBox.Curve.PosList.Pos(e.head)) })), _e.nonemptyPos().to((function (e) { return L.empty.prepend(new Ce.ObjectBox.Curve.PosList.Pos(e)) })), Ge("empty").to((function () { return L.empty }))) })), curvePoslist2: Ve((function () { return De(Oe("&").andr(_e.curvePoslist2).to((function (e) { return e.prepend(new Ce.ObjectBox.Curve.PosList.CurPos) })), Oe("~@").andr(Le("&")).andr(_e.curvePoslist2).to((function (e) { return e.prepend(new Ce.ObjectBox.Curve.PosList.AddStack) })), Oe("~@").to((function () { return L.empty.prepend(new Ce.ObjectBox.Curve.PosList.AddStack) })), _e.nonemptyPos().andl(Le("&")).and(_e.curvePoslist2).to((function (e) { return e.tail.prepend(new Ce.ObjectBox.Curve.PosList.Pos(e.head)) })), _e.nonemptyPos().to((function (e) { return L.empty.prepend(new Ce.ObjectBox.Curve.PosList.Pos(e)) })), Ge("empty").to((function () { return L.empty.prepend(new Ce.ObjectBox.Curve.PosList.CurPos) }))) })), modifier: Ve((function () { return De(Oe("!").andr(_e.vector).to((function (e) { return new Ce.Modifier.Vector(e) })), Oe("!").to((function (e) { return new Ce.Modifier.RestoreOriginalRefPoint })), Oe("[").andr(_e.shape).andl(Le("]")).to((function (e) { return e })), Oe("i").to((function (e) { return new Ce.Modifier.Invisible })), Oe("h").to((function (e) { return new Ce.Modifier.Hidden })), _e.addOp().and(_e.size).to((function (e) { return new Ce.Modifier.AddOp(e.head, e.tail) })), _e.nonemptyDirection().to((function (e) { return new Ce.Modifier.Direction(e) }))) })), addOp: Ve((function () { return De(Oe("+=").to((function () { return new Ce.Modifier.AddOp.GrowTo })), Oe("-=").to((function () { return new Ce.Modifier.AddOp.ShrinkTo })), Oe("+").to((function () { return new Ce.Modifier.AddOp.Grow })), Oe("-").to((function () { return new Ce.Modifier.AddOp.Shrink })), Oe("=").to((function () { return new Ce.Modifier.AddOp.Set }))) })), size: Ve((function () { return De((function () { return _e.vector().to((function (e) { return new Ce.Modifier.AddOp.VactorSize(e) })) }), Ge("default size").to((function () { return new Ce.Modifier.AddOp.DefaultSize }))) })), shape: Ve((function () { return De(Oe(".").to((function () { return new Ce.Modifier.Shape.Point })), _e.frameShape, _e.alphabets().to((function (e) { return new Ce.Modifier.Shape.Alphabets(e) })), Oe("=").andr(_e.alphabets).to((function (e) { return new Ce.Modifier.Shape.DefineShape(e) })), Ge("rect").to((function () { return new Ce.Modifier.Shape.Rect }))) })), frameShape: Ve((function () { return Oe("F").andr(_e.frameMain).and(Me(Te(Oe(":").andr(Me(De(_e.frameRadiusVector().to((function (e) { return new Ce.Modifier.Shape.Frame.Radius(e) })), _e.colorName().to((function (e) { return new Ce.Modifier.Shape.Frame.Color(e) })))))))).to((function (e) { var t = e.head; return "" === t && (t = "-"), new Ce.Modifier.Shape.Frame(t, e.tail) })) })), alphabets: Ve((function () { return Ee(/^([a-zA-Z]+)/) })), colorName: Ve((function () { return Ee(/^([a-zA-Z][a-zA-Z0-9]*)/) })), direction: Ve((function () { return je(_e.direction0, Te(_e.direction1)).to((function (e) { return new Ce.Direction.Compound(e.head, e.tail) })) })), direction0: Ve((function () { return De(_e.direction2, _e.diag().to((function (e) { return new Ce.Direction.Diag(e) }))) })), direction1: Ve((function () { return De(Oe(":").andr(_e.vector).to((function (e) { return new Ce.Direction.RotVector(e) })), Oe("_").to((function (e) { return new Ce.Direction.RotAntiCW })), Oe("^").to((function (e) { return new Ce.Direction.RotCW }))) })), direction2: Ve((function () { return De(Oe("v").andr(_e.vector).to((function (e) { return new Ce.Direction.Vector(e) })), Oe("q").andr(Le("{")).andr(_e.posDecor).andl(Le("}")).to((function (e) { return new Ce.Direction.ConstructVector(e) }))) })), nonemptyDirection: Ve((function () { return De(je(_e.nonemptyDirection0, Te(_e.direction1)), je(_e.direction0, Re(_e.direction1))).to((function (e) { return new Ce.Direction.Compound(e.head, e.tail) })) })), nonemptyDirection0: Ve((function () { return De(_e.direction2, _e.nonemptyDiag().to((function (e) { return new Ce.Direction.Diag(e) }))) })), diag: Ve((function () { return De(_e.nonemptyDiag, Ge("empty").to((function (e) { return new Ce.Diag.Default }))) })), nonemptyDiag: Ve((function () { return De(Ae(/^(ld|dl)/).to((function (e) { return new Ce.Diag.LD })), Ae(/^(rd|dr)/).to((function (e) { return new Ce.Diag.RD })), Ae(/^(lu|ul)/).to((function (e) { return new Ce.Diag.LU })), Ae(/^(ru|ur)/).to((function (e) { return new Ce.Diag.RU })), Oe("l").to((function (e) { return new Ce.Diag.L })), Oe("r").to((function (e) { return new Ce.Diag.R })), Oe("d").to((function (e) { return new Ce.Diag.D })), Oe("u").to((function (e) { return new Ce.Diag.U }))) })), decor: Ve((function () { return _e.command().rep().to((function (e) { return new Ce.Decor(e) })) })), command: Ve((function () { return De(Oe("\\ar").andr(Me(Te(_e.arrowForm))).and(_e.path).to((function (e) { return new Ce.Command.Ar(e.head, e.tail) })), Oe("\\xymatrix").andr(_e.xymatrix), Oe("\\PATH").andr(_e.path).to((function (e) { return new Ce.Command.Path(e) })), Oe("\\afterPATH").andr(Le("{")).andr(_e.decor).andl(Le("}")).and(_e.path).to((function (e) { return new Ce.Command.AfterPath(e.head, e.tail) })), Oe("\\save").andr(_e.pos).to((function (e) { return new Ce.Command.Save(e) })), Oe("\\restore").to((function () { return new Ce.Command.Restore })), Oe("\\POS").andr(_e.pos).to((function (e) { return new Ce.Command.Pos(e) })), Oe("\\afterPOS").andr(Le("{")).andr(_e.decor).andl(Le("}")).and(_e.pos).to((function (e) { return new Ce.Command.AfterPos(e.head, e.tail) })), Oe("\\drop").andr(_e.object).to((function (e) { return new Ce.Command.Drop(e) })), Oe("\\connect").andr(_e.object).to((function (e) { return new Ce.Command.Connect(e) })), Oe("\\relax").to((function () { return new Ce.Command.Relax })), Oe("\\xyignore").andr(Le("{")).andr(_e.pos).and(_e.decor).andl(Le("}")).to((function (e) { return new Ce.Command.Ignore(e.head, e.tail) })), Oe("\\xyshowAST").andr(Le("{")).andr(_e.pos).and(_e.decor).andl(Le("}")).to((function (e) { return new Ce.Command.ShowAST(e.head, e.tail) })), _e.twocellCommand) })), arrowForm: Ve((function () { return De(Oe("@").andr(Me(Ee(/^([\-\.~=:])/))).to((function (e) { return new Ce.Command.Ar.Form.ChangeStem(e) })), Oe("@").andr(Le("!")).to((function (e) { return new Ce.Command.Ar.Form.DashArrowStem })), Oe("@").andr(Le("/")).andr(_e.direction).and(Me(Fe(_e.looseDimen))).andl(Le("/")).to((function (e) { return new Ce.Command.Ar.Form.CurveArrow(e.head, e.tail.getOrElse(".5pc")) })), Oe("@").andr(Le("(")).andr(_e.direction).andl(Le(",")).and(_e.direction).andl(Le(")")).to((function (e) { return new Ce.Command.Ar.Form.CurveFitToDirection(e.head, e.tail) })), Oe("@").andr(Le("`")).andr(_e.coord).to((function (e) { return new Ce.Command.Ar.Form.CurveWithControlPoints(e) })), Oe("@").andr(Le("[")).andr(_e.shape).andl(Le("]")).to((function (e) { return new Ce.Command.Ar.Form.AddShape(e) })), Oe("@").andr(Le("*")).andr(Le("{")).andr(Me(Te(_e.modifier))).andl(Le("}")).to((function (e) { return new Ce.Command.Ar.Form.AddModifiers(e) })), Oe("@").andr(Le("<")).andr(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Command.Ar.Form.Slide(e) })), Oe("|").andr(_e.anchor).and(_e.it).to((function (e) { return new Ce.Command.Ar.Form.LabelAt(e.head, e.tail) })), Oe("^").andr(_e.anchor).and(_e.it).to((function (e) { return new Ce.Command.Ar.Form.LabelAbove(e.head, e.tail) })), Oe("_").andr(_e.anchor).and(_e.it).to((function (e) { return new Ce.Command.Ar.Form.LabelBelow(e.head, e.tail) })), Oe("@").andr(Le("?")).to((function () { return new Ce.Command.Ar.Form.ReverseAboveAndBelow })), Oe("@").andr(Me(Ee(/^([\^_0123])/).opt())).and(Me(Fe(_e.tipConnTip))).to((function (e) { var t = e.head.getOrElse(""); if (e.tail.isDefined) { var n = e.tail.get; return new Ce.Command.Ar.Form.BuildArrow(t, n.tail, n.stem, n.head) } return new Ce.Command.Ar.Form.ChangeVariant(t) }))) })), tipConnTip: Ve((function () { return Oe("{").andr(Me(Fe(_e.nonemptyTip))).and(Me(Fe(_e.nonemptyConn))).and(Me(Fe(_e.nonemptyTip))).andl(Le("}")).to((function (e) { var t, n, r, i = e.head.head, a = e.head.tail, o = e.tail, u = new Ce.Command.Ar.Form.Tip.Tipchars(""); return a.isDefined || o.isDefined ? (t = i.getOrElse(u), n = a.getOrElse(new Ce.Command.Ar.Form.Conn.Connchars("")), r = o.getOrElse(u)) : i.isDefined ? (t = u, n = new Ce.Command.Ar.Form.Conn.Connchars("-"), r = i.getOrElse(u)) : (t = u, n = new Ce.Command.Ar.Form.Conn.Connchars(""), r = u), { tail: t, stem: n, head: r } })) })), nonemptyTip: Ve((function () { return De(Ee(/^([<>()|'`+\/a-zA-Z ]+)/).to((function (e) { return new Ce.Command.Ar.Form.Tip.Tipchars(e) })), Oe("*").andr(_e.object).to((function (e) { return new Ce.Command.Ar.Form.Tip.Object(e) })), _e.dir().to((function (e) { return new Ce.Command.Ar.Form.Tip.Dir(e) }))) })), nonemptyConn: Ve((function () { return De(Ee(/^([\-\.~=:]+)/).to((function (e) { return new Ce.Command.Ar.Form.Conn.Connchars(e) })), Oe("*").andr(_e.object).to((function (e) { return new Ce.Command.Ar.Form.Conn.Object(e) })), _e.dir().to((function (e) { return new Ce.Command.Ar.Form.Conn.Dir(e) }))) })), path: Ve((function () { return _e.path2(L.empty).to((function (e) { return new Ce.Command.Path.Path(e) })) })), path2: function (e) { var t = Ve((function () { return _e.path2(e) })); return De(_e.path3().and(t).to((function (e) { return e.tail.prepend(e.head) })), je("~", "{", t, "}").to((function (e) { return e.head.tail })).into((function (e) { return _e.path2(e) })), _e.segment().to((function (e) { return L.empty.prepend(new Ce.Command.Path.LastSegment(e)) })), Ge(e).to((function (e) { return e }))) }, path3: Ve((function () { return De(je("~", "=", "{", _e.posDecor, "}").to((function (e) { return new Ce.Command.Path.SetBeforeAction(e.head.tail) })), je("~", "/", "{", _e.posDecor, "}").to((function (e) { return new Ce.Command.Path.SetAfterAction(e.head.tail) })), je("~", "<", "{", _e.labels, "}").to((function (e) { return new Ce.Command.Path.AddLabelNextSegmentOnly(e.head.tail) })), je("~", ">", "{", _e.labels, "}").to((function (e) { return new Ce.Command.Path.AddLabelLastSegmentOnly(e.head.tail) })), je("~", "+", "{", _e.labels, "}").to((function (e) { return new Ce.Command.Path.AddLabelEverySegment(e.head.tail) })), je("'", _e.segment).to((function (e) { return new Ce.Command.Path.StraightSegment(e.tail) })), je("`", _e.turn, _e.segment).to((function (e) { return new Ce.Command.Path.TurningSegment(e.head.tail, e.tail) }))) })), turn: Ve((function () { return De(_e.nonemptyCir().and(_e.turnRadius).to((function (e) { return new Ce.Command.Path.Turn.Cir(e.head, e.tail) })), _e.diag().and(_e.turnRadius).to((function (e) { return new Ce.Command.Path.Turn.Diag(e.head, e.tail) }))) })), turnRadius: Ve((function () { return De(Oe("/").andr(_e.dimen).to((function (e) { return new Ce.Command.Path.TurnRadius.Dimen(e) })), Ge("default").to((function () { return new Ce.Command.Path.TurnRadius.Default }))) })), segment: Ve((function () { return _e.nonemptyPos().and(_e.pathSlide).and(_e.labels).to((function (e) { return new Ce.Command.Path.Segment(e.head.head, e.head.tail, e.tail) })) })), pathSlide: Ve((function () { return De(Oe("<").andr(_e.dimen).andl(Le(">")).to((function (e) { return new Ce.Slide(new g.Some(e)) })), Ge("no slide").to((function () { return new Ce.Slide(g.empty) }))) })), labels: Ve((function () { return _e.label().rep().to((function (e) { return new Ce.Command.Path.Labels(e) })) })), label: Ve((function () { return De(je("^", _e.anchor, _e.it, _e.alias).to((function (e) { return new Ce.Command.Path.Label.Above(new Ce.Pos.Place(e.head.head.tail), e.head.tail, e.tail) })), je("_", _e.anchor, _e.it, _e.alias).to((function (e) { return new Ce.Command.Path.Label.Below(new Ce.Pos.Place(e.head.head.tail), e.head.tail, e.tail) })), je("|", _e.anchor, _e.it, _e.alias).to((function (e) { return new Ce.Command.Path.Label.At(new Ce.Pos.Place(e.head.head.tail), e.head.tail, e.tail) }))) })), anchor: Ve((function () { return De(Oe("-").andr(_e.anchor).to((function (e) { return new Ce.Place(1, 1, new Ce.Place.Factor(.5), void 0).compound(e) })), _e.place) })), it: Ve((function () { return Te(Oe("[").andr(_e.shape).andl(Le("]")).to((function (e) { return e }))).and(_e.it2).to((function (e) { return new Ce.Object(e.head.concat(e.tail.modifiers), e.tail.object) })) })), it2: Ve((function () { return De(Ae(/^[0-9a-zA-Z]/).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return new Ce.Object(L.empty, _e.toMath("\\labelstyle " + t, n)) })), Ae(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return new Ce.Object(L.empty, _e.toMath("\\labelstyle " + t, n)) })), Oe("{").andr(_e.text).andl(Be("}")).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return new Ce.Object(L.empty, _e.toMath("\\labelstyle " + t, n)) })), Oe("*").andr(_e.object), Oe("@").andr(_e.dir).to((function (e) { return new Ce.Object(L.empty, e) }))) })), alias: Ve((function () { return je("=", '"', _e.id, '"').opt().to((function (e) { return e.map((function (e) { return e.head.tail })) })) })), xymatrix: Ve((function () { return _e.setup().andl(Le("{")).and(_e.rows).andl(Le("}")).to((function (e) { return new Ce.Command.Xymatrix(e.head, e.tail) })) })), setup: Ve((function () { return Te(Me(De(Oe('"').andr(Me(Ee(/^[^"]+/))).andl(Be('"')).to((function (e) { return new Ce.Command.Xymatrix.Setup.Prefix(e) })), Oe("@!").andr(Me(Ee(/^[RC]/).opt().to((function (e) { return e.getOrElse("") })))).and(Me(De(Pe("0").to((function () { return "0em" })), Pe("=").andr(_e.dimen)))).to((function (e) { var t = e.tail; switch (e.head) { case "R": return new Ce.Command.Xymatrix.Setup.PretendEntrySize.Height(t); case "C": return new Ce.Command.Xymatrix.Setup.PretendEntrySize.Width(t); default: return new Ce.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth(t) } })), Oe("@!").andr(Me(De(Pe("R").to((function () { return new Ce.Command.Xymatrix.Setup.FixGrid.Row })), Pe("C").to((function () { return new Ce.Command.Xymatrix.Setup.FixGrid.Column }))).opt().to((function (e) { return e.getOrElse(new Ce.Command.Xymatrix.Setup.FixGrid.RowAndColumn) })))), Oe("@").andr(Me(Ee(/^[MWHL]/))).and(_e.addOp).and(_e.dimen).to((function (e) { var t = e.head.tail, n = e.tail; switch (e.head.head) { case "M": return new Ce.Command.Xymatrix.Setup.AdjustEntrySize.Margin(t, n); case "W": return new Ce.Command.Xymatrix.Setup.AdjustEntrySize.Width(t, n); case "H": return new Ce.Command.Xymatrix.Setup.AdjustEntrySize.Height(t, n); case "L": return new Ce.Command.Xymatrix.Setup.AdjustLabelSep(t, n) } })), Oe("@").andr(_e.nonemptyDirection).to((function (e) { return new Ce.Command.Xymatrix.Setup.SetOrientation(e) })), Oe("@*[").andr(_e.shape).andl(Le("]")).to((function (e) { return new Ce.Command.Xymatrix.Setup.AddModifier(e) })), Oe("@*").andr(_e.addOp).and(_e.size).to((function (e) { return new Ce.Command.Xymatrix.Setup.AddModifier(new Ce.Modifier.AddOp(e.head, e.tail)) })), Oe("@").andr(Me(Ee(/^[RC]/).opt().to((function (e) { return e.getOrElse("") })))).and(_e.addOp).and(_e.dimen).to((function (e) { var t = e.head.tail, n = e.tail; switch (e.head.head) { case "R": return new Ce.Command.Xymatrix.Setup.ChangeSpacing.Row(t, n); case "C": return new Ce.Command.Xymatrix.Setup.ChangeSpacing.Column(t, n); default: return new Ce.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn(t, n) } })), Oe("@1").to((function () { return new Ce.Command.Xymatrix.Setup.AdjustEntrySize.Margin(new Ce.Modifier.AddOp.Set, "1pc") }))))) })), rows: Ve((function () { return _e.row().and(Me(Te(Oe("\\\\").andr(_e.row)))).to((function (e) { var t = e.tail.prepend(e.head); if (!t.isEmpty) { var n = t.at(t.length() - 1); 1 === n.entries.length() && n.entries.at(0).isEmpty && (t = t.reverse().tail.reverse()) } return t })) })), row: Ve((function () { return _e.entry().and(Me(Te(Oe("&").andr(_e.entry)))).to((function (e) { return new Ce.Command.Xymatrix.Row(e.tail.prepend(e.head)) })) })), entry: Ve((function () { return De(Oe("*").andr(_e.object).and(_e.pos).and(_e.decor).to((function (e) { var t = e.head.head, n = e.head.tail, r = e.tail; return new Ce.Command.Xymatrix.Entry.ObjectEntry(t, n, r) })), _e.entryModifier().rep().and(_e.looseObjectbox).and(_e.decor).to((function (e) { var t = e.head.head.foldLeft(L.empty, (function (e, t) { return t.concat(e) })), n = e.head.tail.isEmpty, r = e.head.tail.object, i = e.tail; return n && t.isEmpty ? new Ce.Command.Xymatrix.Entry.EmptyEntry(i) : new Ce.Command.Xymatrix.Entry.SimpleEntry(t, r, i) }))) })), entryModifier: Ve((function () { return De(Oe("**").andr(Le("[")).andr(_e.shape).andl(Le("]")).to((function (e) { return L.empty.append(e) })), Oe("**").andr(Le("{")).andr(Me(Te(_e.modifier))).andl(Le("}"))) })), looseObjectbox: Ve((function () { return De(_e.objectbox().to((function (e) { return { isEmpty: !1, object: e } })), Ee(/^[^\\{}%&]+/).opt().to((function (e) { return e.getOrElse("") })).and(Me(Te(De(Pe("{").andr(_e.text).andl(Be("}")).to((function (e) { return "{" + e + "}" })), Pe("\\").andr(Me((e = Ee(/^(\\|ar|xymatrix|PATH|afterPATH|save|restore|POS|afterPOS|drop|connect|xyignore|([lrud]+(twocell|uppertwocell|lowertwocell|compositemap))|xtwocell|xuppertwocell|xlowertwocell|xcompositemap)/), $.not($.lazyParser(e))))).andr(Me(Ee(/^[{}%&]/).opt().to((function (e) { return e.getOrElse("") })))).to((function (e) { return "\\" + e })), Ee(/^%[^\r\n]*(\r\n|\r|\n)?/).to((function (e) { return " " }))).and(Me(Ee(/^[^\\{}%&]+/).opt().to((function (e) { return e.getOrElse("") })))).to((function (e) { return e.head + e.tail }))).to((function (e) { return e.mkString("") })))).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail, r = t.head + t.tail; return { isEmpty: 0 === r.trim().length, object: _e.toMath("\\hbox{$\\objectstyle{" + r + "}$}", n) } }))); var e })), twocellCommand: Ve((function () { return _e.twocell().and(Me(Te(_e.twocellSwitch))).and(_e.twocellArrow).to((function (e) { return new Ce.Command.Twocell(e.head.head, e.head.tail, e.tail) })) })), twocell: Ve((function () { return De(Ae(/^\\[lrud]+twocell/).to((function (e) { var t = e.substring(1, e.length - "twocell".length); return new Ce.Command.Twocell.Twocell(t, g.empty) })), Ae(/^\\[lrud]+uppertwocell/).to((function (e) { var t = e.substring(1, e.length - "uppertwocell".length); return new Ce.Command.Twocell.UpperTwocell(t, g.empty) })), Ae(/^\\[lrud]+lowertwocell/).to((function (e) { var t = e.substring(1, e.length - "lowertwocell".length); return new Ce.Command.Twocell.LowerTwocell(t, g.empty) })), Ae(/^\\[lrud]+compositemap/).to((function (e) { var t = e.substring(1, e.length - "compositemap".length); return new Ce.Command.Twocell.CompositeMap(t, g.empty) })), De(Oe("\\xtwocell").to((function () { return Ce.Command.Twocell.Twocell })), Oe("\\xuppertwocell").to((function () { return Ce.Command.Twocell.UpperTwocell })), Oe("\\xlowertwocell").to((function () { return Ce.Command.Twocell.LowerTwocell })), Oe("\\xcompositemap").to((function () { return Ce.Command.Twocell.CompositeMap }))).andl(Le("[")).and(Me(Ee(/^[lrud]+/))).andl(Le("]")).andl(Le("{")).and(_e.text).andl(Le("}")).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail, r = new Ce.Object(L.empty, _e.toMath("\\labelstyle " + t.tail, n)); return new t.head.head(t.head.tail, new g.Some(r)) }))) })), twocellSwitch: Ve((function () { return De(Oe("^").andr(_e.twocellLabel).to((function (e) { return new Ce.Command.Twocell.Switch.UpperLabel(e) })), Oe("_").andr(_e.twocellLabel).to((function (e) { return new Ce.Command.Twocell.Switch.LowerLabel(e) })), Oe("\\omit").to((function () { return new Ce.Command.Twocell.Switch.DoNotSetCurvedArrows })), Oe("~!").to((function () { return new Ce.Command.Twocell.Switch.PlaceModMapObject })), Ae(/^(~[`'])/).andl(Le("{")).and(_e.object).andl(Le("}")).to((function (e) { var t = e.head.substring(1); return new Ce.Command.Twocell.Switch.ChangeHeadTailObject(t, e.tail) })), Ae(/^(~[\^_]?)/).andl(Le("{")).and(_e.object).and(Me(Fe(Oe("~**").andr(_e.object)))).andl(Le("}")).to((function (e) { var t = e.head.head.substring(1), n = e.head.tail, r = e.tail; return new Ce.Command.Twocell.Switch.ChangeCurveObject(t, n, r) })), _e.nudge().to((function (e) { return new Ce.Command.Twocell.Switch.SetCurvature(e) }))) })), twocellLabel: Ve((function () { return De(Ae(/^[0-9a-zA-Z]/).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail, r = new Ce.Object(L.empty, _e.toMath("\\twocellstyle " + t, n)); return new Ce.Command.Twocell.Label(g.empty, r) })), Ae(/^(\\[a-zA-Z][a-zA-Z0-9]*)/).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail, r = new Ce.Object(L.empty, _e.toMath("\\twocellstyle " + t, n)); return new Ce.Command.Twocell.Label(g.empty, r) })), Oe("{").andr(Me(Fe(_e.nudge))).andl(Le("*")).and(_e.object).andl(Le("}")).to((function (e) { return new Ce.Command.Twocell.Label(e.head, e.tail) })), Oe("{").andr(Me(Fe(_e.nudge))).and(_e.text).andl(Be("}")).and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail, r = new Ce.Object(L.empty, _e.toMath("\\twocellstyle " + t.tail, n)); return new Ce.Command.Twocell.Label(t.head, r) }))) })), nudge: Ve((function () { return De(Oe("<\\omit>").to((function () { return new Ce.Command.Twocell.Nudge.Omit })), Oe("<").andr(_e.factor).andl(Le(">")).to((function (e) { return new Ce.Command.Twocell.Nudge.Number(e) }))) })), twocellArrow: Ve((function () { return De(Oe("{").andr(Me(Ae(/^([\^_=`'"!]|\\omit)/))).and(_e.twocellLabelEntry).andl(Le("}")).to((function (e) { return new Ce.Command.Twocell.Arrow.WithOrientation(e.head, e.tail) })), Oe("{").andr(_e.nudge).and(_e.twocellLabelEntry).andl(Le("}")).to((function (e) { return new Ce.Command.Twocell.Arrow.WithPosition(e.head, e.tail) })), Oe("{").andr(_e.twocellLabelEntry).andl(Le("}")).to((function (e) { return new Ce.Command.Twocell.Arrow.WithOrientation("", e) })), Ge("no arrow label").andr(_e.textNodeCreator).to((function (e) { return new Ce.Command.Twocell.Arrow.WithOrientation("", new Ce.Object(L.empty, _e.toMath("\\twocellstyle{}", e))) }))) })), twocellLabelEntry: Ve((function () { return De(Oe("*").andr(_e.object), _e.text().and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return new Ce.Object(L.empty, _e.toMath("\\twocellstyle " + t, n)) }))) })), newdir: Ve((function () { return Oe("{").andr(_e.dirMain).andl(Be("}")).andl(Le("{")).and(_e.compositeObject).andl(Le("}")).to((function (e) { return new Ce.Command.Newdir(e.head, new Ce.ObjectBox.CompositeObject(e.tail)) })) })), xyimport: Ve((function () { return Oe("\\xyimport").andr(Le("(")).andr(_e.factor).andl(Le(",")).and(_e.factor).andl(Le(")")).and(Me(Fe(Oe("(").andr(_e.factor).andl(Le(",")).and(_e.factor).andl(Le(")"))))).andl(Le("{")).and(Me(De(Oe("\\includegraphics").andr(_e.includegraphics), _e.text().and(_e.textNodeCreator).to((function (e) { var t = e.head, n = e.tail; return _e.toMath("\\hbox{$\\objectstyle{" + t + "}$}", n) }))))).andl(Le("}")).to((function (e) { var t, n, r = e.head.head.head, i = e.head.head.tail; e.head.tail.isDefined ? (t = e.head.tail.get.head, n = e.head.tail.get.tail) : (t = 0, n = 0); var a = e.tail; return void 0 !== a.isIncludegraphics ? new Ce.Pos.Xyimport.Graphics(r, i, t, n, a) : new Ce.Pos.Xyimport.TeXCommand(r, i, t, n, a) })) })), includegraphics: Ve((function () { return Oe("[").andr(Me(Fe(_e.includegraphicsAttrList))).andl(Le("]")).andl(Le("{")).and(Me(Ae(/^[^\s{}]+/))).andl(Le("}")).to((function (e) { var t = e.head.getOrElse(L.empty), n = e.tail; return new Ce.Command.Includegraphics(!1, t, n) })) })), includegraphicsAttrList: Ve((function () { return _e.includegraphicsAttr().and(Me(Te(Oe(",").andr(_e.includegraphicsAttr)))).to((function (e) { return e.tail.prepend(e.head) })) })), includegraphicsAttr: Ve((function () { return De(Oe("width").andr(Le("=")).andr(_e.dimen).to((function (e) { return new Ce.Command.Includegraphics.Attr.Width(e) })), Oe("height").andr(Le("=")).andr(_e.dimen).to((function (e) { return new Ce.Command.Includegraphics.Attr.Height(e) }))) })) }; for (var ze in Ie) _e[ze] = Ie[ze]; var Qe = _e, We = function (e, t) { return [e[1] * t[2] - e[2] * t[1], e[2] * t[0] - e[0] * t[2], e[0] * t[1] - e[1] * t[0]] }, Ne = function (e) { return e < 0 ? -1 : e > 0 ? 1 : 0 }, Ue = function (e) { return Math.abs(e) < c.machinePrecision ? 0 : e }, Xe = function (e, t) { var n = e[t], r = function () { var r = n.call(this), a = function () { return r }; return a.reset = i, e[t] = a, r }, i = function () { e[t] = r }; r.reset = i, i() }, He = function (e) { return Math.round(100 * e) / 100 }; function qe(e) { return qe = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, qe(e) } function Je(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && Ze(e, t) } function Ze(e, t) { return Ze = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, Ze(e, t) } function Ye(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = Ke(e); if (t) { var i = Ke(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return $e(this, n) } } function $e(e, t) { if (t && ("object" === qe(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function Ke(e) { return Ke = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, Ke(e) } function et(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function tt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function nt(e, t, n) { return t && tt(e.prototype, t), n && tt(e, n), e } var rt = function () { function e() { et(this, e) } return nt(e, [{ key: "toRect", value: function (t) { return new e.Rect(this.x, this.y, t) } }, { key: "toPoint", value: function () { return new e.Point(this.x, this.y) } }, { key: "combineRect", value: function (t) { return e.combineRect(this, t) } }], [{ key: "combineRect", value: function (e, t) { if (void 0 === e) return t; if (void 0 === t) return e; var n = -(Math.min(e.x - e.l, t.x - t.l) - e.x), r = Math.max(e.x + e.r, t.x + t.r) - e.x, i = -(Math.min(e.y - e.d, t.y - t.d) - e.y), a = Math.max(e.y + e.u, t.y + t.u) - e.y; return e.toRect({ l: n, r: r, d: i, u: a }) } }]), e }(); function it(e) { return it = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, it(e) } function at(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && ot(e, t) } function ot(e, t) { return ot = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, ot(e, t) } function ut(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = ht(e); if (t) { var i = ht(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return st(this, n) } } function st(e, t) { if (t && ("object" === it(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return ct(e) } function ct(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function ht(e) { return ht = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, ht(e) } function lt(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function mt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function pt(e, t, n) { return t && mt(e.prototype, t), n && mt(e, n), e } rt.Point = function (e) { Je(n, e); var t = Ye(n); function n(e, r) { var i; return et(this, n), (i = t.call(this)).x = e, i.y = r, i } return nt(n, [{ key: "l", get: function () { return 0 } }, { key: "r", get: function () { return 0 } }, { key: "u", get: function () { return 0 } }, { key: "d", get: function () { return 0 } }, { key: "isPoint", value: function () { return !0 } }, { key: "isRect", value: function () { return !1 } }, { key: "isCircle", value: function () { return !1 } }, { key: "edgePoint", value: function (e, t) { return this } }, { key: "proportionalEdgePoint", value: function (e, t) { return this } }, { key: "grow", value: function (e, t) { var n = Math.max(0, e), r = Math.max(0, t); return this.toRect({ l: n, r: n, u: r, d: r }) } }, { key: "toSize", value: function (e, t) { return this.toRect({ l: e / 2, r: e / 2, u: t / 2, d: t / 2 }) } }, { key: "growTo", value: function (e, t) { var n = Math.max(0, e), r = Math.max(0, t); return this.toRect({ l: n / 2, r: n / 2, u: r / 2, d: r / 2 }) } }, { key: "shrinkTo", value: function (e, t) { return this } }, { key: "move", value: function (e, t) { return new rt.Point(e, t) } }, { key: "shiftFrame", value: function (e, t) { return this } }, { key: "rotate", value: function (e) { return this } }, { key: "contains", value: function (e) { return !1 } }, { key: "toString", value: function () { return "{x:" + this.x + ", y:" + this.y + "}" } }]), n }(rt), rt.Rect = function (e) { Je(n, e); var t = Ye(n); function n(e, r, i) { var a; return et(this, n), (a = t.call(this)).x = e, a.y = r, a.l = i.l || 0, a.r = i.r || 0, a.u = i.u || 0, a.d = i.d || 0, a } return nt(n, [{ key: "isPoint", value: function () { return 0 === this.l && 0 === this.r && 0 === this.u && 0 === this.d } }, { key: "isRect", value: function () { return !this.isPoint() } }, { key: "isCircle", value: function () { return !1 } }, { key: "edgePoint", value: function (e, t) { if (this.isPoint()) return this; var n, r = e - this.x, i = t - this.y; return r > 0 ? (n = i * this.r / r) > this.u ? new rt.Point(this.x + this.u * r / i, this.y + this.u) : n < -this.d ? new rt.Point(this.x - this.d * r / i, this.y - this.d) : new rt.Point(this.x + this.r, this.y + n) : r < 0 ? (n = -i * this.l / r) > this.u ? new rt.Point(this.x + this.u * r / i, this.y + this.u) : n < -this.d ? new rt.Point(this.x - this.d * r / i, this.y - this.d) : new rt.Point(this.x - this.l, this.y + n) : i > 0 ? new rt.Point(this.x, this.y + this.u) : new rt.Point(this.x, this.y - this.d) } }, { key: "proportionalEdgePoint", value: function (e, t) { if (this.isPoint()) return this; var n = e - this.x, r = t - this.y; if (Math.abs(n) < c.machinePrecision && Math.abs(r) < c.machinePrecision) return new rt.Point(this.x - this.l, this.y + this.u); var i, a = this.l + this.r, o = this.u + this.d, u = Math.PI, s = Math.atan2(r, n); return -3 * u / 4 < s && s <= -u / 4 ? (i = (s + 3 * u / 4) / (u / 2), new rt.Point(this.x + this.r - i * a, this.y + this.u)) : -u / 4 < s && s <= u / 4 ? (i = (s + u / 4) / (u / 2), new rt.Point(this.x - this.l, this.y + this.u - i * o)) : u / 4 < s && s <= 3 * u / 4 ? (i = (s - u / 4) / (u / 2), new rt.Point(this.x - this.l + i * a, this.y - this.d)) : (i = (s - (s > 0 ? 3 * u / 4 : -5 * u / 4)) / (u / 2), new rt.Point(this.x + this.r, this.y - this.d + i * o)) } }, { key: "grow", value: function (e, t) { return this.toRect({ l: Math.max(0, this.l + e), r: Math.max(0, this.r + e), u: Math.max(0, this.u + t), d: Math.max(0, this.d + t) }) } }, { key: "toSize", value: function (e, t) { var n, r, i, a, o = this.l + this.r, u = this.u + this.d; return 0 === o ? (a = e / 2, i = e / 2) : (a = e * this.l / o, i = e * this.r / o), 0 === u ? (n = t / 2, r = t / 2) : (n = t * this.u / u, r = t * this.d / u), this.toRect({ l: a, r: i, u: n, d: r }) } }, { key: "growTo", value: function (e, t) { var n = this.u, r = this.d, i = this.r, a = this.l, o = a + i, u = n + r; return e > o && (0 === o ? (a = e / 2, i = e / 2) : (a = e * this.l / o, i = e * this.r / o)), t > u && (0 === u ? (n = t / 2, r = t / 2) : (n = t * this.u / u, r = t * this.d / u)), this.toRect({ l: a, r: i, u: n, d: r }) } }, { key: "shrinkTo", value: function (e, t) { var n = this.u, r = this.d, i = this.r, a = this.l, o = a + i, u = n + r; return e < o && (0 === o ? (a = e / 2, i = e / 2) : (a = e * this.l / o, i = e * this.r / o)), t < u && (0 === u ? (n = t / 2, r = t / 2) : (n = t * this.u / u, r = t * this.d / u)), this.toRect({ l: a, r: i, u: n, d: r }) } }, { key: "move", value: function (e, t) { return new rt.Rect(e, t, { l: this.l, r: this.r, u: this.u, d: this.d }) } }, { key: "shiftFrame", value: function (e, t) { return new rt.Rect(this.x, this.y, { l: Math.max(0, this.l - e), r: Math.max(0, this.r + e), u: Math.max(0, this.u + t), d: Math.max(0, this.d - t) }) } }, { key: "rotate", value: function (e) { var t = Math.cos(e), n = Math.sin(e), r = -this.l, i = this.r, a = this.u, o = -this.d, u = { x: r * t - a * n, y: r * n + a * t }, s = { x: r * t - o * n, y: r * n + o * t }, c = { x: i * t - a * n, y: i * n + a * t }, h = { x: i * t - o * n, y: i * n + o * t }; return this.toRect({ l: -Math.min(u.x, s.x, c.x, h.x), r: Math.max(u.x, s.x, c.x, h.x), u: Math.max(u.y, s.y, c.y, h.y), d: -Math.min(u.y, s.y, c.y, h.y) }) } }, { key: "contains", value: function (e) { var t = e.x, n = e.y; return t >= this.x - this.l && t <= this.x + this.r && n >= this.y - this.d && n <= this.y + this.u } }, { key: "toString", value: function () { return "{x:" + this.x + ", y:" + this.y + ", l:" + this.l + ", r:" + this.r + ", u:" + this.u + ", d:" + this.d + "}" } }]), n }(rt), rt.Ellipse = function (e) { Je(n, e); var t = Ye(n); function n(e, r, i, a, o, u) { var s; return et(this, n), (s = t.call(this)).x = e, s.y = r, s.l = i, s.r = a, s.u = o, s.d = u, s } return nt(n, [{ key: "isPoint", value: function () { return 0 === this.r && 0 === this.l || 0 === this.u && 0 === this.d } }, { key: "isRect", value: function () { return !1 } }, { key: "isCircle", value: function () { return !this.isPoint() } }, { key: "isPerfectCircle", value: function () { return this.l === this.r && this.l === this.u && this.l === this.d } }, { key: "edgePoint", value: function (e, t) { if (this.isPoint()) return this; if (this.isPerfectCircle()) { var n, r = e - this.x, i = t - this.y; return n = Math.abs(r) < c.machinePrecision && Math.abs(i) < c.machinePrecision ? -Math.PI / 2 : Math.atan2(i, r), new rt.Point(this.x + this.r * Math.cos(n), this.y + this.r * Math.sin(n)) } Math.PI; var a = this.l, o = this.r, u = this.u, s = this.d, h = this.x, l = this.y, m = h + (o - a) / 2, p = l + (u - s) / 2, f = (a + o) / 2, d = (u + s) / 2, y = -(r = e - h), v = (i = t - l) * f, x = y * d, g = v * v + x * x, w = -(s = v * m + x * p + ((r * l - i * h) * f + (f - d) * y * p)) / g, S = g * f * f - s * s; if (S < 0) return new rt.Point(this.x, this.y - this.d); var b = Math.sqrt(S) / g, C = d / f, k = v * w + x * b + m, M = C * (x * w - v * b + p - p) + p, P = v * w - x * b + m, B = C * (x * w + v * b + p - p) + p, O = Ne; return O(k - m) === O(e - m) && O(M - p) === O(t - p) ? new rt.Point(k, M) : new rt.Point(P, B) } }, { key: "proportionalEdgePoint", value: function (e, t) { if (this.isPoint()) return this; if (this.isPerfectCircle()) { var n, r = e - this.x, i = t - this.y; return n = Math.abs(r) < c.machinePrecision && Math.abs(i) < c.machinePrecision ? -Math.PI / 2 : Math.atan2(i, r), new rt.Point(this.x - this.r * Math.cos(n), this.y - this.r * Math.sin(n)) } Math.PI; var a = this.l, o = this.r, u = this.u, s = this.d, h = this.x, l = this.y, m = h + (o - a) / 2, p = l + (u - s) / 2, f = (a + o) / 2, d = (u + s) / 2, y = -(r = e - h), v = (i = t - l) * f, x = y * d, g = v * v + x * x, w = -(s = v * m + x * p + ((r * l - i * h) * f + (f - d) * y * p)) / g, S = g * f * f - s * s; if (S < 0) return new rt.Point(this.x, this.y - this.d); var b = Math.sqrt(S) / g, C = d / f, k = v * w + x * b + m, M = C * (x * w - v * b + p - p) + p, P = v * w - x * b + m, B = C * (x * w + v * b + p - p) + p; return sign(k - m) === sign(e - m) && sign(M - p) === sign(t - p) ? new rt.Point(P, B) : new rt.Point(k, M) } }, { key: "grow", value: function (e, t) { return new rt.Ellipse(this.x, this.y, Math.max(0, this.l + e), Math.max(0, this.r + e), Math.max(0, this.u + t), Math.max(0, this.d + t)) } }, { key: "toSize", value: function (e, t) { var n, r, i, a, o = this.l + this.r, u = this.u + this.d; return 0 === o ? (a = e / 2, i = e / 2) : (a = e * this.l / o, i = e * this.r / o), 0 === u ? (n = t / 2, r = t / 2) : (n = t * this.u / u, r = t * this.d / u), new rt.Ellipse(this.x, this.y, a, i, n, r) } }, { key: "growTo", value: function (e, t) { var n = this.u, r = this.d, i = this.r, a = this.l, o = a + i, u = n + r; return e > o && (0 === o ? (a = e / 2, i = e / 2) : (a = e * this.l / o, i = e * this.r / o)), t > u && (0 === u ? (n = t / 2, r = t / 2) : (n = t * this.u / u, r = t * this.d / u)), new rt.Ellipse(this.x, this.y, a, i, n, r) } }, { key: "shrinkTo", value: function (e, t) { var n = this.u, r = this.d, i = this.r, a = this.l, o = a + i, u = n + r; return e < o && (0 === o ? (a = e / 2, i = e / 2) : (a = e * this.l / o, i = e * this.r / o)), t < u && (0 === u ? (n = t / 2, r = t / 2) : (n = t * this.u / u, r = t * this.d / u)), new rt.Ellipse(this.x, this.y, a, i, n, r) } }, { key: "move", value: function (e, t) { return new rt.Ellipse(e, t, this.l, this.r, this.u, this.d) } }, { key: "shiftFrame", value: function (e, t) { return new rt.Ellipse(this.x, this.y, Math.max(0, this.l - e), Math.max(0, this.r + e), Math.max(0, this.u + t), Math.max(0, this.d - t)) } }, { key: "rotate", value: function (e) { return this } }, { key: "contains", value: function (e) { var t = e.x, n = e.y; if (this.isPoint()) return !1; var r = this.l, i = this.r, a = this.u, o = this.d, u = (r + i) / 2, s = t - (this.x + (i - r) / 2), c = (n - (this.y + (a - o) / 2)) / ((a + o) / 2 / u); return s * s + c * c <= u * u } }, { key: "toString", value: function () { return "{x:" + this.x + ", y:" + this.y + ", l:" + this.l + ", r:" + this.r + ", u:" + this.u + ", d:" + this.d + "}" } }]), n }(rt); var ft = function () { function e() { lt(this, e) } return pt(e, [{ key: "isNone", get: function () { return !1 } }]), e }(); function dt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } ft.NoneShape = function (e) { at(n, e); var t = ut(n); function n() { return lt(this, n), t.call(this) } return pt(n, [{ key: "draw", value: function (e) { } }, { key: "getBoundingBox", value: function () { } }, { key: "toString", value: function () { return "NoneShape" } }, { key: "isNone", get: function () { return !0 } }]), n }(ft), ft.none = new ft.NoneShape, ft.InvisibleBoxShape = function (e) { at(n, e); var t = ut(n); function n(e) { var r; return lt(this, n), (r = t.call(this)).bbox = e, r } return pt(n, [{ key: "draw", value: function (e) { } }, { key: "getBoundingBox", value: function () { return this.bbox } }, { key: "toString", value: function () { return "InvisibleBoxShape[bbox:" + this.bbox.toString() + "]" } }]), n }(ft), ft.TranslateShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i) { var a; return lt(this, n), (a = t.call(this)).dx = e, a.dy = r, a.shape = i, Xe(ct(a), "getBoundingBox"), a } return pt(n, [{ key: "draw", value: function (e) { var t = e.createGroup(e.transformBuilder().translate(this.dx, this.dy)); this.shape.draw(t) } }, { key: "getBoundingBox", value: function () { var e = this.shape.getBoundingBox(); if (void 0 !== e) return new rt.Rect(e.x + this.dx, e.y + this.dy, e) } }, { key: "toString", value: function () { return "TranslateShape[dx:" + this.dx + ", dy:" + this.dy + ", shape:" + this.shape.toString() + "]" } }]), n }(ft), ft.CompositeShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).foregroundShape = e, i.backgroundShape = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "draw", value: function (e) { this.backgroundShape.draw(e), this.foregroundShape.draw(e) } }, { key: "getBoundingBox", value: function () { return rt.combineRect(this.foregroundShape.getBoundingBox(), this.backgroundShape.getBoundingBox()) } }, { key: "toString", value: function () { return "(" + this.foregroundShape.toString() + ", " + this.backgroundShape.toString() + ")" } }]), n }(ft), ft.ChangeColorShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).color = e, i.shape = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "draw", value: function (e) { var t = e.createChangeColorGroup(this.color); this.shape.draw(t) } }, { key: "getBoundingBox", value: function () { return this.shape.getBoundingBox() } }, { key: "toString", value: function () { return this.shape + ", color:" + this.color } }]), n }(ft), ft.CircleSegmentShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o, u, s, c, h) { var l; return lt(this, n), (l = t.call(this)).x = e, l.y = r, l.sx = i, l.sy = a, l.r = o, l.large = u, l.flip = s, l.ex = c, l.ey = h, Xe(ct(l), "getBoundingBox"), l } return pt(n, [{ key: "draw", value: function (e) { e.createSVGElement("path", { d: "M" + pe.measure.em2px(this.sx) + "," + pe.measure.em2px(-this.sy) + " A" + pe.measure.em2px(this.r) + "," + pe.measure.em2px(this.r) + " 0 " + this.large + "," + this.flip + " " + pe.measure.em2px(this.ex) + "," + pe.measure.em2px(-this.ey) }) } }, { key: "getBoundingBox", value: function () { return new rt.Ellipse(this.x, this.y, this.r, this.r, this.r, this.r) } }, { key: "toString", value: function () { return "CircleSegmentShape[x:" + this.x + ", y:" + this.y + ", sx:" + this.sx + ", sy:" + this.sy + ", r:" + this.r + ", large:" + this.large + ", flip:" + this.flip + ", ex:" + this.ex + ", ey:" + this.ey + "]" } }]), n }(ft), ft.FullCircleShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i) { var a; return lt(this, n), (a = t.call(this)).x = e, a.y = r, a.r = i, Xe(ct(a), "getBoundingBox"), a } return pt(n, [{ key: "draw", value: function (e) { e.createSVGElement("circle", { cx: pe.measure.em2px(this.x), cy: pe.measure.em2px(-this.y), r: pe.measure.em2px(this.r) }) } }, { key: "getBoundingBox", value: function () { return new rt.Ellipse(this.x, this.y, this.r, this.r, this.r, this.r) } }, { key: "toString", value: function () { return "FullCircleShape[x:" + this.x + ", y:" + this.y + ", r:" + this.r + "]" } }]), n }(ft), ft.RectangleShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o, u, s, c, h, l, m, p) { var f; return lt(this, n), (f = t.call(this)).x = e, f.y = r, f.left = i, f.right = a, f.up = o, f.down = u, f.r = s, f.isDoubled = c, f.color = h, f.dasharray = l, f.fillColor = m, f.hideLine = p || !1, Xe(ct(f), "getBoundingBox"), f } return pt(n, [{ key: "draw", value: function (e) { var t; t = { x: pe.measure.em2px(this.x - this.left), y: -pe.measure.em2px(this.y + this.up), width: pe.measure.em2px(this.left + this.right), height: pe.measure.em2px(this.up + this.down), rx: pe.measure.em2px(this.r) }, void 0 !== this.dasharray && (t["stroke-dasharray"] = this.dasharray), this.hideLine ? t.stroke = "none" : void 0 !== this.color && (t.stroke = this.color), void 0 !== this.fillColor && (t.fill = this.fillColor), e.createSVGElement("rect", t), this.isDoubled && (t = { x: pe.measure.em2px(this.x - this.left + pe.measure.thickness), y: -pe.measure.em2px(this.y + this.up - pe.measure.thickness), width: pe.measure.em2px(this.left + this.right - 2 * pe.measure.thickness), height: pe.measure.em2px(this.up + this.down - 2 * pe.measure.thickness), rx: pe.measure.em2px(Math.max(this.r - pe.measure.thickness, 0)) }, void 0 !== this.dasharray && (t["stroke-dasharray"] = this.dasharray), this.hideLine ? t.stroke = "none" : void 0 !== this.color && (t.stroke = this.color), void 0 !== this.fillColor && (t.fill = this.fillColor), e.createSVGElement("rect", t)) } }, { key: "getBoundingBox", value: function () { return new rt.Rect(this.x, this.y, { l: this.left, r: this.right, u: this.up, d: this.down }) } }, { key: "toString", value: function () { return "RectangleShape[x:" + this.x + ", y:" + this.y + ", left:" + this.left + ", right:" + this.right + ", up:" + this.up + ", down:" + this.down + ", r:" + this.r + ", isDouble:" + this.isDouble + ", dasharray:" + this.dasharray + "]" } }]), n }(ft), ft.EllipseShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o, u, s, c, h) { var l; return lt(this, n), (l = t.call(this)).x = e, l.y = r, l.rx = i, l.ry = a, l.isDoubled = o, l.color = u, l.dasharray = s, l.fillColor = c, l.hideLine = h || !1, Xe(ct(l), "getBoundingBox"), l } return pt(n, [{ key: "draw", value: function (e) { var t; t = { cx: pe.measure.em2px(this.x), cy: -pe.measure.em2px(this.y), rx: pe.measure.em2px(this.rx), ry: pe.measure.em2px(this.ry) }, void 0 !== this.dasharray && (t["stroke-dasharray"] = this.dasharray), this.hideLine ? t.stroke = "none" : void 0 !== this.color && (t.stroke = this.color), void 0 !== this.fillColor && (t.fill = this.fillColor), e.createSVGElement("ellipse", t), this.isDoubled && (t = { cx: pe.measure.em2px(this.x), cy: -pe.measure.em2px(this.y), rx: pe.measure.em2px(Math.max(this.rx - pe.measure.thickness)), ry: pe.measure.em2px(Math.max(this.ry - pe.measure.thickness)) }, void 0 !== this.dasharray && (t["stroke-dasharray"] = this.dasharray), this.hideLine ? t.stroke = "none" : void 0 !== this.color && (t.stroke = this.color), void 0 !== this.fillColor && (t.fill = this.fillColor), e.createSVGElement("ellipse", t)) } }, { key: "getBoundingBox", value: function () { return new rt.Rect(this.x, this.y, { l: this.rx, r: this.rx, u: this.ry, d: this.ry }) } }, { key: "toString", value: function () { return "EllipseShape[x:" + this.x + ", y:" + this.y + ", rx:" + this.rx + ", ry:" + this.ry + ", isDoubled:" + this.isDoubled + ", dasharray:" + this.dasharray + "]" } }]), n }(ft), ft.BoxShadeShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o, u, s, c) { var h; return lt(this, n), (h = t.call(this)).x = e, h.y = r, h.left = i, h.right = a, h.up = o, h.down = u, h.depth = s, h.color = c || "currentColor", Xe(ct(h), "getBoundingBox"), h } return pt(n, [{ key: "draw", value: function (e) { var t = pe.measure.em2px(this.x), n = pe.measure.em2px(this.y), r = pe.measure.em2px(this.left), i = pe.measure.em2px(this.right), a = pe.measure.em2px(this.up), o = pe.measure.em2px(this.down), u = pe.measure.em2px(this.depth); e.createSVGElement("path", { d: "M" + (t - r + u) + "," + (-n + o) + "L" + (t + i) + "," + (-n + o) + "L" + (t + i) + "," + (-n - a + u) + "L" + (t + i + u) + "," + (-n - a + u) + "L" + (t + i + u) + "," + (-n + o + u) + "L" + (t - r + u) + "," + (-n + o + u) + "Z", stroke: this.color, fill: this.color }) } }, { key: "getBoundingBox", value: function () { return new rt.Rect(this.x, this.y, { l: this.left, r: this.right + this.depth, u: this.up, d: this.down + this.depth }) } }, { key: "toString", value: function () { return "RectangleShape[x:" + this.x + ", y:" + this.y + ", left:" + this.left + ", right:" + this.right + ", up:" + this.up + ", down:" + this.down + ", depth:" + this.depth + "]" } }]), n }(ft), ft.LeftBrace = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o, u) { var s; return lt(this, n), (s = t.call(this)).x = e, s.y = r, s.up = i, s.down = a, s.degree = o, s.color = u || "currentColor", Xe(ct(s), "getBoundingBox"), s } return pt(n, [{ key: "draw", value: function (e) { var t, n = pe.measure.oneem, r = Math.max(1.41975, this.down / n * 1.125) - .660375, i = .660375 - Math.max(1.41975, this.up / n * 1.125); t = "M" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(r) + "T" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(.07875 + r) + "Q" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(.190125 + r) + " " + pe.measure.em2px(-.0585) + " " + pe.measure.em2px(.250875 + r) + "T" + pe.measure.em2px(-.01125) + " " + pe.measure.em2px(.387 + r) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(.55575 + r) + " " + pe.measure.em2px(.2475) + " " + pe.measure.em2px(.6525 + r) + "L" + pe.measure.em2px(.262125) + " " + pe.measure.em2px(.660375 + r) + "L" + pe.measure.em2px(.3015) + " " + pe.measure.em2px(.660375 + r) + "L" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(.653625 + r) + "V" + pe.measure.em2px(.622125 + r) + "Q" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(.60975 + r) + " " + pe.measure.em2px(.2925) + " " + pe.measure.em2px(.60075 + r) + "Q" + pe.measure.em2px(.205875) + " " + pe.measure.em2px(.541125 + r) + " " + pe.measure.em2px(.149625) + " " + pe.measure.em2px(.44775 + r) + "T" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(.239625 + r) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(.2385 + r) + " " + pe.measure.em2px(.073125) + " " + pe.measure.em2px(.235125 + r) + "Q" + pe.measure.em2px(.068625) + " " + pe.measure.em2px(.203625 + r) + " " + pe.measure.em2px(.0675) + " " + pe.measure.em2px(.041625 + r) + "L" + pe.measure.em2px(.0675) + " " + pe.measure.em2px(.75825) + "Q" + pe.measure.em2px(.0675) + " " + pe.measure.em2px(.496125) + " " + pe.measure.em2px(.066375) + " " + pe.measure.em2px(.486) + "Q" + pe.measure.em2px(.05625) + " " + pe.measure.em2px(.336375) + " " + pe.measure.em2px(-.021375) + " " + pe.measure.em2px(.212625) + "T" + pe.measure.em2px(-.226125) + " " + pe.measure.em2px(.010125) + "L" + pe.measure.em2px(-.241875) + " 0L" + pe.measure.em2px(-.226125) + " " + pe.measure.em2px(-.010125) + "Q" + pe.measure.em2px(-.106875) + " " + pe.measure.em2px(-.084375) + " " + pe.measure.em2px(-.025875) + " " + pe.measure.em2px(-.207) + "T" + pe.measure.em2px(.066375) + " " + pe.measure.em2px(-.486) + "Q" + pe.measure.em2px(.0675) + " " + pe.measure.em2px(-.496125) + " " + pe.measure.em2px(.0675) + " " + pe.measure.em2px(-.75825) + "L" + pe.measure.em2px(.0675) + " " + pe.measure.em2px(-.041625 + i) + "Q" + pe.measure.em2px(.068625) + " " + pe.measure.em2px(-.203625 + i) + " " + pe.measure.em2px(.073125) + " " + pe.measure.em2px(-.235125 + i) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(-.2385 + i) + " " + pe.measure.em2px(.07425) + " " + pe.measure.em2px(-.239625 + i) + "Q" + pe.measure.em2px(.093375) + " " + pe.measure.em2px(-.354375 + i) + " " + pe.measure.em2px(.149625) + " " + pe.measure.em2px(-.44775 + i) + "T" + pe.measure.em2px(.2925) + " " + pe.measure.em2px(-.60075 + i) + "Q" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(-.60975 + i) + " " + pe.measure.em2px(.30825) + " " + pe.measure.em2px(-.622125 + i) + "L" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(-.653625 + i) + "L" + pe.measure.em2px(.3015) + " " + pe.measure.em2px(-.660375 + i) + "L" + pe.measure.em2px(.262125) + " " + pe.measure.em2px(-.660375 + i) + "L" + pe.measure.em2px(.2475) + " " + pe.measure.em2px(-.6525 + i) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(-.55575 + i) + " " + pe.measure.em2px(-.01125) + " " + pe.measure.em2px(-.387 + i) + "Q" + pe.measure.em2px(-.048375) + " " + pe.measure.em2px(-.311625 + i) + " " + pe.measure.em2px(-.0585) + " " + pe.measure.em2px(-.250875 + i) + "T" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(-.07875 + i) + "Q" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(i) + " " + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(i) + "L" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(-.759375) + "V" + pe.measure.em2px(-.5985) + "Q" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(-.47925) + " " + pe.measure.em2px(-.075375) + " " + pe.measure.em2px(-.41175) + "T" + pe.measure.em2px(-.11475) + " " + pe.measure.em2px(-.27) + "Q" + pe.measure.em2px(-.133875) + " " + pe.measure.em2px(-.2205) + " " + pe.measure.em2px(-.160875) + " " + pe.measure.em2px(-.17775) + "T" + pe.measure.em2px(-.212625) + " " + pe.measure.em2px(-.106875) + "T" + pe.measure.em2px(-.25875) + " " + pe.measure.em2px(-.06075) + "T" + pe.measure.em2px(-.293625) + " " + pe.measure.em2px(-.0315) + "T" + pe.measure.em2px(-.307125) + " " + pe.measure.em2px(-.02025) + "Q" + pe.measure.em2px(-.30825) + " " + pe.measure.em2px(-.019125) + " " + pe.measure.em2px(-.30825) + " 0T" + pe.measure.em2px(-.307125) + " " + pe.measure.em2px(.02025) + "Q" + pe.measure.em2px(-.307125) + " " + pe.measure.em2px(.021375) + " " + pe.measure.em2px(-.284625) + " " + pe.measure.em2px(.03825) + "T" + pe.measure.em2px(-.2295) + " " + pe.measure.em2px(.091125) + "T" + pe.measure.em2px(-.162) + " " + pe.measure.em2px(.176625) + "T" + pe.measure.em2px(-.10125) + " " + pe.measure.em2px(.30825) + "T" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(.482625) + "Q" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(.496125) + " " + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(.759375) + "Z", e.createSVGElement("path", { d: t, fill: this.color, stroke: this.color, "stroke-width": "0pt", transform: "translate(" + pe.measure.em2px(this.x) + "," + pe.measure.em2px(-this.y) + ") rotate(" + -this.degree + ") scale(" + n / 1.125 + ")" }) } }, { key: "getBoundingBox", value: function () { var e = pe.measure.oneem; return new rt.Rect(this.x, this.y, { l: .274 * e, r: .274 * e, u: Math.max(1.41975 * e / 1.125, this.up), d: Math.max(1.41975 * e / 1.125, this.down) }).rotate(this.degree * Math.PI / 180) } }, { key: "toString", value: function () { return "LeftBrace[x:" + this.x + ", y:" + this.y + ", up:" + this.up + ", down:" + this.down + "]" } }]), n }(ft), ft.LeftParenthesis = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o) { var u; return lt(this, n), (u = t.call(this)).x = e, u.y = r, u.height = i, u.degree = a, u.color = o || "currentColor", Xe(ct(u), "getBoundingBox"), u } return pt(n, [{ key: "draw", value: function (e) { var t, n = pe.measure.oneem, r = Math.max(.660375, this.height / 2 / n * 1.125) - .660375, i = -r; t = "M" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(r) + "T" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(.07875 + r) + "Q" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(.190125 + r) + " " + pe.measure.em2px(-.0585) + " " + pe.measure.em2px(.250875 + r) + "T" + pe.measure.em2px(-.01125) + " " + pe.measure.em2px(.387 + r) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(.55575 + r) + " " + pe.measure.em2px(.2475) + " " + pe.measure.em2px(.6525 + r) + "L" + pe.measure.em2px(.262125) + " " + pe.measure.em2px(.660375 + r) + "L" + pe.measure.em2px(.3015) + " " + pe.measure.em2px(.660375 + r) + "L" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(.653625 + r) + "V" + pe.measure.em2px(.622125 + r) + "Q" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(.60975 + r) + " " + pe.measure.em2px(.2925) + " " + pe.measure.em2px(.60075 + r) + "Q" + pe.measure.em2px(.205875) + " " + pe.measure.em2px(.541125 + r) + " " + pe.measure.em2px(.149625) + " " + pe.measure.em2px(.44775 + r) + "T" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(.239625 + r) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(.2385 + r) + " " + pe.measure.em2px(.073125) + " " + pe.measure.em2px(.235125 + r) + "Q" + pe.measure.em2px(.068625) + " " + pe.measure.em2px(.203625 + r) + " " + pe.measure.em2px(.0675) + " " + pe.measure.em2px(.041625 + r) + "L" + pe.measure.em2px(.0675) + " " + pe.measure.em2px(-.041625 + i) + "Q" + pe.measure.em2px(.068625) + " " + pe.measure.em2px(-.203625 + i) + " " + pe.measure.em2px(.073125) + " " + pe.measure.em2px(-.235125 + i) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(-.2385 + i) + " " + pe.measure.em2px(.07425) + " " + pe.measure.em2px(-.239625 + i) + "Q" + pe.measure.em2px(.093375) + " " + pe.measure.em2px(-.354375 + i) + " " + pe.measure.em2px(.149625) + " " + pe.measure.em2px(-.44775 + i) + "T" + pe.measure.em2px(.2925) + " " + pe.measure.em2px(-.60075 + i) + "Q" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(-.60975 + i) + " " + pe.measure.em2px(.30825) + " " + pe.measure.em2px(-.622125 + i) + "L" + pe.measure.em2px(.30825) + " " + pe.measure.em2px(-.653625 + i) + "L" + pe.measure.em2px(.3015) + " " + pe.measure.em2px(-.660375 + i) + "L" + pe.measure.em2px(.262125) + " " + pe.measure.em2px(-.660375 + i) + "L" + pe.measure.em2px(.2475) + " " + pe.measure.em2px(-.6525 + i) + "Q" + pe.measure.em2px(.07425) + " " + pe.measure.em2px(-.55575 + i) + " " + pe.measure.em2px(-.01125) + " " + pe.measure.em2px(-.387 + i) + "Q" + pe.measure.em2px(-.048375) + " " + pe.measure.em2px(-.311625 + i) + " " + pe.measure.em2px(-.0585) + " " + pe.measure.em2px(-.250875 + i) + "T" + pe.measure.em2px(-.068625) + " " + pe.measure.em2px(-.07875 + i) + "Q" + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(i) + " " + pe.measure.em2px(-.0675) + " " + pe.measure.em2px(i) + "Z", e.createSVGElement("path", { d: t, fill: this.color, stroke: this.color, "stroke-width": "0pt", transform: "translate(" + pe.measure.em2px(this.x) + "," + pe.measure.em2px(-this.y) + ") rotate(" + -this.degree + ") scale(" + n / 1.125 + ")" }) } }, { key: "getBoundingBox", value: function () { var e = pe.measure.oneem; return new rt.Rect(this.x, this.y, { l: .06 * e, r: .274 * e, u: Math.max(.660375 * e / 1.125, this.height / 2), d: Math.max(.660375 * e / 1.125, this.height / 2) }).rotate(this.degree * Math.PI / 180) } }, { key: "toString", value: function () { return "LeftBrace[x:" + this.x + ", y:" + this.y + ", up:" + this.up + ", down:" + this.down + "]" } }]), n }(ft), ft.TextShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.math = r, i.originalBBox = void 0, Xe(ct(i), "getBoundingBox"), Xe(ct(i), "getOriginalReferencePoint"), i } return pt(n, [{ key: "draw", value: function (e) { this._draw(e, !1) } }, { key: "getBoundingBox", value: function () { return this._draw(pe.svgForTestLayout, !0) } }, { key: "_draw", value: function (e, t) { return e.xypicWrapper.drawTextObject(this, e, t) } }, { key: "getOriginalReferencePoint", value: function () { this.getBoundingBox(); var e = this.originalBBox, t = this.c, n = e.H, r = e.D; return new rt.Point(t.x, t.y - (n - r) / 2) } }, { key: "toString", value: function () { return "TextShape[c:" + this.c.toString() + ", math:" + this.math.toString() + "]" } }]), n }(ft), ft.ImageShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.url = r, Xe(ct(i), "getBoundingBox"), Xe(ct(i), "getOriginalReferencePoint"), i } return pt(n, [{ key: "draw", value: function (e) { var t = this.c; e.createSVGElement("image", { x: pe.measure.em2px(t.x - t.l), y: pe.measure.em2px(-t.y - t.u), width: pe.measure.em2px(t.l + t.r), height: pe.measure.em2px(t.u + t.d), preserveAspectRatio: "none", "xlink:href": this.url }) } }, { key: "getBoundingBox", value: function () { return this.c } }, { key: "getOriginalReferencePoint", value: function () { return this.c } }, { key: "toString", value: function () { return "ImageShape[c:" + this.c.toString() + ", height:" + this.height + ", width:" + this.width + ", url:" + this.url + "]" } }]), n }(ft), ft.ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n() { return lt(this, n), t.call(this) } return pt(n, [{ key: "draw", value: function (e) { var t = e.createGroup(e.transformBuilder().translate(this.c.x, this.c.y).rotateRadian(this.angle)); this.drawDelegate(t) } }, { key: "getBoundingBox", value: function () { return this.c.toRect(this.getBox()).rotate(this.angle) } }, { key: "toString", value: function () { return "ArrowheadShape[c:" + this.c.toString() + ", angle:" + this.angle + "]" } }]), n }(ft), ft.GT2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .456 * e, r: 0, d: .229 * e, u: .229 * e } } }, { key: "getRadius", value: function () { return .213 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = e.createGroup(e.transformBuilder().rotateDegree(-10)), r = e.createGroup(e.transformBuilder().rotateDegree(10)); n.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.GT3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .507 * e, r: 0, d: .268 * e, u: .268 * e } } }, { key: "getRadius", value: function () { return .325 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = e.createGroup(e.transformBuilder().rotateDegree(-15)), r = e.createGroup(e.transformBuilder().rotateDegree(15)); n.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("line", { x1: 0, y1: 0, x2: pe.measure.em2px(-.507 * t), y2: 0 }), r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.UpperGTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .489 * e, r: 0, d: 0, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem; e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LowerGTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .489 * e, r: 0, d: .147 * e, u: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem; e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.GTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .489 * e, r: 0, d: .147 * e, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem; e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LT2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .456 * e, d: .229 * e, u: .229 * e } } }, { key: "getRadius", value: function () { return .213 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = e.createGroup(e.transformBuilder().rotateDegree(10)), r = e.createGroup(e.transformBuilder().rotateDegree(-10)); n.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LT3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .507 * e, d: .268 * e, u: .268 * e } } }, { key: "getRadius", value: function () { return .325 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = e.createGroup(e.transformBuilder().rotateDegree(15)), r = e.createGroup(e.transformBuilder().rotateDegree(-15)); n.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("line", { x1: 0, y1: 0, x2: pe.measure.em2px(.507 * t), y2: 0 }), r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.UpperLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .489 * e, d: 0, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem; e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LowerLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .489 * e, d: .147 * e, u: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem; e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .489 * e, d: .147 * e, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem; e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.UpperColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: 0, y2: -t }) } }]), n }(ft.ArrowheadShape), ft.LowerColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: 0, d: pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: 0, y2: t }) } }]), n }(ft.ArrowheadShape), ft.Column2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: .5 * (pe.measure.lineElementLength + pe.measure.thickness), d: .5 * (pe.measure.lineElementLength + pe.measure.thickness) } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(.5 * (pe.measure.lineElementLength + pe.measure.thickness)); e.createSVGElement("line", { x1: 0, y1: t, x2: 0, y2: -t }) } }]), n }(ft.ArrowheadShape), ft.Column3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: .5 * pe.measure.lineElementLength + pe.measure.thickness, d: .5 * pe.measure.lineElementLength + pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(.5 * pe.measure.lineElementLength + pe.measure.thickness); e.createSVGElement("line", { x1: 0, y1: t, x2: 0, y2: -t }) } }]), n }(ft.ArrowheadShape), ft.ColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: t, x2: 0, y2: -t }) } }]), n }(ft.ArrowheadShape), ft.UpperLParenArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: 0, u: pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,1 0," + -2 * t }) } }]), n }(ft.ArrowheadShape), ft.LowerLParenArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: 0, u: 0, d: pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,0 0," + 2 * t }) } }]), n }(ft.ArrowheadShape), ft.LParenArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .5 * pe.measure.lineElementLength, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M" + t + "," + -t + " A " + t + "," + t + " 0 0,0 " + t + "," + t }) } }]), n }(ft.ArrowheadShape), ft.UpperRParenArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .5 * pe.measure.lineElementLength, u: pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,0 0," + -2 * t }) } }]), n }(ft.ArrowheadShape), ft.LowerRParenArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .5 * pe.measure.lineElementLength, u: 0, d: pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,1 0," + 2 * t }) } }]), n }(ft.ArrowheadShape), ft.RParenArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: 0, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M" + -t + "," + -t + " A " + t + "," + t + " 0 0,1 " + -t + "," + t }) } }]), n }(ft.ArrowheadShape), ft.LowerBackquoteArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: 0, u: 0, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,0 " + -t + "," + t }) } }]), n }(ft.ArrowheadShape), ft.UpperBackquoteArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: 0, u: .5 * pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,1 " + -t + "," + -t }) } }]), n }(ft.ArrowheadShape), ft.LowerQuoteArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .5 * pe.measure.lineElementLength, u: 0, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,1 " + t + "," + t }) } }]), n }(ft.ArrowheadShape), ft.UpperQuoteArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .5 * pe.measure.lineElementLength, u: .5 * pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("path", { d: "M0,0 A " + t + "," + t + " 0 0,0 " + t + "," + -t }) } }]), n }(ft.ArrowheadShape), ft.AsteriskArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = 0, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: pe.measure.thickness, u: pe.measure.thickness, d: pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { e.createSVGElement("circle", { cx: 0, cy: 0, r: pe.measure.em2px(pe.measure.thickness), fill: "currentColor" }) } }]), n }(ft.ArrowheadShape), ft.OArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = 0, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: pe.measure.thickness, u: pe.measure.thickness, d: pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { e.createSVGElement("circle", { cx: 0, cy: 0, r: pe.measure.em2px(pe.measure.thickness) }) } }]), n }(ft.ArrowheadShape), ft.PlusArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: .5 * pe.measure.lineElementLength, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.lineElementLength / 2, n = pe.measure.em2px(t); e.createSVGElement("line", { x1: -n, y1: 0, x2: n, y2: 0 }), e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }) } }]), n }(ft.ArrowheadShape), ft.XArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r + Math.PI / 4, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .5 * pe.measure.lineElementLength, r: .5 * pe.measure.lineElementLength, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.lineElementLength / 2, n = pe.measure.em2px(t); e.createSVGElement("line", { x1: -n, y1: 0, x2: n, y2: 0 }), e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }) } }]), n }(ft.ArrowheadShape), ft.SlashArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r - Math.PI / 10, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: pe.measure.lineElementLength / 2, d: pe.measure.lineElementLength / 2 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.lineElementLength / 2, n = pe.measure.em2px(t); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }) } }]), n }(ft.ArrowheadShape), ft.Line3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: pe.measure.thickness, d: pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.lineElementLength), n = pe.measure.em2px(pe.measure.thickness); e.createSVGElement("line", { x1: 0, y1: n, x2: t, y2: n }), e.createSVGElement("line", { x1: 0, y1: 0, x2: t, y2: 0 }), e.createSVGElement("line", { x1: 0, y1: -n, x2: t, y2: -n }) } }]), n }(ft.ArrowheadShape), ft.Line2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: .5 * pe.measure.thickness, d: .5 * pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(.5 * pe.measure.thickness), n = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: t, x2: n, y2: t }), e.createSVGElement("line", { x1: 0, y1: -t, x2: n, y2: -t }) } }]), n }(ft.ArrowheadShape), ft.LineArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: 0, d: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: t, y2: 0 }) } }]), n }(ft.ArrowheadShape), ft.Dot3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: pe.measure.thickness, d: pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { pe.measure.oneem; var t = pe.measure.em2px(pe.measure.thickness), n = pe.measure.em2px(pe.measure.thickness), r = pe.measure.dottedDasharray; e.createSVGElement("line", { x1: 0, y1: t, x2: n, y2: t, "stroke-dasharray": r }), e.createSVGElement("line", { x1: 0, y1: 0, x2: n, y2: 0, "stroke-dasharray": r }), e.createSVGElement("line", { x1: 0, y1: -t, x2: n, y2: -t, "stroke-dasharray": r }) } }]), n }(ft.ArrowheadShape), ft.Dot2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: .5 * pe.measure.thickness, d: .5 * pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(.5 * pe.measure.thickness), n = pe.measure.em2px(pe.measure.thickness), r = pe.measure.dottedDasharray; e.createSVGElement("line", { x1: 0, y1: t, x2: n, y2: t, "stroke-dasharray": r }), e.createSVGElement("line", { x1: 0, y1: -t, x2: n, y2: -t, "stroke-dasharray": r }) } }]), n }(ft.ArrowheadShape), ft.DotArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: 0, u: 0, d: 0 } } }, { key: "drawDelegate", value: function (e) { pe.measure.oneem; var t = pe.measure.em2px(pe.measure.thickness), n = pe.measure.dottedDasharray; e.createSVGElement("line", { x1: 0, y1: 0, x2: t, y2: 0, "stroke-dasharray": n }) } }]), n }(ft.ArrowheadShape), ft.Tilde3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: -2 * pe.measure.thickness, r: 2 * pe.measure.thickness, u: 2 * pe.measure.thickness, d: 2 * pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.thickness); e.createSVGElement("path", { d: "M" + -2 * t + "," + t + " Q" + -t + ",0 0," + t + " T" + 2 * t + "," + t + "M" + -2 * t + ",0 Q" + -t + "," + -t + " 0,0 T" + 2 * t + ",0M" + -2 * t + "," + -t + " Q" + -t + "," + -2 * t + " 0," + -t + " T" + 2 * t + "," + -t }) } }]), n }(ft.ArrowheadShape), ft.Tilde2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: -2 * pe.measure.thickness, r: 2 * pe.measure.thickness, u: 1.5 * pe.measure.thickness, d: 1.5 * pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.thickness); e.createSVGElement("path", { d: "M" + -2 * t + "," + .5 * t + " Q" + -t + "," + -.5 * t + " 0," + .5 * t + " T" + 2 * t + "," + .5 * t + "M" + -2 * t + "," + -.5 * t + " Q" + -t + "," + -1.5 * t + " 0," + -.5 * t + " T" + 2 * t + "," + -.5 * t }) } }]), n }(ft.ArrowheadShape), ft.TildeArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: -2 * pe.measure.thickness, r: 2 * pe.measure.thickness, u: pe.measure.thickness, d: pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.thickness); e.createSVGElement("path", { d: "M" + -2 * t + ",0 Q" + -t + "," + -t + " 0,0 T" + 2 * t + ",0" }) } }]), n }(ft.ArrowheadShape), ft.TildeArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: -2 * pe.measure.thickness, r: 2 * pe.measure.thickness, u: pe.measure.thickness, d: pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.thickness); e.createSVGElement("path", { d: "M" + -2 * t + ",0 Q" + -t + "," + -t + " 0,0 T" + 2 * t + ",0" }) } }]), n }(ft.ArrowheadShape), ft.GTGTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .489 * e + 2 * pe.measure.thickness, r: 0, d: .147 * e, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + -r + ",0 Q" + (pe.measure.em2px(-.222 * t) - r) + "," + pe.measure.em2px(.02 * t) + " " + (pe.measure.em2px(-.489 * t) - r) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M" + -r + ",0 Q" + (pe.measure.em2px(-.222 * t) - r) + "," + pe.measure.em2px(-.02 * t) + " " + (pe.measure.em2px(-.489 * t) - r) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.UpperGTGTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .489 * e + 2 * pe.measure.thickness, r: 0, d: 0, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + -r + ",0 Q" + (pe.measure.em2px(-.222 * t) - r) + "," + pe.measure.em2px(-.02 * t) + " " + (pe.measure.em2px(-.489 * t) - r) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LowerGTGTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .489 * e + 2 * pe.measure.thickness, r: 0, d: .147 * e, u: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + -r + ",0 Q" + (pe.measure.em2px(-.222 * t) - r) + "," + pe.measure.em2px(.02 * t) + " " + (pe.measure.em2px(-.489 * t) - r) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.GTGT2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .456 * e + 2 * pe.measure.thickness, r: 0, d: .229 * e, u: .229 * e } } }, { key: "getRadius", value: function () { return .213 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = e.createGroup(e.transformBuilder().rotateDegree(-10)), i = e.createGroup(e.transformBuilder().rotateDegree(10)); r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), i.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }); var a = e.createGroup(e.transformBuilder().translate(-2 * n, 0).rotateDegree(-10)), o = e.createGroup(e.transformBuilder().translate(-2 * n, 0).rotateDegree(10)); a.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), o.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.GTGT3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: .507 * e + 2 * pe.measure.thickness, r: 0, d: .268 * e, u: .268 * e } } }, { key: "getRadius", value: function () { return .325 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = e.createGroup(e.transformBuilder().rotateDegree(-15)), i = e.createGroup(e.transformBuilder().rotateDegree(15)); r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), i.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }); var a = e.createGroup(e.transformBuilder().translate(-2 * n, 0).rotateDegree(-15)), o = e.createGroup(e.transformBuilder().translate(-2 * n, 0).rotateDegree(15)); a.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), o.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("line", { x1: 0, y1: 0, x2: pe.measure.em2px(-.507 * t - 2 * n), y2: 0 }) } }]), n }(ft.ArrowheadShape), ft.LTLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .489 * e + 2 * pe.measure.thickness, d: .147 * e, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + r + ",0 Q" + (pe.measure.em2px(.222 * t) + r) + "," + pe.measure.em2px(-.02 * t) + " " + (pe.measure.em2px(.489 * t) + r) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M" + r + ",0 Q" + (pe.measure.em2px(.222 * t) + r) + "," + pe.measure.em2px(.02 * t) + " " + (pe.measure.em2px(.489 * t) + r) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.UpperLTLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .489 * e + 2 * pe.measure.thickness, d: 0, u: .147 * e } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + r + ",0 Q" + (pe.measure.em2px(.222 * t) + r) + "," + pe.measure.em2px(-.02 * t) + " " + (pe.measure.em2px(.489 * t) + r) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LowerLTLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .489 * e + 2 * pe.measure.thickness, d: .147 * e, u: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + r + ",0 Q" + (pe.measure.em2px(.222 * t) + r) + "," + pe.measure.em2px(.02 * t) + " " + (pe.measure.em2px(.489 * t) + r) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LTLT2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .456 + e + 2 * pe.measure.thickness, d: .229 * e, u: .229 * e } } }, { key: "getRadius", value: function () { return .213 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = e.createGroup(e.transformBuilder().translate(2 * n, 0).rotateDegree(10)), i = e.createGroup(e.transformBuilder().translate(2 * n, 0).rotateDegree(-10)); r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), i.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }); var a = e.createGroup(e.transformBuilder().rotateDegree(10)), o = e.createGroup(e.transformBuilder().rotateDegree(-10)); a.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), o.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.LTLT3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: 0, r: .507 * e + 2 * pe.measure.thickness, d: .268 * e, u: .268 * e } } }, { key: "getRadius", value: function () { return .325 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = e.createGroup(e.transformBuilder().translate(2 * n, 0).rotateDegree(15)), i = e.createGroup(e.transformBuilder().translate(2 * n, 0).rotateDegree(-15)); r.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), i.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }); var a = e.createGroup(e.transformBuilder().rotateDegree(15)), o = e.createGroup(e.transformBuilder().rotateDegree(-15)); a.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), o.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("line", { x1: 0, y1: 0, x2: pe.measure.em2px(.507 * t + 2 * n), y2: 0 }) } }]), n }(ft.ArrowheadShape), ft.ColumnColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: 0, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }), e.createSVGElement("line", { x1: -pe.measure.em2px(t), y1: n, x2: -pe.measure.em2px(t), y2: -n }) } }]), n }(ft.ArrowheadShape), ft.UpperColumnColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: 0, u: pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: 0, y2: -n }), e.createSVGElement("line", { x1: -pe.measure.em2px(t), y1: 0, x2: -pe.measure.em2px(t), y2: -n }) } }]), n }(ft.ArrowheadShape), ft.LowerColumnColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: 0, u: 0, d: pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: 0, y2: n }), e.createSVGElement("line", { x1: -pe.measure.em2px(t), y1: 0, x2: -pe.measure.em2px(t), y2: n }) } }]), n }(ft.ArrowheadShape), ft.ColumnColumn2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: 0, u: .5 * (pe.measure.lineElementLength + pe.measure.thickness), d: .5 * (pe.measure.lineElementLength + pe.measure.thickness) } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = pe.measure.em2px(.5 * (pe.measure.lineElementLength + pe.measure.thickness)); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }), e.createSVGElement("line", { x1: -pe.measure.em2px(t), y1: n, x2: -pe.measure.em2px(t), y2: -n }) } }]), n }(ft.ArrowheadShape), ft.ColumnColumn3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: 0, u: .5 * pe.measure.lineElementLength + pe.measure.thickness, d: .5 * pe.measure.lineElementLength + pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = (t = pe.measure.thickness, pe.measure.em2px(.5 * pe.measure.lineElementLength + pe.measure.thickness)); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }), e.createSVGElement("line", { x1: -pe.measure.em2px(t), y1: n, x2: -pe.measure.em2px(t), y2: -n }) } }]), n }(ft.ArrowheadShape), ft.ColumnLineArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: t, x2: 0, y2: -t }); var n = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: n, y2: 0 }) } }]), n }(ft.ArrowheadShape), ft.UpperColumnLineArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: pe.measure.lineElementLength, d: 0 } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: 0, y2: -t }); var n = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: n, y2: 0 }) } }]), n }(ft.ArrowheadShape), ft.LowerColumnLineArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: 0, d: pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { pe.measure.thickness; var t = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: 0, y2: t }); var n = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: 0, x2: n, y2: 0 }) } }]), n }(ft.ArrowheadShape), ft.ColumnLine2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: .5 * (pe.measure.lineElementLength + pe.measure.thickness), d: .5 * (pe.measure.lineElementLength + pe.measure.thickness) } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = pe.measure.em2px(.5 * (pe.measure.lineElementLength + pe.measure.thickness)); e.createSVGElement("line", { x1: 0, y1: -n, x2: 0, y2: n }); var r = pe.measure.em2px(.5 * t), i = pe.measure.em2px(pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: r, x2: i, y2: r }), e.createSVGElement("line", { x1: 0, y1: -r, x2: i, y2: -r }) } }]), n }(ft.ArrowheadShape), ft.ColumnLine3ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: pe.measure.lineElementLength, u: .5 * pe.measure.lineElementLength + pe.measure.thickness, d: .5 * pe.measure.lineElementLength + pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.thickness, n = pe.measure.em2px(.5 * pe.measure.lineElementLength + pe.measure.thickness); e.createSVGElement("line", { x1: 0, y1: -n, x2: 0, y2: n }); var r = pe.measure.em2px(pe.measure.lineElementLength), i = pe.measure.em2px(t); e.createSVGElement("line", { x1: 0, y1: i, x2: r, y2: i }), e.createSVGElement("line", { x1: 0, y1: 0, x2: r, y2: 0 }), e.createSVGElement("line", { x1: 0, y1: -i, x2: r, y2: -i }) } }]), n }(ft.ArrowheadShape), ft.GTColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .489 * pe.measure.oneem, r: 0, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.GTGTColumnArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: .489 * pe.measure.oneem + 2 * pe.measure.thickness, r: 0, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: r, x2: 0, y2: -r }); var i = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + -i + ",0 Q" + (pe.measure.em2px(-.222 * t) - i) + "," + pe.measure.em2px(.02 * t) + " " + (pe.measure.em2px(-.489 * t) - i) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M" + -i + ",0 Q" + (pe.measure.em2px(-.222 * t) - i) + "," + pe.measure.em2px(-.02 * t) + " " + (pe.measure.em2px(-.489 * t) - i) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.ColumnLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .489 * pe.measure.oneem, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = (pe.measure.thickness, pe.measure.em2px(.5 * pe.measure.lineElementLength)); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.ColumnLTLTArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: 0, r: .489 * pe.measure.oneem + 2 * pe.measure.thickness, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.thickness, r = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: r, x2: 0, y2: -r }); var i = pe.measure.em2px(2 * n); e.createSVGElement("path", { d: "M" + i + ",0 Q" + (pe.measure.em2px(.222 * t) + i) + "," + pe.measure.em2px(-.02 * t) + " " + (pe.measure.em2px(.489 * t) + i) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M" + i + ",0 Q" + (pe.measure.em2px(.222 * t) + i) + "," + pe.measure.em2px(.02 * t) + " " + (pe.measure.em2px(.489 * t) + i) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(-.147 * t) }), e.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(.489 * t) + "," + pe.measure.em2px(.147 * t) }) } }]), n }(ft.ArrowheadShape), ft.SlashSlashArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r - Math.PI / 10, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { return { l: pe.measure.thickness, r: 0, u: .5 * pe.measure.lineElementLength, d: .5 * pe.measure.lineElementLength } } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.em2px(pe.measure.thickness), n = pe.measure.em2px(.5 * pe.measure.lineElementLength); e.createSVGElement("line", { x1: 0, y1: n, x2: 0, y2: -n }), e.createSVGElement("line", { x1: -t, y1: n, x2: -t, y2: -n }) } }]), n }(ft.ArrowheadShape), ft.LineGT2ArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { var e = pe.measure.oneem; return { l: pe.measure.lineElementLength, r: pe.measure.lineElementLength, d: .229 * e, u: .229 * e } } }, { key: "getRadius", value: function () { return .213 * pe.measure.oneem } }, { key: "drawDelegate", value: function (e) { var t = pe.measure.oneem, n = pe.measure.lineElementLength, r = pe.measure.em2px(n), i = .5 * pe.measure.thickness, a = pe.measure.em2px(i), o = this.getRadius(), u = pe.measure.em2px(Math.sqrt(o * o - i * i)), s = e.createGroup(e.transformBuilder().translate(n, 0).rotateDegree(-10)), c = e.createGroup(e.transformBuilder().translate(n, 0).rotateDegree(10)); s.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(-.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(-.147 * t) }), c.createSVGElement("path", { d: "M0,0 Q" + pe.measure.em2px(-.222 * t) + "," + pe.measure.em2px(.02 * t) + " " + pe.measure.em2px(-.489 * t) + "," + pe.measure.em2px(.147 * t) }), e.createSVGElement("path", { d: "M" + -r + "," + a + " L" + (r - u) + "," + a + " M" + -r + "," + -a + " L" + (r - u) + "," + -a }) } }]), n }(ft.ArrowheadShape), ft.TwocellEqualityArrowheadShape = function (e) { at(n, e); var t = ut(n); function n(e, r) { var i; return lt(this, n), (i = t.call(this)).c = e, i.angle = r, Xe(ct(i), "getBoundingBox"), i } return pt(n, [{ key: "getBox", value: function () { pe.measure.oneem; return { l: pe.measure.lineElementLength, r: pe.measure.lineElementLength, d: .5 * pe.measure.thickness, u: .5 * pe.measure.thickness } } }, { key: "drawDelegate", value: function (e) { pe.measure.oneem; var t = pe.measure.em2px(pe.measure.lineElementLength), n = pe.measure.em2px(.5 * pe.measure.thickness); e.createSVGElement("path", { d: "M" + -t + "," + n + " L" + t + "," + n + " M" + -t + "," + -n + " L" + t + "," + -n }) } }]), n }(ft.ArrowheadShape), ft.LineShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a, o) { var u; return lt(this, n), (u = t.call(this)).line = e, u.object = r, u.main = i, u.variant = a, u.bbox = o, u.holeRanges = L.empty, u } return pt(n, [{ key: "sliceHole", value: function (e) { this.holeRanges = this.holeRanges.prepend(e) } }, { key: "draw", value: function (e) { this.line.drawLine(e, this.object, this.main, this.variant, this.holeRanges) } }, { key: "getBoundingBox", value: function () { return this.bbox } }, { key: "toString", value: function () { return "LineShape[line:" + this.line + ", object:" + this.object + ", main:" + this.main + ", variant:" + this.variant + "]" } }]), n }(ft), ft.CurveShape = function (e) { at(n, e); var t = ut(n); function n(e, r, i, a) { var o; return lt(this, n), (o = t.call(this)).curve = e, o.objectForDrop = r, o.objectForConnect = i, o.bbox = a, o.holeRanges = L.empty, o } return pt(n, [{ key: "sliceHole", value: function (e) { this.holeRanges = this.holeRanges.prepend(e) } }, { key: "draw", value: function (e) { this.curve.drawCurve(e, this.objectForDrop, this.objectForConnect, this.holeRanges) } }, { key: "getBoundingBox", value: function () { return this.bbox } }, { key: "toString", value: function () { return "CurveShape[curve" + this.curve + ", objectForDrop:" + (void 0 !== this.objectForDrop ? this.objectForDrop.toString() : "null") + ", objectForConnect:" + (void 0 !== this.objectForConnect ? this.objectForConnect.toString() : "null") + "]" } }]), n }(ft); var yt = function () { function e(t, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), t > n ? (this.start = n, this.end = t) : (this.start = t, this.end = n) } var t, n, r; return t = e, (n = [{ key: "difference", value: function (t) { var n = L.empty, r = this.start, i = this.end, a = t.start, o = t.end; return i <= a || o <= r ? n = n.prepend(this) : r < a ? n = i <= o ? n.prepend(new e(r, a)) : (n = n.prepend(new e(r, a))).prepend(new e(o, i)) : o < i && (n = n.prepend(new e(o, i))), n } }, { key: "differenceRanges", value: function (e) { var t = L.empty.prepend(this); return e.foreach((function (e) { t = t.flatMap((function (t) { return t.difference(e) })) })), t } }, { key: "toString", value: function () { return "[" + this.start + ", " + this.end + "]" } }]) && dt(t.prototype, n), r && dt(t, r), e }(); function vt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } var xt = function () { function e(t, n) { !function (e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") }(this, e), this.shape = t, this.env = n } var t, n, r; return t = e, (n = [{ key: "duplicateEnv", value: function () { var t = this.env.duplicate(); return new e(this.shape, t) } }, { key: "appendShapeToFront", value: function (e) { e.isNone || (this.shape.isNone ? this.shape = e : this.shape = new ft.CompositeShape(e, this.shape)) } }, { key: "appendShapeToBack", value: function (e) { e.isNone || (this.shape.isNone ? this.shape = e : this.shape = new ft.CompositeShape(this.shape, e)) } }]) && vt(t.prototype, n), r && vt(t, r), e }(); function gt(e) { return gt = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, gt(e) } function wt(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && St(e, t) } function St(e, t) { return St = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, St(e, t) } function bt(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = kt(e); if (t) { var i = kt(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return Ct(this, n) } } function Ct(e, t) { if (t && ("object" === gt(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function kt(e) { return kt = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, kt(e) } function Mt(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function Pt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function Bt(e, t, n) { return t && Pt(e.prototype, t), n && Pt(e, n), e } var Ot = function () { function e() { Mt(this, e); var t = pe.measure.length2em("1mm"); this.origin = { x: 0, y: 0 }, this.xBase = { x: t, y: 0 }, this.yBase = { x: 0, y: t }, this.savedPosition = {}, this.stateStack = L.empty, this.stackFrames = L.empty, this.stack = L.empty, this.angle = 0, this.lastCurve = Lt.none, this.p = this.c = e.originPosition, this.shouldCapturePos = !1, this.capturedPositions = L.empty, this.objectmargin = pe.measure.objectmargin, this.objectheight = pe.measure.objectheight, this.objectwidth = pe.measure.objectwidth, this.labelmargin = pe.measure.labelmargin } return Bt(e, [{ key: "duplicate", value: function () { var t = new e; return e.copyFields(this, t), t } }, { key: "saveState", value: function () { var e = this.duplicate(); this.stateStack = this.stateStack.prepend(e) } }, { key: "restoreState", value: function () { if (!this.stateStack.isEmpty) { var t = this.stateStack.head; this.stateStack = this.stateStack.tail, e.copyFields(t, this) } } }, { key: "absVector", value: function (e, t) { return { x: this.origin.x + e * this.xBase.x + t * this.yBase.x, y: this.origin.y + e * this.xBase.y + t * this.yBase.y } } }, { key: "inverseAbsVector", value: function (e, t) { var n = this.xBase.x, r = this.xBase.y, i = this.yBase.x, a = this.yBase.y, o = n * a - r * i, u = e - this.origin.x, s = t - this.origin.y; return { x: (a * u - i * s) / o, y: (-r * u + n * s) / o } } }, { key: "setOrigin", value: function (e, t) { this.origin = { x: e, y: t } } }, { key: "setXBase", value: function (e, t) { this.xBase = { x: e, y: t } } }, { key: "setYBase", value: function (e, t) { this.yBase = { x: e, y: t } } }, { key: "swapPAndC", value: function () { var e = this.p; this.p = this.c, this.c = e } }, { key: "enterStackFrame", value: function () { this.stackFrames = this.stackFrames.prepend(this.stack), this.initStack() } }, { key: "leaveStackFrame", value: function () { this.stackFrames.isEmpty ? this.initStack() : (this.stack = this.stackFrames.head, this.stackFrames = this.stackFrames.tail) } }, { key: "savePos", value: function (e, t) { this.savedPosition[e] = t } }, { key: "startCapturePositions", value: function () { this.shouldCapturePos = !0, this.capturedPositions = L.empty } }, { key: "endCapturePositions", value: function () { this.shouldCapturePos = !1; var e = this.capturedPositions; return this.capturedPositions = L.empty, e } }, { key: "capturePosition", value: function (e) { this.shouldCapturePos && void 0 !== e && (this.capturedPositions = this.capturedPositions.prepend(e)) } }, { key: "pushPos", value: function (e) { void 0 !== e && (this.stack = this.stack.prepend(e)) } }, { key: "popPos", value: function () { if (this.stack.isEmpty) throw s("ExecutionError", "cannot pop from the empty stack"); var e = this.stack.head; return this.stack = this.stack.tail, e } }, { key: "initStack", value: function () { this.stack = L.empty } }, { key: "setStack", value: function (e) { this.stack = e } }, { key: "stackAt", value: function (e) { return this.stack.at(e) } }, { key: "lookupPos", value: function (e, t) { var n = this.savedPosition[e]; if (void 0 === n) throw s("ExecutionError", void 0 !== t ? t : '<pos> "' + e + '" not defined.'); return n } }, { key: "toString", value: function () { var e = ""; for (var t in this.savedPosition) this.savedPosition.hasOwnProperty(t) && (e.length > 0 && (e += ", "), e += t.toString() + ":" + this.savedPosition[t]); return "Env\n  p:" + this.p + "\n  c:" + this.c + "\n  angle:" + this.angle + "\n  lastCurve:" + this.lastCurve + "\n  savedPosition:{" + e + "}\n  origin:{x:" + this.origin.x + ", y:" + this.origin.y + "}\n  xBase:{x:" + this.xBase.x + ", y:" + this.xBase.y + "}\n  yBase:{x:" + this.yBase.x + ", y:" + this.yBase.y + "}\n  stackFrames:" + this.stackFrames + "\n  stack:" + this.stack + "\n  shouldCapturePos:" + this.shouldCapturePos + "\n  capturedPositions:" + this.capturedPositions } }], [{ key: "copyFields", value: function (e, t) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]); for (var r in t.savedPosition = {}, e.savedPosition) e.savedPosition.hasOwnProperty(r) && (t.savedPosition[r] = e.savedPosition[r]) } }]), e }(); Ot.originPosition = new rt.Point(0, 0); var Et = function () { function e() { Mt(this, e) } return Bt(e, [{ key: "velocity", value: function (e) { var t = this.dpx(e), n = this.dpy(e); return Math.sqrt(t * t + n * n) } }, { key: "length", value: function (e) { if (e < 0 || e > 1) throw s("ExecutionError", "illegal cubic Bezier parameter t:" + e); this.buildLengthArray(); var t = e * c.lengthResolution, n = Math.floor(t), r = Math.ceil(t); if (n === r) return this.lengthArray[n]; var i = this.lengthArray[n]; return i + (this.lengthArray[r] - i) / (r - n) * (t - n) } }, { key: "tOfLength", value: function (e) { this.buildLengthArray(); var t, n, r, i = this.lengthArray; if (e < i[0]) return 0; if (e > i[i.length - 1]) return 1; for (var a = 0, o = i.length - 2; a <= o && (n = i[t = a + o >> 1], r = i[t + 1], !(e >= n && e <= r));)e < n ? o = t - 1 : a = t + 1; var u = c.lengthResolution; return n === r ? t / u : (t + (e - n) / (r - n)) / u } }, { key: "tOfShavedStart", value: function (e) { if (e.isPoint()) return 0; var t = this.tOfIntersections(e); return 0 != t.length ? Math.min.apply(Math, t) : void 0 } }, { key: "tOfShavedEnd", value: function (e) { if (e.isPoint()) return 1; var t = this.tOfIntersections(e); return 0 != t.length ? Math.max.apply(Math, t) : void 0 } }, { key: "shaveStart", value: function (e) { if (e.isPoint()) return this; var t = this.tOfIntersections(e); if (0 != t.length) { var n = Math.min.apply(Math, t); return this.divide(n)[1] } } }, { key: "shaveEnd", value: function (e) { if (e.isPoint()) return this; var t = this.tOfIntersections(e); if (0 != t.length) { var n = Math.max.apply(Math, t); return this.divide(n)[0] } } }, { key: "buildLengthArray", value: function () { if (void 0 === this.lengthArray) { var e = c.lengthResolution, t = new Array(e + 1), n = 0, r = .5 / e, i = 0, a = r / 3; t[0] = 0, n = this.velocity(0) + 4 * this.velocity(r); var o = this.velocity(2 * r); for (t[1] = a * (n + o), i = 2; i <= e; i++)n += 2 * o + 4 * this.velocity((2 * i - 1) * r), o = this.velocity(2 * i * r), t[i] = a * (n + o); this.lengthArray = t } } }, { key: "drawParallelCurve", value: function (t, n) { var r, i, a, o, u, s, h, l, m = this.countOfSegments() * c.interpolationResolution, p = new Array(m + 1), f = new Array(m + 1), d = new Array(m + 1), y = new Array(m + 1), v = new Array(m + 1), x = Math.PI / 2, g = n; for (r = 0; r <= m; r++)i = r / m, p[r] = i, a = this.angle(i), u = (o = this.position(i)).x, s = o.y, h = g * Math.cos(a + x), l = g * Math.sin(a + x), f[r] = u + h, d[r] = s + l, y[r] = u - h, v[r] = s - l; e.CubicBeziers.interpolation(p, f, d).drawPrimitive(t, "none"), e.CubicBeziers.interpolation(p, y, v).drawPrimitive(t, "none") } }, { key: "drawParallelDottedCurve", value: function (e, t, n) { var r = 1 / pe.measure.em, i = r / 2, a = r + t, o = this.length(1), u = Math.floor((o - r) / a), s = n; if (u >= 0) { var c, h = Math.PI / 2, l = this.startPosition(); this.endPosition(); for (c = 0; c <= u; c++) { l = i + c * a; var m = this.tOfLength(l), p = this.angle(m), f = this.position(m), d = f.x, y = f.y, v = s * Math.cos(p + h), x = s * Math.sin(p + h); e.createSVGElement("circle", { cx: pe.measure.em2px(d + v), cy: -pe.measure.em2px(y + x), r: .12, fill: "currentColor" }), e.createSVGElement("circle", { cx: pe.measure.em2px(d - v), cy: -pe.measure.em2px(y - x), r: .12, fill: "currentColor" }) } } } }, { key: "drawParallelDashedCurve", value: function (t, n, r) { var i, a, o, u, s, c, h, l, m = this.length(1), p = Math.floor((m - n) / (2 * n)), f = 2 * p + 1, d = (m - n) / 2 - p * n, y = new Array(p + 1), v = new Array(p + 1), x = new Array(p + 1), g = new Array(p + 1), w = new Array(p + 1), S = Math.PI / 2, b = r; for (i = 0; i <= f; i++)a = this.tOfLength(d + i * n), y[i] = a, o = this.angle(a), s = (u = this.position(a)).x, c = u.y, h = b * Math.cos(o + S), l = b * Math.sin(o + S), v[i] = s + h, x[i] = c + l, g[i] = s - h, w[i] = c - l; e.CubicBeziers.interpolation(y, v, x).drawSkipped(t), e.CubicBeziers.interpolation(y, g, w).drawSkipped(t) } }, { key: "drawSquigCurve", value: function (e, t) { var n = pe.measure.length2em("0.15em"), r = this.length(1), i = 4 * n, a = n; if (r >= i) { var o, u, s, c, h, l, m, p, f, d = Math.floor(r / i), y = (r - d * i) / 2, v = Math.PI / 2; switch (t) { case "3": o = y, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m = "M" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p = "M" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), f = "M" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l); for (var x = 0; x < d; x++)o = y + i * x + n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x + 2 * h) + "," + pe.measure.em2px(-s.y - 2 * l), p += " Q" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), f += " Q" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), o = y + i * x + 2 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), f += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * x + 3 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), p += " Q" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), f += " " + pe.measure.em2px(s.x - 2 * h) + "," + pe.measure.em2px(-s.y + 2 * l), o = y + i * (x + 1), u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), f += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l); e.createSVGElement("path", { d: m }), e.createSVGElement("path", { d: p }), e.createSVGElement("path", { d: f }); break; case "2": o = y, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m = "M" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p = "M" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l); for (x = 0; x < d; x++)o = y + i * x + n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " Q" + pe.measure.em2px(s.x + 3 * h) + "," + pe.measure.em2px(-s.y - 3 * l), p += " Q" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), o = y + i * x + 2 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * x + 3 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " Q" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), p += " Q" + pe.measure.em2px(s.x - 3 * h) + "," + pe.measure.em2px(-s.y + 3 * l), o = y + i * (x + 1), u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l); e.createSVGElement("path", { d: m }), e.createSVGElement("path", { d: p }); break; default: o = y, u = this.tOfLength(o), s = this.position(u), m = "M" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y); for (x = 0; x < d; x++)o = y + i * x + n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), o = y + i * x + 2 * n, u = this.tOfLength(o), s = this.position(u), m += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), o = y + i * x + 3 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * (x + 1), u = this.tOfLength(o), s = this.position(u), m += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y); e.createSVGElement("path", { d: m }) } } } }, { key: "drawDashSquigCurve", value: function (e, t) { var n = pe.measure.thickness, r = this.length(1), i = 4 * n, a = n; if (r >= i) { var o, u, s, c, h, l, m, p, f, d = Math.floor((r - i) / 2 / i), y = (r - i) / 2 - d * i, v = Math.PI / 2; switch (t) { case "3": m = p = f = ""; for (var x = 0; x <= d; x++)o = y + i * x * 2, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " M" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " M" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), f += " M" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * x * 2 + n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x + 2 * h) + "," + pe.measure.em2px(-s.y - 2 * l), p += " Q" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), f += " Q" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), o = y + i * x * 2 + 2 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), f += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * x * 2 + 3 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), p += " Q" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), f += " " + pe.measure.em2px(s.x - 2 * h) + "," + pe.measure.em2px(-s.y + 2 * l), o = y + i * (2 * x + 1), u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), f += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l); e.createSVGElement("path", { d: m }), e.createSVGElement("path", { d: p }), e.createSVGElement("path", { d: f }); break; case "2": m = p = ""; for (x = 0; x <= d; x++)o = y + i * x * 2, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " M" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " M" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * x * 2 + n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " Q" + pe.measure.em2px(s.x + 3 * h) + "," + pe.measure.em2px(-s.y - 3 * l), p += " Q" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), o = y + i * x * 2 + 2 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * x * 2 + 3 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " Q" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), p += " Q" + pe.measure.em2px(s.x - 3 * h) + "," + pe.measure.em2px(-s.y + 3 * l), o = y + i * (2 * x + 1), u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v) / 2, l = a * Math.sin(c + v) / 2, m += " " + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), p += " " + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l); e.createSVGElement("path", { d: m }), e.createSVGElement("path", { d: p }); break; default: m = ""; for (x = 0; x <= d; x++)o = y + i * x * 2, u = this.tOfLength(o), s = this.position(u), m += " M" + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), o = y + i * x * 2 + n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x + h) + "," + pe.measure.em2px(-s.y - l), o = y + i * x * 2 + 2 * n, u = this.tOfLength(o), s = this.position(u), m += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), o = y + i * x * 2 + 3 * n, u = this.tOfLength(o), s = this.position(u), c = this.angle(u), h = a * Math.cos(c + v), l = a * Math.sin(c + v), m += " Q" + pe.measure.em2px(s.x - h) + "," + pe.measure.em2px(-s.y + l), o = y + i * (2 * x + 1), u = this.tOfLength(o), s = this.position(u), m += " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y); e.createSVGElement("path", { d: m }) } } } }, { key: "drawCurve", value: function (e, t, n, r) { if (r.isEmpty) this._drawCurve(e, t, n); else { var i = new yt(0, 1).differenceRanges(r), a = this; i.foreach((function (r) { a.slice(r.start, r.end)._drawCurve(e, t, n) })) } } }, { key: "_drawCurve", value: function (e, t, n) { var r, i = pe.measure.length2em("0.15em"); if (void 0 !== n) { var a = n.dirMain(), o = n.dirVariant(); switch (a) { case "=": a = "-", o = "2"; break; case "==": a = "--", o = "2"; break; case ":": case "::": a = ".", o = "2" }switch (a) { case "": break; case "-": switch (o) { case "2": r = i / 2, this.drawParallelCurve(e, r); break; case "3": r = i, this.drawParallelCurve(e, r), this.drawPrimitive(e, "none"); break; default: r = 0, this.drawPrimitive(e, "none") }break; case ".": case "..": switch (o) { case "2": r = i / 2, this.drawParallelDottedCurve(e, i, r); break; case "3": r = i, this.drawParallelDottedCurve(e, i, r), this.drawPrimitive(e, pe.measure.dottedDasharray); break; default: r = 0, this.drawPrimitive(e, pe.measure.dottedDasharray) }break; case "--": var u = 3 * i; if ((x = this.length(1)) >= u) switch (o) { case "2": r = i / 2, this.drawParallelDashedCurve(e, u, r); break; case "3": r = i, this.drawParallelDashedCurve(e, u, r); var s = (x - u) / 2 - Math.floor((x - u) / 2 / u) * u, c = this.tOfLength(s); this.divide(c)[1].drawPrimitive(e, pe.measure.em2px(u) + " " + pe.measure.em2px(u)); break; default: r = 0; s = (x - u) / 2 - Math.floor((x - u) / 2 / u) * u, c = this.tOfLength(s); this.divide(c)[1].drawPrimitive(e, pe.measure.em2px(u) + " " + pe.measure.em2px(u)) }break; case "~": switch (this.drawSquigCurve(e, o), o) { case "2": r = 1.5 * i; break; case "3": r = 2 * i; break; default: r = 0 }break; case "~~": switch (this.drawDashSquigCurve(e, o), o) { case "2": r = 1.5 * i; break; case "3": r = 2 * i; break; default: r = 0 }break; default: (w = new Ot).c = Ot.originPosition; var h = new xt(ft.none, w), l = n.boundingBox(h); if (null == l) return; var m, p, f = l.l, d = f + l.r; if (void 0 !== t) { var y = t.boundingBox(h); void 0 !== y && (m = (p = y.l) + y.r) } else m = 0; var v = d + m; 0 == v && (v = pe.measure.strokeWidth); var x = this.length(1); if (0 == (M = Math.floor(x / v))) return; s = (x - M * v) / 2, h = new xt(ft.none, w); for (var g = 0; g < M; g++) { P = s + g * v, void 0 !== t && (B = this.tOfLength(P + p), w.c = this.position(B), w.angle = this.angle(B), t.toDropShape(h).draw(e)), B = this.tOfLength(P + m + f), w.c = this.position(B), w.angle = this.angle(B); n.toDropShape(h).draw(e) } } } else { var w; (w = new Ot).c = Ot.originPosition; h = new xt(ft.none, w); var S = t, b = S.boundingBox(h); if (void 0 === b) return; var C = b.l + b.r, k = C; 0 == k && (k = pe.measure.strokeWidth); var M; x = this.length(1); if (0 == (M = Math.floor(x / k))) return; for (s = (x - M * k + k - C) / 2 + b.l, h = new xt(ft.none, w), g = 0; g < M; g++) { var P = s + g * k, B = this.tOfLength(P); w.c = this.position(B), w.angle = 0, S.toDropShape(h).draw(e) } } } }, { key: "toShape", value: function (e, t, n) { var r, i = e.env, a = pe.measure.length2em("0.15em"), o = ft.none; if (void 0 !== n) { var u = n.dirMain(), s = n.dirVariant(); switch (u) { case "=": u = "-", s = "2"; break; case "==": u = "--", s = "2"; break; case ":": case "::": u = ".", s = "2" }switch (u) { case "": r = 0; break; case "-": case ".": case "..": switch (s) { case "2": r = a / 2; break; case "3": r = a; break; default: r = 0 }break; case "--": var c = 3 * a; if ((d = this.length(1)) >= c) switch (s) { case "2": r = a / 2; break; case "3": r = a; break; default: r = 0 }break; case "~": case "~~": switch (s) { case "2": r = 1.5 * a; break; case "3": r = 2 * a; break; default: r = 0 }break; default: var h = n.boundingBox(e); if (null == h) return i.angle = 0, i.lastCurve = Lt.none, ft.none; r = Math.max(h.u, h.d); var l, m = h.l + h.r; if (void 0 !== t) { var p = t.boundingBox(e); void 0 !== p && (l = p.l + p.r, r = Math.max(r, p.u, p.d)) } else l = 0; var f = m + l; 0 == f && (f = pe.measure.strokeWidth); var d = this.length(1); return 0 == Math.floor(d / f) ? (i.angle = 0, i.lastCurve = Lt.none, ft.none) : (o = new ft.CurveShape(this, t, n, this.boundingBox(r)), e.appendShapeToFront(o), o) }return void 0 === r ? ft.none : (o = new ft.CurveShape(this, t, n, this.boundingBox(r)), e.appendShapeToFront(o), o) } if (void 0 !== t) { var y = t.boundingBox(e); if (null == y) return i.angle = 0, i.lastCurve = Lt.none, ft.none; var v = y.l + y.r; 0 == v && (v = pe.measure.strokeWidth); d = this.length(1); return 0 == Math.floor(d / v) ? (i.angle = 0, i.lastCurve = Lt.none, ft.none) : (r = Math.max(y.u, y.d), o = new ft.CurveShape(this, t, n, this.boundingBox(r)), e.appendShapeToFront(o), o) } return o } }], [{ key: "sign", value: function (e) { return e > 0 ? 1 : 0 === e ? 0 : -1 } }, { key: "solutionsOfCubicEq", value: function (t, n, r, i) { if (0 === t) return e.solutionsOfQuadEq(n, r, i); var a = n / 3 / t, o = r / t, u = a * a - o / 3, s = -(i / t) / 2 + o * a / 2 - a * a * a, c = s * s - u * u * u; if (0 === c) { var h = 2 * (d = Math.pow(s, 1 / 3)) - a, l = -d - a; return e.filterByIn0to1([h, l]) } if (c > 0) { var m = s + e.sign(s) * Math.sqrt(c), p = (f = e.sign(m) * Math.pow(Math.abs(m), 1 / 3)) + (d = u / f) - a; return e.filterByIn0to1([p]) } var f = 2 * Math.sqrt(u), d = Math.acos(2 * s / u / f), y = (h = f * Math.cos(d / 3) - a, l = f * Math.cos((d + 2 * Math.PI) / 3) - a, f * Math.cos((d + 4 * Math.PI) / 3) - a); return e.filterByIn0to1([h, l, y]) } }, { key: "solutionsOfQuadEq", value: function (t, n, r) { if (0 === t) return e.solutionsOfLinearEq(n, r); var i = n * n - 4 * r * t; if (i >= 0) { var a = Math.sqrt(i), o = (-n + a) / 2 / t, u = (-n - a) / 2 / t; return e.filterByIn0to1([o, u]) } return [] } }, { key: "solutionsOfLinearEq", value: function (t, n) { return 0 === t ? 0 === n ? 0 : [] : e.filterByIn0to1([-n / t]) } }, { key: "filterByIn0to1", value: function (e) { for (var t = [], n = 0; n < e.length; n++) { var r = e[n]; r >= 0 && r <= 1 && t.push(r) } return t } }]), e }(); Et.QuadBezier = function (e) { wt(n, e); var t = bt(n); function n(e, r, i) { var a; Mt(this, n), (a = t.call(this)).cp0 = e, a.cp1 = r, a.cp2 = i; var o = e.x, u = 2 * (r.x - e.x), s = i.x - 2 * r.x + e.x; a.px = function (e) { return o + e * u + e * e * s }, a.dpx = function (e) { return u + 2 * e * s }; var c = e.y, h = 2 * (r.y - e.y), l = i.y - 2 * r.y + e.y; return a.py = function (e) { return c + e * h + e * e * l }, a.dpy = function (e) { return h + 2 * e * l }, a } return Bt(n, [{ key: "startPosition", value: function () { return this.cp0 } }, { key: "endPosition", value: function () { return this.cp2 } }, { key: "position", value: function (e) { return new rt.Point(this.px(e), this.py(e)) } }, { key: "derivative", value: function (e) { return new rt.Point(this.dpx(e), this.dpy(e)) } }, { key: "angle", value: function (e) { return Math.atan2(this.dpy(e), this.dpx(e)) } }, { key: "boundingBox", value: function (e) { var t = this.maxMin(this.cp0.x, this.cp1.x, this.cp2.x, e), n = this.maxMin(this.cp0.y, this.cp1.y, this.cp2.y, e); if (0 === e) return new rt.Rect(this.cp0.x, this.cp0.y, { l: this.cp0.x - t.min, r: t.max - this.cp0.x, u: n.max - this.cp0.y, d: this.cp0.y - n.min }); var r = Math.PI / 2, i = this.cp0.x, a = this.cp0.y, o = this.cp2.x, u = this.cp2.y, s = this.angle(0) + r, c = this.angle(1) + r, h = e * Math.cos(s), l = e * Math.sin(s), m = e * Math.cos(c), p = e * Math.sin(c), f = Math.min(t.min, i + h, i - h, o + m, o - m), d = Math.max(t.max, i + h, i - h, o + m, o - m), y = Math.min(n.min, a + l, a - l, u + p, u - p), v = Math.max(n.max, a + l, a - l, u + p, u - p); return new rt.Rect(i, a, { l: i - f, r: d - i, u: v - a, d: a - y }) } }, { key: "maxMin", value: function (e, t, n, r) { var i, a; e > n ? (i = e, a = n) : (i = n, a = e); var o, u, s = Ue, c = s(e), h = s(t - e), l = s(n - 2 * t + e); return 0 != l && (u = -h / l) > 0 && u < 1 && (o = function (e) { return c + 2 * e * h + e * e * l }(u), i = Math.max(i, o + r, o - r), a = Math.min(a, o + r, o - r)), { min: a, max: i } } }, { key: "divide", value: function (e) { if (e < 0 || e > 1) throw s("ExecutionError", "illegal quadratic Bezier parameter t:" + e); var t = this.cp0.x, n = this.cp1.x, r = this.cp2.x, i = this.cp0.y, a = this.cp1.y, o = this.cp2.y, u = this.px(e), c = this.py(e), h = this.cp0, l = new rt.Point(t + e * (n - t), i + e * (a - i)), m = new rt.Point(u, c), p = m, f = new rt.Point(n + e * (r - n), a + e * (o - a)), d = this.cp2; return [new Et.QuadBezier(h, l, m), new Et.QuadBezier(p, f, d)] } }, { key: "slice", value: function (e, t) { if (!(e >= t)) { if (e < 0 && (e = 0), t > 1 && (t = 1), 0 === e && 1 === t) return this; this.cp0.x; var n = this.cp1.x, r = this.cp2.x, i = (this.cp0.y, this.cp1.y), a = this.cp2.y, o = this.px(e), u = this.py(e), s = n + e * (r - n), c = i + e * (a - i), h = new rt.Point(o, u), l = new rt.Point(o + t * (s - o), u + t * (c - u)), m = new rt.Point(this.px(t), this.py(t)); return new Et.QuadBezier(h, l, m) } } }, { key: "tOfIntersections", value: function (e) { if (e.isPoint()) return []; if (e.isRect()) { var t, n = e.x + e.r, r = e.x - e.l, i = e.y + e.u, a = e.y - e.d, o = Ue, u = this.cp0.x, s = this.cp1.x, c = this.cp2.x, h = o(u), l = o(2 * (s - u)), m = o(c - 2 * s + u), p = function (e) { return h + e * l + e * e * m }, f = this.cp0.y, d = this.cp1.y, y = this.cp2.y, v = o(f), x = o(2 * (d - f)), g = o(y - 2 * d + f), w = function (e) { return v + e * x + e * e * g }, S = []; t = (t = Et.solutionsOfQuadEq(m, l, h - n)).concat(Et.solutionsOfQuadEq(m, l, h - r)); for (var b = 0; b < t.length; b++) { (M = w(I = t[b])) >= a && M <= i && S.push(I) } t = (t = Et.solutionsOfQuadEq(g, x, v - i)).concat(Et.solutionsOfQuadEq(g, x, v - a)); for (b = 0; b < t.length; b++) { (k = p(I = t[b])) >= r && k <= n && S.push(I) } return S } if (e.isCircle()) { var C = Math.PI, k = e.x, M = e.y, P = e.l, B = e.r, O = e.u, E = e.d, A = k + (B - P) / 2, L = M + (O - E) / 2, j = (n = (P + B) / 2, (O + E) / 2), D = C / 180, T = new At.Arc(A, L, n, j, -C - D, -C / 2 + D), R = new At.Arc(A, L, n, j, -C / 2 - D, 0 + D), F = new At.Arc(A, L, n, j, 0 - D, C / 2 + D), G = new At.Arc(A, L, n, j, C / 2 - D, C + D), V = new At.QuadBezier(this, 0, 1), _ = []; _ = (_ = (_ = (_ = _.concat(At.findIntersections(T, V))).concat(At.findIntersections(R, V))).concat(At.findIntersections(F, V))).concat(At.findIntersections(G, V)); for (S = [], b = 0; b < _.length; b++) { var I = (_[b][1].min + _[b][1].max) / 2; S.push(I) } return S } } }, { key: "countOfSegments", value: function () { return 1 } }, { key: "drawPrimitive", value: function (e, t) { var n = this.cp0, r = this.cp1, i = this.cp2; e.createSVGElement("path", { d: "M" + pe.measure.em2px(n.x) + "," + pe.measure.em2px(-n.y) + " Q" + pe.measure.em2px(r.x) + "," + pe.measure.em2px(-r.y) + " " + pe.measure.em2px(i.x) + "," + pe.measure.em2px(-i.y), "stroke-dasharray": t }) } }, { key: "toString", value: function () { return "QuadBezier(" + this.cp0.x + ", " + this.cp0.y + ")-(" + this.cp1.x + ", " + this.cp1.y + ")-(" + this.cp2.x + ", " + this.cp2.y + ")" } }]), n }(Et), Et.CubicBezier = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a) { var o; Mt(this, n), (o = t.call(this)).cp0 = e, o.cp1 = r, o.cp2 = i, o.cp3 = a; var u = e.x, s = 3 * (r.x - e.x), c = 3 * (i.x - 2 * r.x + e.x), h = a.x - 3 * i.x + 3 * r.x - e.x; o.px = function (e) { return u + e * s + e * e * c + e * e * e * h }, o.dpx = function (e) { return s + 2 * e * c + 3 * e * e * h }; var l = e.y, m = 3 * (r.y - e.y), p = 3 * (i.y - 2 * r.y + e.y), f = a.y - 3 * i.y + 3 * r.y - e.y; return o.py = function (e) { return l + e * m + e * e * p + e * e * e * f }, o.dpy = function (e) { return m + 2 * e * p + 3 * e * e * f }, o } return Bt(n, [{ key: "startPosition", value: function () { return this.cp0 } }, { key: "endPosition", value: function () { return this.cp3 } }, { key: "position", value: function (e) { return new rt.Point(this.px(e), this.py(e)) } }, { key: "derivative", value: function (e) { return new rt.Point(this.dpx(e), this.dpy(e)) } }, { key: "angle", value: function (e) { return Math.atan2(this.dpy(e), this.dpx(e)) } }, { key: "boundingBox", value: function (e) { var t = this.maxMin(this.cp0.x, this.cp1.x, this.cp2.x, this.cp3.x, e), n = this.maxMin(this.cp0.y, this.cp1.y, this.cp2.y, this.cp3.y, e); if (0 === e) return new rt.Rect(this.cp0.x, this.cp0.y, { l: this.cp0.x - t.min, r: t.max - this.cp0.x, u: n.max - this.cp0.y, d: this.cp0.y - n.min }); var r = Math.PI / 2, i = this.cp0.x, a = this.cp0.y, o = this.cp3.x, u = this.cp3.y, s = this.angle(0) + r, c = this.angle(1) + r, h = e * Math.cos(s), l = e * Math.sin(s), m = e * Math.cos(c), p = e * Math.sin(c), f = Math.min(t.min, i + h, i - h, o + m, o - m), d = Math.max(t.max, i + h, i - h, o + m, o - m), y = Math.min(n.min, a + l, a - l, u + p, u - p), v = Math.max(n.max, a + l, a - l, u + p, u - p); return new rt.Rect(i, a, { l: i - f, r: d - i, u: v - a, d: a - y }) } }, { key: "maxMin", value: function (e, t, n, r, i) { var a, o; e > r ? (a = e, o = r) : (a = r, o = e); var u, s = Ue, c = s(e), h = s(t - e), l = s(n - 2 * t + e), m = s(r - 3 * n + 3 * t - e), p = function (e) { e > 0 && e < 1 && (u = function (e) { return c + 3 * e * h + 3 * e * e * l + e * e * e * m }(e), a = Math.max(a, u + i, u - i), o = Math.min(o, u + i, u - i)) }; if (0 == m) 0 != l && p(-h / l / 2); else { var f = l * l - h * m; f > 0 ? (p((-l + Math.sqrt(f)) / m), p((-l - Math.sqrt(f)) / m)) : 0 == f && p(-l / m) } return { min: o, max: a } } }, { key: "divide", value: function (e) { if (e < 0 || e > 1) throw s("ExecutionError", "illegal cubic Bezier parameter t:" + e); var t = this.cp0.x, n = this.cp1.x, r = this.cp2.x, i = this.cp3.x, a = this.cp0.y, o = this.cp1.y, u = this.cp2.y, c = this.cp3.y, h = this.px(e), l = this.py(e), m = this.cp0, p = new rt.Point(t + e * (n - t), a + e * (o - a)), f = new rt.Point(t + 2 * e * (n - t) + e * e * (r - 2 * n + t), a + 2 * e * (o - a) + e * e * (u - 2 * o + a)), d = new rt.Point(h, l), y = d, v = new rt.Point(n + 2 * e * (r - n) + e * e * (i - 2 * r + n), o + 2 * e * (u - o) + e * e * (c - 2 * u + o)), x = new rt.Point(r + e * (i - r), u + e * (c - u)), g = this.cp3; return [new Et.CubicBezier(m, p, f, d), new Et.CubicBezier(y, v, x, g)] } }, { key: "slice", value: function (e, t) { if (!(e >= t)) { if (e < 0 && (e = 0), t > 1 && (t = 1), 0 === e && 1 === t) return this; this.cp0.x; var n = this.cp1.x, r = this.cp2.x, i = this.cp3.x, a = (this.cp0.y, this.cp1.y), o = this.cp2.y, u = this.cp3.y, s = this.px(e), c = this.py(e), h = n + 2 * e * (r - n) + e * e * (i - 2 * r + n), l = a + 2 * e * (o - a) + e * e * (u - 2 * o + a), m = r + e * (i - r), p = o + e * (u - o), f = new rt.Point(s, c), d = new rt.Point(s + t * (h - s), c + t * (l - c)), y = new rt.Point(s + 2 * t * (h - s) + t * t * (m - 2 * h + s), c + 2 * t * (l - c) + t * t * (p - 2 * l + c)), v = new rt.Point(this.px(t), this.py(t)); return new Et.CubicBezier(f, d, y, v) } } }, { key: "tOfIntersections", value: function (e) { if (e.isPoint()) return []; if (e.isRect()) { var t, n = e.x + e.r, r = e.x - e.l, i = e.y + e.u, a = e.y - e.d, o = Ue, u = this.cp0.x, s = this.cp1.x, c = this.cp2.x, h = this.cp3.x, l = this.cp0.y, m = this.cp1.y, p = this.cp2.y, f = this.cp3.y, d = o(u), y = o(3 * (s - u)), v = o(3 * (c - 2 * s + u)), x = o(h - 3 * c + 3 * s - u), g = function (e) { return d + e * y + e * e * v + e * e * e * x }, w = o(l), S = o(3 * (m - l)), b = o(3 * (p - 2 * m + l)), C = o(f - 3 * p + 3 * m - l), k = function (e) { return w + e * S + e * e * b + e * e * e * C }, M = []; t = (t = Et.solutionsOfCubicEq(x, v, y, d - n)).concat(Et.solutionsOfCubicEq(x, v, y, d - r)); for (var P = 0; P < t.length; P++) { (E = k(N = t[P])) >= a && E <= i && M.push(N) } t = (t = Et.solutionsOfCubicEq(C, b, S, w - i)).concat(Et.solutionsOfCubicEq(C, b, S, w - a)); for (P = 0; P < t.length; P++) { (O = g(N = t[P])) >= r && O <= n && M.push(N) } return M } if (e.isCircle()) { var B = Math.PI, O = e.x, E = e.y, A = e.l, L = e.r, j = e.u, D = e.d, T = O + (L - A) / 2, R = E + (j - D) / 2, F = (n = (A + L) / 2, (j + D) / 2), G = B / 180, V = new At.Arc(T, R, n, F, -B - G, -B / 2 + G), _ = new At.Arc(T, R, n, F, -B / 2 - G, 0 + G), I = new At.Arc(T, R, n, F, 0 - G, B / 2 + G), z = new At.Arc(T, R, n, F, B / 2 - G, B + G), Q = new At.CubicBezier(this, 0, 1), W = []; W = (W = (W = (W = W.concat(At.findIntersections(V, Q))).concat(At.findIntersections(_, Q))).concat(At.findIntersections(I, Q))).concat(At.findIntersections(z, Q)); for (M = [], P = 0; P < W.length; P++) { var N = (W[P][1].min + W[P][1].max) / 2; M.push(N) } return M } } }, { key: "countOfSegments", value: function () { return 1 } }, { key: "drawPrimitive", value: function (e, t) { var n = this.cp0, r = this.cp1, i = this.cp2, a = this.cp3; e.createSVGElement("path", { d: "M" + pe.measure.em2px(n.x) + "," + pe.measure.em2px(-n.y) + " C" + pe.measure.em2px(r.x) + "," + pe.measure.em2px(-r.y) + " " + pe.measure.em2px(i.x) + "," + pe.measure.em2px(-i.y) + " " + pe.measure.em2px(a.x) + "," + pe.measure.em2px(-a.y), "stroke-dasharray": t }) } }, { key: "toString", value: function () { return "CubicBezier(" + this.cp0.x + ", " + this.cp0.y + ")-(" + this.cp1.x + ", " + this.cp1.y + ")-(" + this.cp2.x + ", " + this.cp2.y + ")-(" + this.cp3.x + ", " + this.cp3.y + ")" } }]), n }(Et), Et.CubicBeziers = function (e) { wt(n, e); var t = bt(n); function n(e) { var r; Mt(this, n), (r = t.call(this)).cbs = e; var i = r.cbs.length; return r.delegate = 0 == i ? function (e, t, n) { return n } : function (t, n, r) { var a = t * i, o = Math.floor(a); o < 0 && (o = 0), o >= i && (o = i - 1); var u = a - o; return n(e[o], u) }, r } return Bt(n, [{ key: "startPosition", value: function () { return this.cbs[0].cp0 } }, { key: "endPosition", value: function () { return this.cbs[this.cbs.length - 1].cp3 } }, { key: "position", value: function (e) { return this.delegate(e, (function (e, t) { return e.position(t) }), void 0) } }, { key: "derivative", value: function (e) { return this.delegate(e, (function (e, t) { return e.derivative(t) }), void 0) } }, { key: "angle", value: function (e) { return this.delegate(e, (function (e, t) { return e.angle(t) }), 0) } }, { key: "velocity", value: function (e) { var t = this.cbs.length; return this.delegate(e, (function (e, n) { return t * e.velocity(n) }), 0) } }, { key: "boundingBox", value: function (e) { if (0 != this.cbs.length) { var t, n = this.cbs[0].boundingBox(e), r = this.cbs.length; for (t = 1; t < r; t++)n = n.combineRect(this.cbs[t].boundingBox(e)); return n } } }, { key: "tOfIntersections", value: function (e) { var t = [], n = 0, r = this.cbs.length; for (n = 0; n < r; n++)for (var i = this.cbs[n].tOfIntersections(e), a = 0; a < i.length; a++)t.push((i[a] + n) / r); return t } }, { key: "divide", value: function (e) { if (e < 0 || e > 1) throw s("ExecutionError", "illegal cubic Bezier parameter t:" + e); if (0 === e) return [new Et.CubicBeziers([]), this]; if (1 === e) return [this, new Et.CubicBeziers([])]; var t = this.cbs.length, n = e * t, r = Math.floor(n); r === t && (r = t - 1); var i = n - r, a = this.cbs.slice(0, r), o = this.cbs.slice(r + 1), u = this.cbs[r].divide(i); return a.push(u[0]), o.unshift(u[1]), [new Et.CubicBeziers(a), new Et.CubicBeziers(o)] } }, { key: "slice", value: function (e, t) { if (!(e >= t)) { if (e < 0 && (e = 0), t > 1 && (t = 1), 0 === e && 1 === t) return this; var n = this.cbs.length, r = e * n, i = t * n, a = Math.floor(r), o = Math.floor(i); a === n && (a = n - 1), o === n && (o = n - 1); var u, s = r - a, c = i - o; return a === o ? u = [this.cbs[a].slice(s, c)] : ((u = this.cbs.slice(a + 1, o)).push(this.cbs[o].slice(0, c)), u.unshift(this.cbs[a].slice(s, 1))), new Et.CubicBeziers(u) } } }, { key: "countOfSegments", value: function () { return this.cbs.length } }, { key: "drawPrimitive", value: function (e, t) { for (var n = this.cbs.length, r = this.cbs, i = r[0], a = i.cp0, o = i.cp1, u = i.cp2, s = i.cp3, c = "M" + pe.measure.em2px(a.x) + "," + pe.measure.em2px(-a.y) + " C" + pe.measure.em2px(o.x) + "," + pe.measure.em2px(-o.y) + " " + pe.measure.em2px(u.x) + "," + pe.measure.em2px(-u.y) + " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y), h = 1; h < n; h++)u = (i = r[h]).cp2, s = i.cp3, c += " S" + pe.measure.em2px(u.x) + "," + pe.measure.em2px(-u.y) + " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y); e.createSVGElement("path", { d: c, "stroke-dasharray": t }) } }, { key: "drawSkipped", value: function (e) { for (var t = this.cbs.length, n = this.cbs, r = "", i = 0; i < t; i += 2) { var a = n[i], o = a.cp0, u = a.cp1, s = a.cp2, c = a.cp3; r += "M" + pe.measure.em2px(o.x) + "," + pe.measure.em2px(-o.y) + " C" + pe.measure.em2px(u.x) + "," + pe.measure.em2px(-u.y) + " " + pe.measure.em2px(s.x) + "," + pe.measure.em2px(-s.y) + " " + pe.measure.em2px(c.x) + "," + pe.measure.em2px(-c.y) } e.createSVGElement("path", { d: r }) } }], [{ key: "interpolation", value: function (e, t, n) { var r, i = Et.CubicBeziers.cubicSplineInterpolation(e, t), a = i[0], o = i[1], u = Et.CubicBeziers.cubicSplineInterpolation(e, n), s = u[0], c = u[1], h = e.length, l = new Array(h - 1); for (r = 0; r < h - 1; r++)l[r] = new Et.CubicBezier(new rt.Point(t[r], n[r]), new rt.Point(a[r], s[r]), new rt.Point(o[r], c[r]), new rt.Point(t[r + 1], n[r + 1])); return new Et.CubicBeziers(l) } }, { key: "cubicSplineInterpolation", value: function (e, t) { var n, r = e.length - 1, i = new Array(r); for (n = 0; n < r; n++)i[n] = e[n + 1] - e[n]; var a = new Array(r); for (n = 1; n < r; n++)a[n] = 3 * (t[n + 1] - t[n]) / i[n] - 3 * (t[n] - t[n - 1]) / i[n - 1]; var o = new Array(r + 1), u = new Array(r + 1), s = new Array(r + 1); for (o[0] = 1, u[0] = 0, s[0] = 0, n = 1; n < r; n++)o[n] = 2 * (e[n + 1] - e[n - 1]) - i[n - 1] * u[n - 1], u[n] = i[n] / o[n], s[n] = (a[n] - i[n - 1] * s[n - 1]) / o[n]; o[r] = 1, s[r] = 0; var c = new Array(r), h = new Array(r + 1); for (h[r] = 0, n = r - 1; n >= 0; n--) { var l = i[n], m = h[n + 1], p = l * l * s[n] - u[n] * m; h[n] = p, c[n] = t[n + 1] - t[n] - (m + 2 * p) / 3 } var f = new Array(r), d = new Array(r); for (n = 0; n < r; n++) { var y = t[n], v = c[n], x = h[n]; f[n] = y + v / 3, d[n] = y + (2 * v + x) / 3 } return [f, d] } }]), n }(Et), Et.CubicBSpline = function () { function e(t, n, r) { if (Mt(this, e), n.length < 1) throw s("ExecutionError", "the number of internal control points of cubic B-spline must be greater than or equal to 1"); var i = []; i.push(t); for (var a = 0, o = n.length; a < o; a++)i.push(n[a]); i.push(r), this.cps = i; var u = this.cps.length - 1, c = function (e) { return e < 0 ? i[0] : e > u ? i[u] : i[e] }, h = function (e) { var t = Math.abs(e); return t <= 1 ? (3 * t * t * t - 6 * t * t + 4) / 6 : t <= 2 ? -(t - 2) * (t - 2) * (t - 2) / 6 : 0 }; this.px = function (e) { for (var t = (u + 2) * e - 1, n = Math.ceil(t - 2), r = Math.floor(t + 2), i = 0, a = n; a <= r; a++)i += h(t - a) * c(a).x; return i }, this.py = function (e) { for (var t = (u + 2) * e - 1, n = Math.ceil(t - 2), r = Math.floor(t + 2), i = 0, a = n; a <= r; a++)i += h(t - a) * c(a).y; return i }; var l = function (e) { var t = e > 0 ? 1 : e < 0 ? -1 : 0, n = Math.abs(e); return n <= 1 ? t * (3 * n * n - 4 * n) / 2 : n <= 2 ? -t * (n - 2) * (n - 2) / 2 : 0 }; this.dpx = function (e) { for (var t = (u + 2) * e - 1, n = Math.ceil(t - 2), r = Math.floor(t + 2), i = 0, a = n; a <= r; a++)i += l(t - a) * c(a).x; return i }, this.dpy = function (e) { for (var t = (u + 2) * e - 1, n = Math.ceil(t - 2), r = Math.floor(t + 2), i = 0, a = n; a <= r; a++)i += l(t - a) * c(a).y; return i } } return Bt(e, [{ key: "position", value: function (e) { return new rt.Point(this.px(e), this.py(e)) } }, { key: "angle", value: function (e) { return Math.atan2(this.dpy(e), this.dpx(e)) } }, { key: "toCubicBeziers", value: function () { var e = [], t = this.cps, n = t[0], r = t[1], i = t[2], a = n.x, o = n.y, u = a + (r.x - a) / 3, s = o + (r.y - o) / 3, c = a + 2 * (r.x - a) / 3, h = o + 2 * (r.y - o) / 3, l = r.x + (i.x - r.x) / 3, m = r.y + (i.y - r.y) / 3, p = (c + l) / 2, f = (h + m) / 2, d = n, y = new rt.Point(u, s), v = new rt.Point(c, h), x = new rt.Point(p, f), g = new Et.CubicBezier(d, y, v, x); e.push(g); for (var w = this.cps.length - 1, S = 2; S < w; S++)n = r, r = i, i = t[S + 1], a = p, o = f, u = 2 * p - c, s = 2 * f - h, c = n.x + 2 * (r.x - n.x) / 3, h = n.y + 2 * (r.y - n.y) / 3, p = (c + (l = r.x + (i.x - r.x) / 3)) / 2, f = (h + (m = r.y + (i.y - r.y) / 3)) / 2, d = x, y = new rt.Point(u, s), v = new rt.Point(c, h), x = new rt.Point(p, f), g = new Et.CubicBezier(d, y, v, x), e.push(g); return n = r, r = i, a = p, o = f, u = 2 * p - c, s = 2 * f - h, c = n.x + 2 * (r.x - n.x) / 3, h = n.y + 2 * (r.y - n.y) / 3, p = r.x, f = r.y, d = x, y = new rt.Point(u, s), v = new rt.Point(c, h), x = new rt.Point(p, f), g = new Et.CubicBezier(d, y, v, x), e.push(g), e } }, { key: "countOfSegments", value: function () { return this.cps.length - 1 } }]), e }(), Et.Line = function () { function e(t, n) { Mt(this, e), this.s = t, this.e = n } return Bt(e, [{ key: "position", value: function (e) { return new rt.Point(this.s.x + e * (this.e.x - this.s.x), this.s.y + e * (this.e.y - this.s.y)) } }, { key: "slice", value: function (e, t) { if (!(e >= t)) { if (e < 0 && (e = 0), t > 1 && (t = 1), 0 === e && 1 === t) return this; var n = this.s, r = this.e, i = r.x - n.x, a = r.y - n.y, o = new rt.Point(n.x + e * i, n.y + e * a), u = new rt.Point(n.x + t * i, n.y + t * a); return new Et.Line(o, u) } } }, { key: "tOfIntersections", value: function (e) { if (e.isPoint()) return []; var t = this.s, n = this.e; if (e.isRect()) { var r, i = e.x + e.r, a = e.x - e.l, o = e.y + e.u, u = e.y - e.d, s = t.x, c = t.y, h = n.x - s, l = n.y - c, m = function (e) { return s + e * h }, p = function (e) { return c + e * l }, f = []; r = (r = Et.solutionsOfLinearEq(h, s - i)).concat(Et.solutionsOfLinearEq(h, s - a)); for (var d = 0; d < r.length; d++) { var y = p(v = r[d]); y >= u && y <= o && f.push(v) } r = (r = Et.solutionsOfLinearEq(l, c - o)).concat(Et.solutionsOfLinearEq(l, c - u)); for (d = 0; d < r.length; d++) { var v, x = m(v = r[d]); x >= a && x <= i && f.push(v) } return f } if (e.isCircle()) { Math.PI; var g = e.l, w = e.r, S = e.u, b = e.d, C = e.x + (w - g) / 2, k = e.y + (S - b) / 2, M = (i = (g + w) / 2, (S + b) / 2), P = t.x, B = t.y, O = n.x - P, E = -O, A = (u = n.y - B) * i, L = E * M, j = A * A + L * L, D = (n = -(b = A * C + L * k + ((O * B - u * P) * i + (i - M) * E * k)) / j, j * i * i - b * b); if (D < 0) return []; var T, R, F = Math.sqrt(D) / j, G = M / i, V = A * n + L * F + C, _ = G * (L * n - A * F + k - k) + k, I = A * n - L * F + C, z = G * (L * n + A * F + k - k) + k; Math.abs(O) > Math.abs(u) ? (T = (V - P) / O, R = (I - P) / O) : (T = (_ - B) / u, R = (z - B) / u); f = []; return T >= 0 && T <= 1 && f.push(T), R >= 0 && R <= 1 && f.push(R), f } } }, { key: "toShape", value: function (e, t, n, r) { var i = e.env, a = pe.measure.thickness, o = this.s, u = this.e; if (o.x !== u.x || o.y !== u.y) { var s, c = u.x - o.x, h = u.y - o.y, l = Math.atan2(h, c), m = ft.none; switch (n) { case "=": n = "-", r = "2"; break; case "==": n = "--", r = "2"; break; case ":": case "::": n = ".", r = "2" }switch (n) { case "": return i.angle = l, i.lastCurve = new Lt.Line(o, u, i.p, i.c, void 0), m; case "-": case ".": case "..": switch (r) { case "2": s = a / 2; break; case "3": s = a; break; default: s = 0 }break; case "--": var p = 3 * a; if ((y = Math.sqrt(c * c + h * h)) >= p) switch (r) { case "2": s = a / 2; break; case "3": s = a; break; default: s = 0 }break; case "~": case "~~": switch (r) { case "2": s = 1.5 * a; break; case "3": s = 2 * a; break; default: s = 0 }break; default: var f = t.boundingBox(e); if (null == f) return i.angle = 0, i.lastCurve = Lt.none, ft.none; var d = f.l + f.r; 0 == d && (d = pe.measure.strokeWidth); var y = Math.sqrt(c * c + h * h); if (0 == Math.floor(y / d)) return i.angle = 0, i.lastCurve = Lt.none, ft.none; s = Math.max(f.u, f.d) }if (void 0 !== s) { var v = this.boundingBox(s); return m = new ft.LineShape(this, t, n, r, v), e.appendShapeToFront(m), i.angle = l, i.lastCurve = new Lt.Line(o, u, i.p, i.c, m), m } } return i.angle = 0, i.lastCurve = Lt.none, ft.none } }, { key: "boundingBox", value: function (e) { var t = this.s, n = this.e, r = n.x - t.x, i = n.y - t.y, a = Math.atan2(i, r), o = e * Math.cos(a + Math.PI / 2), u = e * Math.sin(a + Math.PI / 2); return new rt.Rect(t.x, t.y, { l: t.x - Math.min(t.x + o, t.x - o, n.x + o, n.x - o), r: Math.max(t.x + o, t.x - o, n.x + o, n.x - o) - t.x, u: Math.max(t.y + u, t.y - u, n.y + u, n.y - u) - t.y, d: t.y - Math.min(t.y + u, t.y - u, n.y + u, n.y - u) }) } }, { key: "drawLine", value: function (e, t, n, r, i) { if (i.isEmpty) this._drawLine(e, t, n, r); else { var a = new yt(0, 1).differenceRanges(i), o = this; a.foreach((function (i) { o.slice(i.start, i.end)._drawLine(e, t, n, r) })) } } }, { key: "_drawLine", value: function (e, t, n, r) { var i = pe.measure.thickness, a = this.s, o = this.e; if (a.x !== o.x || a.y !== o.y) { var u = o.x - a.x, s = o.y - a.y, c = Math.atan2(s, u), h = { x: 0, y: 0 }; switch (n) { case "": break; case "-": this.drawStraightLine(e, a, o, h, c, i, r, ""); break; case "=": this.drawStraightLine(e, a, o, h, c, i, "2", ""); break; case ".": case "..": this.drawStraightLine(e, a, o, h, c, i, r, pe.measure.dottedDasharray); break; case ":": case "::": this.drawStraightLine(e, a, o, h, c, i, "2", pe.measure.dottedDasharray); break; case "--": case "==": var l = 3 * i; if ((P = Math.sqrt(u * u + s * s)) >= l) h = { x: (B = (P - l) / 2 - Math.floor((P - l) / 2 / l) * l) * Math.cos(c), y: B * Math.sin(c) }, this.drawStraightLine(e, a, o, h, c, i, "==" === n ? "2" : r, pe.measure.em2px(l) + " " + pe.measure.em2px(l)); break; case "~": if ((P = Math.sqrt(u * u + s * s)) >= (w = 4 * i)) { h = { x: (B = (P - (M = Math.floor(P / w)) * w) / 2) * Math.cos(c), y: B * Math.sin(c) }; for (var m = i * Math.cos(c + Math.PI / 2), p = i * Math.sin(c + Math.PI / 2), f = i * Math.cos(c), d = i * Math.sin(c), y = a.x + h.x, v = -a.y - h.y, x = "M" + pe.measure.em2px(y) + "," + pe.measure.em2px(v) + " Q" + pe.measure.em2px(y + f + m) + "," + pe.measure.em2px(v - d - p) + " " + pe.measure.em2px(y + 2 * f) + "," + pe.measure.em2px(v - 2 * d) + " T" + pe.measure.em2px(y + 4 * f) + "," + pe.measure.em2px(v - 4 * d), g = 1; g < M; g++)x += " T" + pe.measure.em2px(y + (4 * g + 2) * f) + "," + pe.measure.em2px(v - (4 * g + 2) * d) + " T" + pe.measure.em2px(y + (4 * g + 4) * f) + "," + pe.measure.em2px(v - (4 * g + 4) * d); this.drawSquigglyLineShape(e, x, a, o, m, p, r) } break; case "~~": var w; if ((P = Math.sqrt(u * u + s * s)) >= (w = 4 * i)) { h = { x: (B = (P - w) / 2 - (M = Math.floor((P - w) / 2 / w)) * w) * Math.cos(c), y: B * Math.sin(c) }; for (m = i * Math.cos(c + Math.PI / 2), p = i * Math.sin(c + Math.PI / 2), f = i * Math.cos(c), d = i * Math.sin(c), y = a.x + h.x, v = -a.y - h.y, x = "", g = 0; g <= M; g++)x += " M" + pe.measure.em2px(y + 8 * g * f) + "," + pe.measure.em2px(v - 8 * g * d) + " Q" + pe.measure.em2px(y + (8 * g + 1) * f + m) + "," + pe.measure.em2px(v - (8 * g + 1) * d - p) + " " + pe.measure.em2px(y + (8 * g + 2) * f) + "," + pe.measure.em2px(v - (8 * g + 2) * d) + " T" + pe.measure.em2px(y + (8 * g + 4) * f) + "," + pe.measure.em2px(v - (8 * g + 4) * d); this.drawSquigglyLineShape(e, x, a, o, m, p, r) } break; default: var S = new Ot; S.c = Ot.originPosition; var b = new xt(ft.none, S), C = t.boundingBox(b); if (null == C) return; var k = C.l + C.r; 0 == k && (k = pe.measure.strokeWidth); var M, P = Math.sqrt(u * u + s * s); if (0 == (M = Math.floor(P / k))) return; var B = (P - M * k) / 2, O = Math.cos(c), E = Math.sin(c), A = k * O, L = k * E, j = a.x + (B + C.l) * O, D = a.y + (B + C.l) * E; for (b = new xt(ft.none, S), g = 0; g < M; g++)S.c = new rt.Point(j + g * A, D + g * L), S.angle = c, t.toDropShape(b).draw(e) } } } }, { key: "drawStraightLine", value: function (e, t, n, r, i, a, o, u) { if ("3" === o) { var s = a * Math.cos(i + Math.PI / 2), c = a * Math.sin(i + Math.PI / 2); e.createSVGElement("line", { x1: pe.measure.em2px(t.x + r.x), y1: -pe.measure.em2px(t.y + r.y), x2: pe.measure.em2px(n.x), y2: -pe.measure.em2px(n.y), "stroke-dasharray": u }), e.createSVGElement("line", { x1: pe.measure.em2px(t.x + s + r.x), y1: -pe.measure.em2px(t.y + c + r.y), x2: pe.measure.em2px(n.x + s), y2: -pe.measure.em2px(n.y + c), "stroke-dasharray": u }), e.createSVGElement("line", { x1: pe.measure.em2px(t.x - s + r.x), y1: -pe.measure.em2px(t.y - c + r.y), x2: pe.measure.em2px(n.x - s), y2: -pe.measure.em2px(n.y - c), "stroke-dasharray": u }) } else if ("2" === o) { s = a * Math.cos(i + Math.PI / 2) / 2, c = a * Math.sin(i + Math.PI / 2) / 2; e.createSVGElement("line", { x1: pe.measure.em2px(t.x + s + r.x), y1: -pe.measure.em2px(t.y + c + r.y), x2: pe.measure.em2px(n.x + s), y2: -pe.measure.em2px(n.y + c), "stroke-dasharray": u }), e.createSVGElement("line", { x1: pe.measure.em2px(t.x - s + r.x), y1: -pe.measure.em2px(t.y - c + r.y), x2: pe.measure.em2px(n.x - s), y2: -pe.measure.em2px(n.y - c), "stroke-dasharray": u }) } else e.createSVGElement("line", { x1: pe.measure.em2px(t.x + r.x), y1: -pe.measure.em2px(t.y + r.y), x2: pe.measure.em2px(n.x), y2: -pe.measure.em2px(n.y), "stroke-dasharray": u }) } }, { key: "drawSquigglyLineShape", value: function (e, t, n, r, i, a, o) { "3" === o ? (e.createSVGElement("path", { d: t }), e.createGroup(e.transformBuilder().translate(i, a)).createSVGElement("path", { d: t }), e.createGroup(e.transformBuilder().translate(-i, -a)).createSVGElement("path", { d: t })) : "2" === o ? (e.createGroup(e.transformBuilder().translate(i / 2, a / 2)).createSVGElement("path", { d: t }), e.createGroup(e.transformBuilder().translate(-i / 2, -a / 2)).createSVGElement("path", { d: t })) : e.createSVGElement("path", { d: t }) } }]), e }(); var At = function () { function e() { Mt(this, e) } return Bt(e, [{ key: "bezierFatLine", value: function (e) { var t, n, r, i, a = this.cps[0], o = this.cps[e]; if (a.x !== o.x || a.y !== o.y) t = a.y - o.y, n = o.x - a.x, t /= i = Math.sqrt(t * t + n * n), n /= i, r = (a.x * o.y - a.y * o.x) / i; else { var u = this.bezier.angle(this.tmin); t = -Math.sin(u), n = Math.cos(u), r = -t * this.cp0.x - n * this.cp0.y } for (var s = r, c = r, h = 1; h < e; h++) { var l = -t * this.cps[h].x - n * this.cps[h].y; l > c ? c = l : l < s && (s = l) } return { min: [t, n, s], max: [t, n, c] } } }, { key: "clippedLineRange", value: function (e, t, n) { for (var r, i, a, o, u, s = e.length - 1, c = new Array(s + 1), h = We, l = 0; l <= s; l++)c[l] = [l / s, -t[0] * e[l].x - t[1] * e[l].y - t[2], 1]; if (c[0][1] < 0) { var m = !0; for (l = 1; l <= s; l++) { (r = -(f = h(c[0], c[l]))[2] / f[0]) > 0 && r < 1 && (void 0 === i || r < i) && (i = r), c[l][1] >= 0 && (m = !1) } if (m) return } else i = 0; if (c[s][1] < 0) for (l = 0; l < s; l++) { (r = -(d = h(c[s], c[l]))[2] / d[0]) > 0 && r < 1 && (void 0 === a || r > a) && (a = r) } else a = 1; for (l = 0; l <= s; l++)c[l] = [l / s, n[0] * e[l].x + n[1] * e[l].y + n[2], 1]; if (c[0][1] < 0) { var p = !0; for (l = 1; l <= s; l++) { var f; (r = -(f = h(c[0], c[l]))[2] / f[0]) > 0 && r < 1 && (void 0 === o || r < o) && (o = r), c[l][1] >= 0 && (p = !1) } if (p) return } else o = 0; if (c[s][1] < 0) for (l = 0; l < s; l++) { var d; (r = -(d = h(c[s], c[l]))[2] / d[0]) > 0 && r < 1 && (void 0 === u || r > u) && (u = r) } else u = 1; var y = Math.max(i, o), v = Math.min(a, u); return { min: this.tmin + y * (this.tmax - this.tmin), max: this.tmin + v * (this.tmax - this.tmin) } } }], [{ key: "findIntersections", value: function (t, n) { for (var r = e.maxIterations, i = e.goalAccuracy, a = [[t, n, !1]], o = 0, u = []; o < r && a.length > 0;) { o++; var s = a.shift(), c = (t = s[0], n = s[1], s[2]), h = t.fatLine(), l = n.clippedRange(h.min, h.max); if (null != l) { var m = l.min, p = l.max, f = p - m; if (f < i && t.paramLength() < i) c ? u.push([n.clip(m, p).paramRange(), t.paramRange()]) : u.push([t.paramRange(), n.clip(m, p).paramRange()]); else if (f <= .8 * n.paramLength()) a.push([n.clip(m, p), t, !c]); else if (f > t.paramLength()) { var d = (p + m) / 2; a.push([n.clip(m, d), t, !c]), a.push([n.clip(d, p), t, !c]) } else { var y = n.clip(m, p), v = t.paramRange(), x = (v.min + v.max) / 2; a.push([y, t.clip(v.min, x), !c]), a.push([y, t.clip(x, v.max), !c]) } } } return u } }, { key: "maxIterations", get: function () { return 30 } }, { key: "goalAccuracy", get: function () { return 1e-4 } }]), e }(); At.Line = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a) { var o; return Mt(this, n), (o = t.call(this)).p0 = e, o.p1 = r, o.tmin = i, o.tmax = a, o } return Bt(n, [{ key: "paramRange", value: function () { return { min: this.tmin, max: this.tmax } } }, { key: "paramLength", value: function () { return this.tmax - this.tmin } }, { key: "containsParam", value: function (e) { return e >= this.tmin && e <= this.tmax } }, { key: "position", value: function (e) { return { x: this.p0.x + e * (this.p1.x - this.p0.x), y: this.p0.y + e * (this.p1.y - this.p0.y) } } }, { key: "fatLine", value: function () { var e = this.p1.y - this.p0.y, t = this.p0.x - this.p1.x, n = this.p1.x * this.p0.y - this.p0.x * this.p1.y, r = Math.sqrt(e * e + t * t); return 0 === r ? (e = 1, t = 0) : (e /= r, t /= r, n /= r), { min: [e, t, n], max: [e, t, n] } } }, { key: "clip", value: function (e, t) { return new At.Line(this.p0, this.p1, e, t) } }, { key: "clippedRange", value: function (e, t) { var n = new Array(2); return n[0] = this.position(this.tmin), n[1] = this.position(this.tmax), this.clippedLineRange(n, e, t) } }, { key: "drawFatLine", value: function () { this.fatLine().min; var e = function (e, t) { return -(e * t[0] + t[2]) / t[1] }, t = this.p0.x, n = this.p1.x; pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(t), y1: -pe.measure.em2px(e(t, lmax)), x2: pe.measure.em2px(n), y2: -pe.measure.em2px(e(n, lmax)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "red" }) } }]), n }(At), At.QuadBezier = function (e) { wt(n, e); var t = bt(n); function n(e, r, i) { var a; return Mt(this, n), (a = t.call(this)).bezier = e, a.tmin = r, a.tmax = i, a.cp0 = e.position(r), a.cp1 = new rt.Point((1 - i) * (1 - r) * e.cp0.x + (r + i - 2 * r * i) * e.cp1.x + r * i * e.cp2.x, (1 - i) * (1 - r) * e.cp0.y + (r + i - 2 * r * i) * e.cp1.y + r * i * e.cp2.y), a.cp2 = e.position(i), a.cps = [a.cp0, a.cp1, a.cp2], a } return Bt(n, [{ key: "paramRange", value: function () { return { min: this.tmin, max: this.tmax } } }, { key: "paramLength", value: function () { return this.tmax - this.tmin } }, { key: "fatLine", value: function () { return this.bezierFatLine(2) } }, { key: "clip", value: function (e, t) { return new At.QuadBezier(this.bezier, e, t) } }, { key: "clippedRange", value: function (e, t) { return this.clippedLineRange(this.cps, e, t) } }, { key: "drawFatLine", value: function () { var e = this.fatLine(), t = e.min, n = e.max, r = function (e, t) { return -(e * t[0] + t[2]) / t[1] }, i = this.cp0.x, a = this.cp2.x; pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(i), y1: -pe.measure.em2px(r(i, t)), x2: pe.measure.em2px(a), y2: -pe.measure.em2px(r(a, t)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "blue" }), pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(i), y1: -pe.measure.em2px(r(i, n)), x2: pe.measure.em2px(a), y2: -pe.measure.em2px(r(a, n)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "red" }) } }]), n }(At), At.CubicBezier = function (e) { wt(n, e); var t = bt(n); function n(e, r, i) { var a; return Mt(this, n), (a = t.call(this)).bezier = e, a.tmin = r, a.tmax = i, a.cp0 = e.position(r), a.cp1 = new rt.Point((1 - i) * (1 - r) * (1 - r) * e.cp0.x + (1 - r) * (2 * r + i - 3 * r * i) * e.cp1.x + r * (2 * i + r - 3 * r * i) * e.cp2.x + r * r * i * e.cp3.x, (1 - i) * (1 - r) * (1 - r) * e.cp0.y + (1 - r) * (2 * r + i - 3 * r * i) * e.cp1.y + r * (2 * i + r - 3 * r * i) * e.cp2.y + r * r * i * e.cp3.y), a.cp2 = new rt.Point((1 - r) * (1 - i) * (1 - i) * e.cp0.x + (1 - i) * (2 * i + r - 3 * r * i) * e.cp1.x + i * (2 * r + i - 3 * r * i) * e.cp2.x + r * i * i * e.cp3.x, (1 - r) * (1 - i) * (1 - i) * e.cp0.y + (1 - i) * (2 * i + r - 3 * r * i) * e.cp1.y + i * (2 * r + i - 3 * r * i) * e.cp2.y + r * i * i * e.cp3.y), a.cp3 = e.position(i), a.cps = [a.cp0, a.cp1, a.cp2, a.cp3], a } return Bt(n, [{ key: "paramRange", value: function () { return { min: this.tmin, max: this.tmax } } }, { key: "paramLength", value: function () { return this.tmax - this.tmin } }, { key: "fatLine", value: function () { return this.bezierFatLine(3) } }, { key: "clip", value: function (e, t) { return new At.CubicBezier(this.bezier, e, t) } }, { key: "clippedRange", value: function (e, t) { return this.clippedLineRange(this.cps, e, t) } }, { key: "drawFatLine", value: function () { var e = this.fatLine(), t = e.min, n = e.max, r = function (e, t) { return -(e * t[0] + t[2]) / t[1] }, i = this.cp0.x, a = this.cp3.x; pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(i), y1: -pe.measure.em2px(r(i, t)), x2: pe.measure.em2px(a), y2: -pe.measure.em2px(r(a, t)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "blue" }), pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(i), y1: -pe.measure.em2px(r(i, n)), x2: pe.measure.em2px(a), y2: -pe.measure.em2px(r(a, n)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "red" }) } }]), n }(At), At.Arc = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a, o, u) { var s; return Mt(this, n), (s = t.call(this)).x = e, s.y = r, s.rx = i, s.ry = a, s.angleMin = o, s.angleMax = u, s } return Bt(n, [{ key: "paramRange", value: function () { return { min: this.angleMin, max: this.angleMax } } }, { key: "paramLength", value: function () { return this.angleMax - this.angleMin } }, { key: "normalizeAngle", value: function (e) { return (e = e % 2 * Math.PI) > Math.PI ? e - 2 * Math.PI : e < -Math.PI ? e + 2 * Math.PI : e } }, { key: "containsParam", value: function (e) { return e >= this.angleMin && e <= this.angleMax } }, { key: "fatLine", value: function () { var e = this.rx, t = this.ry, n = (this.angleMax + this.angleMin) / 2, r = (this.angleMax - this.angleMin) / 2, i = Math.cos(n), a = Math.sin(n), o = Math.sqrt(e * e * a * a + t * t * i * i); if (o < c.machinePrecision) var u = [1, 0, this.x * t * i + this.y * e * a + e * t * Math.cos(r)], s = [1, 0, this.x * t * i + this.y * e * a + e * t]; else { var h = e / o, l = t / o; u = [-l * i, -h * a, this.x * l * i + this.y * h * a + e * t / o * Math.cos(r)], s = [-l * i, -h * a, this.x * l * i + this.y * h * a + e * t / o] } return { min: u, max: s } } }, { key: "clip", value: function (e, t) { return new At.Arc(this.x, this.y, this.rx, this.ry, e, t) } }, { key: "toCircleLine", value: function (e, t, n, r, i) { var a = e[0], o = e[1], u = a * r, s = o * i, h = e[2] * r + (r - i) * o * n, l = Math.sqrt(u * u + s * s); return l < c.machinePrecision ? (u = 1, s = 0) : (u /= l, s /= l, h /= l), [u, s, h] } }, { key: "clippedRange", value: function (e, t) { var n = this.x, r = this.y, i = this.rx, a = this.ry, o = this.toCircleLine(e, n, r, i, a), u = this.toCircleLine(t, n, r, i, a), s = i, c = this.angleMin, h = this.angleMax, l = -(o[0] * n + o[1] * r + o[2]), m = []; if (s * s - l * l >= 0) { var p = o[0] * l - o[1] * Math.sqrt(s * s - l * l), f = o[1] * l + o[0] * Math.sqrt(s * s - l * l), d = o[0] * l + o[1] * Math.sqrt(s * s - l * l), y = o[1] * l - o[0] * Math.sqrt(s * s - l * l), v = Math.atan2(f, p), x = Math.atan2(y, d); this.containsParam(v) && m.push(v), this.containsParam(x) && m.push(x) } var g, w, S = -(o[0] * (n + s * Math.cos(c)) + o[1] * (r + s * Math.sin(c)) + o[2]), b = -(o[0] * (n + s * Math.cos(h)) + o[1] * (r + s * Math.sin(h)) + o[2]); if (S < 0) { if (0 == m.length) return; g = Math.min.apply(Math, m) } else g = this.angleMin; if (b < 0) { if (0 == m.length) return; w = Math.max.apply(Math, m) } else w = this.angleMax; m = []; if (s * s - (l = u[0] * n + u[1] * r + u[2]) * l >= 0) { p = -o[0] * l + o[1] * Math.sqrt(s * s - l * l), f = -o[1] * l - o[0] * Math.sqrt(s * s - l * l), d = -o[0] * l - o[1] * Math.sqrt(s * s - l * l), y = -o[1] * l + o[0] * Math.sqrt(s * s - l * l), v = Math.atan2(f, p), x = Math.atan2(y, d); this.containsParam(v) && m.push(v), this.containsParam(x) && m.push(x) } var C, k; S = u[0] * (n + s * Math.cos(c)) + u[1] * (r + s * Math.sin(c)) + u[2], b = u[0] * (n + s * Math.cos(h)) + u[1] * (r + s * Math.sin(h)) + u[2]; if (S < 0) { if (0 == m.length) return; C = Math.min.apply(Math, m) } else C = this.angleMin; if (b < 0) { if (0 == m.length) return; k = Math.max.apply(Math, m) } else k = this.angleMax; return { min: Math.max(g, C), max: Math.min(w, k) } } }, { key: "drawFatLine", value: function () { var e = this.fatLine(), t = e.min, n = e.max, r = function (e, t) { return -(e * t[0] + t[2]) / t[1] }, i = this.x + this.r * Math.cos(this.angleMin), a = this.x + this.r * Math.cos(this.angleMax); pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(i), y1: -pe.measure.em2px(r(i, t)), x2: pe.measure.em2px(a), y2: -pe.measure.em2px(r(a, t)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "blue" }), pe.svgForDebug.createSVGElement("line", { x1: pe.measure.em2px(i), y1: -pe.measure.em2px(r(i, n)), x2: pe.measure.em2px(a), y2: -pe.measure.em2px(r(a, n)), "stroke-width": pe.measure.em2px(.02 * pe.measure.oneem), stroke: "red" }) } }]), n }(At); var Lt = function e() { Mt(this, e) }; function jt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function Dt(e, t, n) { return t && jt(e.prototype, t), n && jt(e, n), e } function Tt(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } Lt.None = function (e) { wt(n, e); var t = bt(n); function n() { return Mt(this, n), t.call(this) } return Bt(n, [{ key: "isDefined", get: function () { return !1 } }, { key: "segments", value: function () { return [] } }, { key: "angle", value: function () { return 0 } }]), n }(Lt), Lt.none = new Lt.None, Lt.Line = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a, o) { var u; return Mt(this, n), (u = t.call(this)).start = e, u.end = r, u.p = i, u.c = a, u.lineShape = o, u } return Bt(n, [{ key: "isDefined", get: function () { return !0 } }, { key: "position", value: function (e) { return new rt.Point(this.p.x + e * (this.c.x - this.p.x), this.p.y + e * (this.c.y - this.p.y)) } }, { key: "derivative", value: function (e) { return new rt.Point(this.c.x - this.p.x, this.c.y - this.p.y) } }, { key: "angle", value: function (e) { var t = this.c.x - this.p.x, n = this.c.y - this.p.y; return 0 === t && 0 === n ? 0 : Math.atan2(n, t) } }, { key: "tOfPlace", value: function (e, t, n, r) { var i = e ? this.start : this.p, a = t ? this.end : this.c; if (i.x === a.x && i.y === a.y) return 0; var o, u, s = a.x - i.x, c = a.y - i.y, h = Math.sqrt(s * s + c * c); n > .5 ? (o = a.x - (1 - n) * s + r * s / h, u = a.y - (1 - n) * c + r * c / h) : (o = i.x + n * s + r * s / h, u = i.y + n * c + r * c / h); var l = this.c.x - this.p.x, m = this.c.y - this.p.y; return 0 === l && 0 === m ? 0 : Math.abs(l) > Math.abs(m) ? (o - this.p.x) / l : (u - this.p.y) / m } }, { key: "sliceHole", value: function (e, t) { if (void 0 !== this.lineShape && !e.isPoint()) { var n = this.lineShape, r = n.line, i = r.tOfIntersections(e); i.push(0), i.push(1), i.sort(); for (var a = i[0], o = 1; o < i.length; o++) { var u = i[o], s = r.position((u + a) / 2); if (e.contains(s)) { var c = new yt(a, u); n.sliceHole(c) } a = u } } } }, { key: "segments", value: function () { return [new At.Line(this.p, this.c, 0, 1)] } }]), n }(Lt), Lt.QuadBezier = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a) { var o; return Mt(this, n), (o = t.call(this)).origBezier = e, o.tOfShavedStart = r, o.tOfShavedEnd = i, a.isNone || (o.curveShape = a, r > 0 && a.sliceHole(new yt(0, r)), i < 1 && a.sliceHole(new yt(i, 1))), o } return Bt(n, [{ key: "isDefined", get: function () { return !0 } }, { key: "position", value: function (e) { return this.origBezier.position(e) } }, { key: "derivative", value: function (e) { return this.origBezier.derivative(e) } }, { key: "angle", value: function (e) { return this.origBezier.angle(e) } }, { key: "tOfPlace", value: function (e, t, n, r) { var i, a; e ? (i = this.tOfShavedStart, a = t ? this.tOfShavedEnd - this.tOfShavedStart : 1 - this.tOfShavedStart) : (i = 0, a = t ? this.tOfShavedEnd : 1); var o = this.origBezier, u = i + a * n; if (0 !== r) { var s = o.length(u); u = o.tOfLength(s + r) } return u } }, { key: "sliceHole", value: function (e, t) { var n = this.curveShape; if (void 0 !== n && !e.isPoint()) { var r = n.curve, i = r.tOfIntersections(e); i.push(0), i.push(1), i.sort(); for (var a = i[0], o = 1; o < i.length; o++) { var u = i[o]; if (a <= t && t <= u) { var s = r.position((u + a) / 2); if (e.contains(s)) { var c = new yt(a, u); n.sliceHole(c) } } a = u } } } }, { key: "segments", value: function () { return [new At.QuadBezier(this.origBezier, 0, 1)] } }]), n }(Lt), Lt.CubicBezier = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a) { var o; return Mt(this, n), (o = t.call(this)).origBezier = e, o.tOfShavedStart = r, o.tOfShavedEnd = i, a.isNone || (o.curveShape = a, r > 0 && a.sliceHole(new yt(0, r)), i < 1 && a.sliceHole(new yt(i, 1))), o } return Bt(n, [{ key: "originalLine", value: function () { return this.originalLine } }, { key: "isDefined", get: function () { return !0 } }, { key: "position", value: function (e) { return this.origBezier.position(e) } }, { key: "derivative", value: function (e) { return this.origBezier.derivative(e) } }, { key: "angle", value: function (e) { return this.origBezier.angle(e) } }, { key: "tOfPlace", value: function (e, t, n, r) { var i, a; e ? (i = this.tOfShavedStart, a = t ? this.tOfShavedEnd - this.tOfShavedStart : 1 - this.tOfShavedStart) : (i = 0, a = t ? this.tOfShavedEnd : 1); var o = this.origBezier, u = i + a * n; if (0 !== r) { var s = o.length(u); u = o.tOfLength(s + r) } return u } }, { key: "sliceHole", value: function (e, t) { var n = this.curveShape; if (void 0 !== n && !e.isPoint()) { var r = n.curve, i = r.tOfIntersections(e); i.push(0), i.push(1), i.sort(); for (var a = i[0], o = 1; o < i.length; o++) { var u = i[o]; if (a <= t && t <= u) { var s = r.position((u + a) / 2); if (e.contains(s)) { var c = new yt(a, u); n.sliceHole(c) } } a = u } } } }, { key: "segments", value: function () { return [new At.CubicBezier(this.origBezier, 0, 1)] } }]), n }(Lt), Lt.CubicBSpline = function (e) { wt(n, e); var t = bt(n); function n(e, r, i, a, o, u) { var s; return Mt(this, n), (s = t.call(this)).s = e, s.e = r, s.origBeziers = i, s.tOfShavedStart = a, s.tOfShavedEnd = o, u.isNone || (s.curveShape = u, a > 0 && u.sliceHole(new yt(0, a)), o < 1 && u.sliceHole(new yt(o, 1))), s } return Bt(n, [{ key: "isDefined", get: function () { return !0 } }, { key: "position", value: function (e) { return this.origBeziers.position(e) } }, { key: "derivative", value: function (e) { return this.origBeziers.derivative(e) } }, { key: "angle", value: function (e) { return this.origBeziers.angle(e) } }, { key: "tOfPlace", value: function (e, t, n, r) { var i, a; e ? (i = this.tOfShavedStart, a = t ? this.tOfShavedEnd - this.tOfShavedStart : 1 - this.tOfShavedStart) : (i = 0, a = t ? this.tOfShavedEnd : 1); var o = this.origBeziers, u = i + a * n; if (0 !== r) { var s = o.length(u); u = o.tOfLength(s + r) } return u } }, { key: "sliceHole", value: function (e, t) { var n = this.curveShape; if (void 0 !== n && !e.isPoint()) { var r = n.curve, i = r.tOfIntersections(e); i.push(0), i.push(1), i.sort(); for (var a = i[0], o = 1; o < i.length; o++) { var u = i[o]; if (a <= t && t <= u) { var s = r.position((u + a) / 2); if (e.contains(s)) { var c = new yt(a, u); n.sliceHole(c) } } a = u } } } }, { key: "segments", value: function () { for (var e = new Array(this.origBeziers.length), t = e.length, n = 0; n < t; n++)e[n] = new At.CubicBezier(this.origBezier, n / t, (n + 1) / t); return e } }]), n }(Lt); var Rt = function e() { Tt(this, e) }; function Ft(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function Gt(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function Vt(e, t, n) { return t && Gt(e.prototype, t), n && Gt(e, n), e } function _t(e, t) { for (var n in t) e.prototype.hasOwnProperty(n) ? console.log("WARN", "method " + n + " is already exists in class " + e.name) : e.prototype[n] = t[n] } Rt.Position = function () { function e(t) { Tt(this, e), this.pos = t } return Dt(e, [{ key: "position", value: function (e) { return this.pos } }, { key: "toString", value: function () { return this.pos.toString() } }]), e }(), Rt.Macro = function () { function e(t) { Tt(this, e), this.macro = t } return Dt(e, [{ key: "position", value: function (e) { return env.c = this.macro.position(e), env.c } }, { key: "toString", value: function () { return this.macro.toString() } }]), e }(), Rt.Base = function () { function e(t, n, r) { Tt(this, e), this.origin = t, this.xBase = n, this.yBase = r } return Dt(e, [{ key: "position", value: function (e) { var t = e.env; return t.origin = this.origin, t.xBase = this.xBase, t.yBase = this.yBase, t.c } }, { key: "toString", value: function () { return "origin:" + this.origin + ", xBase:" + this.xBase + ", yBase:" + this.yBase } }]), e }(), Rt.Stack = function () { function e(t) { Tt(this, e), this.stack = t } return Dt(e, [{ key: "position", value: function (e) { var t = e.env; return this.stack.isEmpty || (this.stack.tail.reverse().foreach((function (e) { t.capturePosition(e) })), t.c = this.stack.head), t.c } }, { key: "toString", value: function () { return this.stack.toString() } }]), e }(), _t(Ce.PosDecor, { toShape: function (e) { this.pos.toShape(e), this.decor.toShape(e) } }), _t(Ce.Pos.Coord, { toShape: function (e) { e.env.c = this.coord.position(e), this.pos2s.foreach((function (t) { t.toShape(e) })) } }), _t(Ce.Pos.Plus, { toShape: function (e) { var t = e.env, n = this.coord.position(e); t.c = n.move(t.c.x + n.x, t.c.y + n.y) } }), _t(Ce.Pos.Minus, { toShape: function (e) { var t = e.env, n = this.coord.position(e); t.c = n.move(t.c.x - n.x, t.c.y - n.y) } }), _t(Ce.Pos.Skew, { toShape: function (e) { var t = e.env, n = this.coord.position(e), r = new rt.Point(n.x + t.c.x, n.y + t.c.y); t.c = r.combineRect(t.c) } }), _t(Ce.Pos.Cover, { toShape: function (e) { var t = e.env, n = this.coord.position(e); t.c = t.c.combineRect(n) } }), _t(Ce.Pos.Then, { toShape: function (e) { var t = e.env; t.capturePosition(t.c), t.c = this.coord.position(e) } }), _t(Ce.Pos.SwapPAndC, { toShape: function (e) { var t = e.env; t.swapPAndC(), t.c = this.coord.position(e) } }), _t(Ce.Pos.SetBase, { toShape: function (e) { var t = e.env, n = t.p, r = t.c.x - n.x, i = t.c.y - n.y; t.setOrigin(n.x, n.y), t.setXBase(r, i), t.setYBase(-i, r), t.c = this.coord.position(e) } }), _t(Ce.Pos.SetYBase, { toShape: function (e) { var t = e.env; t.setYBase(t.c.x - t.origin.x, t.c.y - t.origin.y), t.c = this.coord.position(e) } }), _t(Ce.Pos.ConnectObject, { toShape: function (e) { this.object.toConnectShape(e) } }), _t(Ce.Pos.DropObject, { toShape: function (e) { this.object.toDropShape(e) } }), _t(Ce.Pos.Place, { toShape: function (e) { var t = e.env; if (t.lastCurve.isDefined) { var n, r = this.place, i = r.shaveP > 0, a = r.shaveC > 0, o = i ? r.shaveP - 1 : 0, u = a ? r.shaveC - 1 : 0; if (i && (n = 0), a && (n = 1), i == a && (n = .5), void 0 !== r.factor) if (r.factor.isIntercept) { if (a = i = !1, void 0 === (n = r.factor.value(e))) return } else n = r.factor.value(e); var s = pe.measure.length2em(r.slide.dimen.getOrElse("0")) + (o - u) * pe.measure.jot, c = t.lastCurve.tOfPlace(i, a, n, s), h = t.lastCurve.position(c), l = t.lastCurve.angle(c); return t.c = h, t.angle = l, c } } }), _t(Ce.Pos.PushCoord, { toShape: function (e) { var t = e.env, n = this.coord.position(e); t.pushPos(n) } }), _t(Ce.Pos.EvalCoordThenPop, { toShape: function (e) { var t = e.env; t.c = this.coord.position(e), t.popPos() } }), _t(Ce.Pos.LoadStack, { toShape: function (e) { var t = e.env; t.startCapturePositions(), this.coord.position(e); var n = t.endCapturePositions(); t.setStack(n), t.pushPos(t.c) } }), _t(Ce.Pos.DoCoord, { toShape: function (e) { var t = e.env, n = this.coord; t.stack.reverse().foreach((function (r) { t.c = r, n.position(e) })) } }), _t(Ce.Pos.InitStack, { toShape: function (e) { e.env.initStack() } }), _t(Ce.Pos.EnterFrame, { toShape: function (e) { e.env.enterStackFrame() } }), _t(Ce.Pos.LeaveFrame, { toShape: function (e) { e.env.leaveStackFrame() } }), _t(Ce.Place.Factor, { value: function (e) { return this.factor } }), _t(Ce.Place.Intercept, { value: function (e) { var t = e.env; if (t.lastCurve.isDefined) { var n = t.duplicate(); n.angle = 0, n.lastCurve = Lt.none, n.p = n.c = Ot.originPosition; var r = new xt(ft.none, n); this.pos.toShape(r); e.appendShapeToFront(r.shape), n.lastCurve.isDefined || (n.lastCurve = new Lt.Line(n.p, n.c, n.p, n.c, void 0)); for (var i = [], a = t.lastCurve.segments(), o = n.lastCurve.segments(), u = 0; u < a.length; u++)for (var s = 0; s < o.length; s++)i = i.concat(At.findIntersections(a[u], o[s])); if (0 === i.length) { console.log("perhaps no curve intersection."); for (var c = t.lastCurve, h = n.lastCurve, l = 1e-5, m = 0, p = 2, f = 0, d = 0, y = function (e) { return 1 / (1 + Math.exp(-e)) }, v = function (e) { var t = Math.exp(-e); return t / (1 + t) / (1 + t) }, x = y(f), g = y(d), w = v(f), S = v(d), b = c.derivative(x), C = h.derivative(g), k = b.x * w, M = -C.x * S, P = b.y * w, B = -C.y * S, O = k * k + P * P, E = k * M + P * B, A = M * k + B * P, L = M * M + B * B, j = c.position(x), D = h.position(g), T = j.x - D.x, R = j.y - D.y, F = k * T + P * R, G = M * T + B * R, V = Math.sqrt(F * F + G * G) < l, _ = .001 * Math.max(O, L); !V && m < 100;) { m++; do { var I = L + _, z = (O + _) * I - E * A, Q = (I * F - E * G) / z, W = (-A * F + O * G) / z; if (Q * Q + W * W < 1.0000000000000002e-10 * (f * f + d * d)) V = !0; else { var N = f - Q, U = d - W, X = y(N), H = y(U), q = c.position(X), J = h.position(H), Z = q.x - J.x, Y = q.y - J.y, $ = (T * T + R * R - (Z * Z + Y * Y)) / (Q * (_ * Q + F) + W * (_ * W + G)); if ($ > 0) { d = U, x = X, g = H, w = v(f = N), S = v(d), b = c.derivative(x), C = h.derivative(g), k = b.x * w, M = -C.x * S, O = k * k + (P = b.y * w) * P, E = k * M + P * (B = -C.y * S), A = M * k + B * P, L = M * M + B * B, F = k * (T = Z) + P * (R = Y), G = M * T + B * R, V = Math.sqrt(F * F + G * G) < l; var K = 2 * $ - 1; _ += Math.max(1 / 3, 1 - K * K * K), p = 2 } else _ *= p, p *= 2 } } while (!(V || void 0 !== $ && $ > 0)) } return y(f) } var ee = (i[0][0].min + i[0][0].max) / 2; for (u = 1; u < i.length; u++) { var te = (i[u][0].min + i[u][0].max) / 2; ee > te && (ee = te) } return ee } } }), _t(Ce.Pos.SavePos, { toShape: function (e) { var t = e.env; t.savePos(this.id, new Rt.Position(t.c)) } }), _t(Ce.Pos.SaveMacro, { toShape: function (e) { e.env.savePos(this.id, new Rt.Macro(this.macro)) } }), _t(Ce.Pos.SaveBase, { toShape: function (e) { var t = e.env; t.savePos(this.id, new Rt.Base(t.origin, t.xBase, t.yBase)) } }), _t(Ce.Pos.SaveStack, { toShape: function (e) { var t = e.env; t.savePos(this.id, new Rt.Stack(t.stack)) } }), _t(Ce.Object, { toDropShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = this.modifiers; if (n.isEmpty) return this.object.toDropShape(e); var r = t.duplicate(), i = new xt(ft.none, r), a = L.empty; n.foreach((function (e) { e.preprocess(i, a), a = a.prepend(e) })); var o = this.object.toDropShape(i), u = r.c; if (void 0 === u) return ft.none; var s = r.originalReferencePoint; return (r = t.duplicate()).c = u, r.originalReferencePoint = s, i = new xt(ft.none, r), o = n.head.modifyShape(i, o, n.tail), e.appendShapeToFront(o), t.c = r.c.move(t.c.x, t.c.y), o }, toConnectShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = this.modifiers; if (n.isEmpty) return this.object.toConnectShape(e); var r = t.duplicate(), i = new xt(ft.none, r), a = L.empty; n.foreach((function (e) { e.preprocess(i, a), a = a.prepend(e) })); var o = this.object.toConnectShape(i); t.angle = r.angle, t.lastCurve = r.lastCurve; var u = r.c; if (void 0 === u) return ft.none; var s = r.originalReferencePoint; return (r = t.duplicate()).c = u, r.originalReferencePoint = s, i = new xt(ft.none, r), o = n.head.modifyShape(i, o, n.tail), e.appendShapeToFront(o), t.c = r.c.move(t.c.x, t.c.y), o }, boundingBox: function (e) { var t = e.duplicateEnv(), n = t.env; return n.angle = 0, n.p = n.c = Ot.originPosition, t.shape = ft.none, this.toDropShape(t).getBoundingBox() } }), _t(Ce.ObjectBox, { toConnectShape: function (e) { var t = (n = e.env).c, n = e.env, r = (pe.measure.thickness, n.p.edgePoint(n.c.x, n.c.y)), i = n.c.edgePoint(n.p.x, n.p.y); if (r.x !== i.x || r.y !== i.y) { var a = new Et.Line(r, i).toShape(e, this, "196883", ""); return n.originalReferencePoint = t, a } return n.angle = 0, n.lastCurve = Lt.none, n.originalReferencePoint = t, ft.none }, boundingBox: function (e) { var t = e.duplicateEnv(), n = t.env; return n.angle = 0, n.p = n.c = Ot.originPosition, t.shape = ft.none, this.toDropShape(t).getBoundingBox() } }), _t(Ce.ObjectBox.WrapUpObject, { toDropShape: function (e) { var t = e.env, n = this.object.toDropShape(e); return t.originalReferencePoint = t.c, n }, toConnectShape: function (e) { var t = e.env, n = this.object.toConnectShape(e); return t.originalReferencePoint = t.c, n } }), _t(Ce.ObjectBox.CompositeObject, { toDropShape: function (e) { var t = e.env, n = t.c; if (void 0 === n) return ft.none; var r = n, i = t.duplicate(), a = new xt(ft.none, i); this.objects.foreach((function (e) { i.c = n; var t = e.toDropShape(a); r = rt.combineRect(r, i.c), r = rt.combineRect(r, t.getBoundingBox().toPoint()) })), t.c = r; var o = a.shape; return e.appendShapeToFront(o), t.originalReferencePoint = n, o } }), _t(Ce.ObjectBox.Xybox, { toDropShape: function (e) { var t = e.env, n = t.c; if (void 0 === n) return ft.none; var r = new Ot, i = new xt(ft.none, r); this.posDecor.toShape(i); var a = i.shape, o = a.getBoundingBox(); if (void 0 === o) return ft.none; var u = Math.max(0, o.l - o.x), s = Math.max(0, o.r + o.x), c = Math.max(0, o.u + o.y), h = Math.max(0, o.d - o.y); t.c = new rt.Rect(n.x, n.y, { l: u, r: s, u: c, d: h }), t.originalReferencePoint = n; var l = new ft.TranslateShape(n.x, n.y, a); return e.appendShapeToFront(l), l } }), _t(Ce.ObjectBox.Xymatrix, { toDropShape: function (e) { var t = e.env, n = t.c, r = this.xymatrix.toShape(e); return t.originalReferencePoint = n, r } }), _t(Ce.ObjectBox.Text, { toDropShape: function (e) { var t = e.env, n = new ft.TextShape(t.c, this.math); return e.appendShapeToFront(n), t.c = n.getBoundingBox(), t.originalReferencePoint = n.getOriginalReferencePoint(), n } }), _t(Ce.ObjectBox.Empty, { toDropShape: function (e) { var t = e.env; return t.originalReferencePoint = t.c, t.c = new rt.Point(t.c.x, t.c.y), ft.none } }), _t(Ce.ObjectBox.Txt, { toDropShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = this.textObject.toDropShape(e); return t.originalReferencePoint = t.c, n } }), _t(Ce.ObjectBox.Txt.Width.Vector, { width: function (e) { return this.vector.xy().x } }), _t(Ce.ObjectBox.Txt.Width.Default, { width: function (e) { var t = e.env.c; return t.r + t.l } }), _t(Ce.ObjectBox.Cir, { toDropShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; t.originalReferencePoint = t.c; var n = this.radius.radius(e), r = t.c.x, i = t.c.y, a = this.cir.toDropShape(e, r, i, n); return t.c = new rt.Ellipse(r, i, n, n, n, n), a }, toConnectShape: function (e) { var t = e.env; return t.originalReferencePoint = t.c, ft.none } }), _t(Ce.ObjectBox.Cir.Radius.Vector, { radius: function (e) { return this.vector.xy(e).x } }), _t(Ce.ObjectBox.Cir.Radius.Default, { radius: function (e) { return e.env.c.r } }), _t(Ce.ObjectBox.Cir.Cir.Segment, { toDropShape: function (e, t, n, r) { e.env; var i, a, o = this.startPointDegree(e), u = this.endPointDegree(e, o), s = u - o; if (0 === (s = s < 0 ? s + 360 : s)) return ft.none; "^" === this.orient ? (i = s > 180 ? "1" : "0", a = "0") : (i = s > 180 ? "0" : "1", a = "1"); var c = Math.PI / 180, h = t + r * Math.cos(o * c), l = n + r * Math.sin(o * c), m = t + r * Math.cos(u * c), p = n + r * Math.sin(u * c), f = new ft.CircleSegmentShape(t, n, h, l, r, i, a, m, p); return e.appendShapeToFront(f), f }, startPointDegree: function (e) { var t = this.startDiag.toString(); return "^" === this.orient ? this.diagToAngleACW(t) : this.diagToAngleCW(t) }, endPointDegree: function (e, t) { var n = this.endDiag.toString(); return "^" === this.orient ? this.diagToAngleACW(n, t) : this.diagToAngleCW(n, t) }, diagToAngleACW: function (e, t) { switch (e) { case "l": return 90; case "r": return -90; case "d": return 180; case "u": return 0; case "dl": case "ld": return 135; case "dr": case "rd": return -135; case "ul": case "lu": return 45; case "ur": case "ru": return -45; default: return void 0 !== t ? t + 180 : 0 } }, diagToAngleCW: function (e, t) { switch (e) { case "l": return -90; case "r": return 90; case "d": return 0; case "u": return 180; case "dl": case "ld": return -45; case "dr": case "rd": return 45; case "ul": case "lu": return -135; case "ur": case "ru": return 135; default: return void 0 !== t ? t + 180 : 0 } } }), _t(Ce.ObjectBox.Cir.Cir.Full, { toDropShape: function (e, t, n, r) { var i = new ft.FullCircleShape(t, n, r); return e.appendShapeToFront(i), i } }), _t(Ce.ObjectBox.Frame, { toDropShape: function (e) { var t = e.env; return t.originalReferencePoint = t.c, this.toDropFilledShape(e, "currentColor", !1) }, toDropFilledShape: function (e, t, n) { var r = e.env.c; if (void 0 === r) return ft.none; var i = pe.measure.thickness, a = r.x, o = r.y, u = r.l, s = r.r, c = r.u, h = r.d, l = ft.none; switch (this.main) { case "--": var m = 3 * i; if (n) { var p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)) } else { var f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !1, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)) } break; case "==": m = 3 * i; if (n) { p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !0, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)) } else { f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !0, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)) } break; case "o-": m = 3 * i, f = pe.measure.lineElementLength; l = new ft.RectangleShape(a, o, u, s, c, h, f, !1, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)); break; case "oo": var d = (p = this.radius.xy(e)).x; l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, d, d, !0, t, void 0); break; case "ee": p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !0, t, void 0); break; case "-,": var y = this.radius.depth(e); f = this.radius.radius(e); l = new ft.CompositeShape(new ft.RectangleShape(a, o, u, s, c, h, f, !1, t, void 0), new ft.BoxShadeShape(a, o, u, s, c, h, y)); break; case ".o": d = (p = this.radius.xy(e)).x; l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, d, d, !1, t, pe.measure.dottedDasharray); break; case "-o": m = 3 * i, d = (p = this.radius.xy(e)).x; l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, d, d, !1, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)); break; case ".e": p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, t, pe.measure.dottedDasharray); break; case "-e": m = 3 * i, p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, t, pe.measure.em2px(m) + " " + pe.measure.em2px(m)); break; case "-": if (n) { p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, t, void 0) } else { f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !1, t, void 0) } break; case "=": if (n) { p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !0, t, void 0) } else { f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !0, t, void 0) } break; case ".": if (n) { p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, t, pe.measure.dottedDasharray) } else { f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !1, t, pe.measure.dottedDasharray) } break; case ",": y = this.radius.depth(e); l = new ft.BoxShadeShape(a, o, u, s, c, h, y, t); break; case "o": d = (p = this.radius.xy(e)).x; l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, d, d, !1, t, void 0); break; case "e": p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, t, void 0); break; case "\\{": l = new ft.LeftBrace(a - u, o, c, h, 0, t); break; case "\\}": l = new ft.LeftBrace(a + s, o, h, c, 180, t); break; case "^\\}": case "^\\{": l = new ft.LeftBrace(a, o + c, s, u, 270, t); break; case "_\\{": case "_\\}": l = new ft.LeftBrace(a, o - h, u, s, 90, t); break; case "(": l = new ft.LeftParenthesis(a - u, o + (c - h) / 2, c + h, 0, t); break; case ")": l = new ft.LeftParenthesis(a + s, o + (c - h) / 2, c + h, 180, t); break; case "^(": case "^)": l = new ft.LeftParenthesis(a + (s - u) / 2, o + c, u + s, 270, t); break; case "_(": case "_)": l = new ft.LeftParenthesis(a + (s - u) / 2, o - h, u + s, 90, t); break; case "*": if (r.isCircle()) { p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, "currentColor", void 0, t, !0) } else { f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !1, "currentColor", void 0, t, !0) } break; case "**": if (r.isCircle()) { p = this.radius.xy(e); l = new ft.EllipseShape(a + (s - u) / 2, o + (c - h) / 2, p.x, p.y, !1, "currentColor", void 0, t, !1) } else { f = this.radius.radius(e); l = new ft.RectangleShape(a, o, u, s, c, h, f, !1, "currentColor", void 0, t, !1) } break; default: return ft.none }return e.appendShapeToFront(l), l }, toConnectShape: function (e) { var t = e.env, n = t.c, r = t.p; void 0 !== n && void 0 !== r || ft.none, t.originalReferencePoint = n; var i = t.duplicate(); i.c = r.combineRect(n); var a = new xt(ft.none, i), o = this.toDropShape(a); return e.appendShapeToFront(o), o } }), _t(Ce.ObjectBox.Frame.Radius.Vector, { radius: function (e) { return this.vector.xy(e).x }, depth: function (e) { return this.vector.xy(e).x }, xy: function (e) { return this.vector.xy(e) } }), _t(Ce.ObjectBox.Frame.Radius.Default, { radius: function (e) { return 0 }, depth: function (e) { return pe.measure.thickness / 2 }, xy: function (e) { var t = e.env.c; return { x: (t.l + t.r) / 2, y: (t.u + t.d) / 2 } } }), _t(Ce.ObjectBox.Dir, { toDropShape: function (e) { var t = e.env, n = t.c; t.originalReferencePoint = n; var r = t.angle; if (void 0 === n) return ft.none; t.c = new rt.Point(n.x, n.y); pe.measure.thickness; var i = ft.none; switch (this.main) { case "": return ft.none; case ">": switch (this.variant) { case "2": var a = (i = new ft.GT2ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; case "3": a = (i = new ft.GT3ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; default: i = "^" === this.variant ? new ft.UpperGTArrowheadShape(n, r) : "_" === this.variant ? new ft.LowerGTArrowheadShape(n, r) : new ft.GTArrowheadShape(n, r) }break; case "<": switch (this.variant) { case "2": a = (i = new ft.LT2ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; case "3": a = (i = new ft.LT3ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; default: i = "^" === this.variant ? new ft.UpperLTArrowheadShape(n, r) : "_" === this.variant ? new ft.LowerLTArrowheadShape(n, r) : new ft.LTArrowheadShape(n, r) }break; case "|": switch (this.variant) { case "^": i = new ft.UpperColumnArrowheadShape(n, r); break; case "_": i = new ft.LowerColumnArrowheadShape(n, r); break; case "2": i = new ft.Column2ArrowheadShape(n, r); break; case "3": i = new ft.Column3ArrowheadShape(n, r); break; default: i = new ft.ColumnArrowheadShape(n, r) }break; case "(": switch (this.variant) { case "^": i = new ft.UpperLParenArrowheadShape(n, r); break; case "_": i = new ft.LowerLParenArrowheadShape(n, r); break; default: i = new ft.LParenArrowheadShape(n, r) }break; case ")": switch (this.variant) { case "^": i = new ft.UpperRParenArrowheadShape(n, r); break; case "_": i = new ft.LowerRParenArrowheadShape(n, r); break; default: i = new ft.RParenArrowheadShape(n, r) }break; case "`": if ("_" === this.variant) i = new ft.LowerBackquoteArrowheadShape(n, r); else i = new ft.UpperBackquoteArrowheadShape(n, r); break; case "'": if ("_" === this.variant) i = new ft.LowerQuoteArrowheadShape(n, r); else i = new ft.UpperQuoteArrowheadShape(n, r); break; case "*": i = new ft.AsteriskArrowheadShape(n, 0); break; case "o": i = new ft.OArrowheadShape(n, 0); break; case "+": i = new ft.PlusArrowheadShape(n, r); break; case "x": i = new ft.XArrowheadShape(n, r); break; case "/": i = new ft.SlashArrowheadShape(n, r); break; case "-": case "--": pe.measure.lineElementLength; i = "3" === this.variant ? new ft.Line3ArrowheadShape(n, r) : "2" === this.variant ? new ft.Line2ArrowheadShape(n, r) : new ft.LineArrowheadShape(n, r); break; case "=": case "==": i = new ft.Line2ArrowheadShape(n, r); break; case ".": case "..": i = "3" === this.variant ? new ft.Dot3ArrowheadShape(n, r) : "2" === this.variant ? new ft.Dot2ArrowheadShape(n, r) : new ft.DotArrowheadShape(n, r); break; case ":": case "::": i = new ft.Dot2ArrowheadShape(n, r); break; case "~": case "~~": i = "3" === this.variant ? new ft.Tilde3ArrowheadShape(n, r) : "2" === this.variant ? new ft.Tilde2ArrowheadShape(n, r) : new ft.TildeArrowheadShape(n, r); break; case ">>": switch (this.variant) { case "^": i = new ft.UpperGTGTArrowheadShape(n, r); break; case "_": i = new ft.LowerGTGTArrowheadShape(n, r); break; case "2": a = (i = new ft.GTGT2ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; case "3": a = (i = new ft.GTGT3ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; default: i = new ft.GTGTArrowheadShape(n, r) }break; case "<<": switch (this.variant) { case "^": i = new ft.UpperLTLTArrowheadShape(n, r); break; case "_": i = new ft.LowerLTLTArrowheadShape(n, r); break; case "2": a = (i = new ft.LTLT2ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; case "3": a = (i = new ft.LTLT3ArrowheadShape(n, r)).getRadius(); t.c = new rt.Ellipse(n.x, n.y, a, a, a, a); break; default: i = new ft.LTLTArrowheadShape(n, r) }break; case "||": switch (this.variant) { case "^": i = new ft.UpperColumnColumnArrowheadShape(n, r); break; case "_": i = new ft.LowerColumnColumnArrowheadShape(n, r); break; case "2": i = new ft.ColumnColumn2ArrowheadShape(n, r); break; case "3": i = new ft.ColumnColumn3ArrowheadShape(n, r); break; default: i = new ft.ColumnColumnArrowheadShape(n, r) }break; case "|-": switch (this.variant) { case "^": i = new ft.UpperColumnLineArrowheadShape(n, r); break; case "_": i = new ft.LowerColumnLineArrowheadShape(n, r); break; case "2": i = new ft.ColumnLine2ArrowheadShape(n, r); break; case "3": i = new ft.ColumnLine3ArrowheadShape(n, r); break; default: i = new ft.ColumnLineArrowheadShape(n, r) }break; case ">|": i = new ft.GTColumnArrowheadShape(n, r); break; case ">>|": i = new ft.GTGTColumnArrowheadShape(n, r); break; case "|<": i = new ft.ColumnLTArrowheadShape(n, r); break; case "|<<": i = new ft.ColumnLTLTArrowheadShape(n, r); break; case "//": i = new ft.SlashSlashArrowheadShape(n, r); break; case "=>": i = new ft.LineGT2ArrowheadShape(n, r); break; default: var o = pe.repositories.dirRepository.get(this.main); if (void 0 === o) throw s("ExecutionError", "\\dir " + this.variant + "{" + this.main + "} not defined."); i = o.toDropShape(e) }return e.appendShapeToFront(i), i }, toConnectShape: function (e) { var t = e.env; t.originalReferencePoint = t.c; pe.measure.thickness; var n = t.p.edgePoint(t.c.x, t.c.y), r = t.c.edgePoint(t.p.x, t.p.y); return n.x !== r.x || n.y !== r.y ? new Et.Line(n, r).toShape(e, this, this.main, this.variant) : (t.angle = 0, t.lastCurve = Lt.none, ft.none) } }), _t(Ce.ObjectBox.Curve, { toDropShape: function (e) { var t = e.env; return t.originalReferencePoint = t.c, ft.none }, toConnectShape: function (e) { var t = e.env; t.originalReferencePoint = t.c; var n = void 0, r = void 0; this.objects.foreach((function (e) { n = e.objectForDrop(n), r = e.objectForConnect(r) })), void 0 === n && void 0 === r && (r = new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "-"))); pe.measure.thickness; var i = t.c, a = t.p, o = []; this.poslist.foreach((function (t) { t.addPositions(o, e) })), t.c = i, t.p = a; var u = ft.none, s = a, c = i; switch (o.length) { case 0: return s.x === c.x && s.y === c.y ? (t.lastCurve = Lt.none, t.angle = 0, ft.none) : void 0 !== r ? r.toConnectShape(e) : n.toConnectShape(e); case 1: var h = (m = new Et.QuadBezier(s, o[0], c)).tOfShavedStart(s), l = m.tOfShavedEnd(c); if (void 0 === h || void 0 === l || h >= l) return t.angle = 0, t.lastCurve = Lt.none, ft.none; u = m.toShape(e, n, r), t.lastCurve = new Lt.QuadBezier(m, h, l, u), t.angle = Math.atan2(c.y - s.y, c.x - s.x); break; case 2: var m; h = (m = new Et.CubicBezier(s, o[0], o[1], c)).tOfShavedStart(s), l = m.tOfShavedEnd(c); if (void 0 === h || void 0 === l || h >= l) return t.angle = 0, t.lastCurve = Lt.none, ft.none; u = m.toShape(e, n, r), t.lastCurve = new Lt.CubicBezier(m, h, l, u), t.angle = Math.atan2(c.y - s.y, c.x - s.x); break; default: var p = new Et.CubicBSpline(s, o, c), f = new Et.CubicBeziers(p.toCubicBeziers()); h = f.tOfShavedStart(s), l = f.tOfShavedEnd(c); if (void 0 === h || void 0 === l || h >= l) return t.angle = 0, t.lastCurve = Lt.none, ft.none; u = f.toShape(e, n, r), t.lastCurve = new Lt.CubicBSpline(s, c, f, h, l, u), t.angle = Math.atan2(c.y - s.y, c.x - s.x) }return u } }), _t(Ce.ObjectBox.Curve.Object.Drop, { objectForDrop: function (e) { return this.object }, objectForConnect: function (e) { return e } }), _t(Ce.ObjectBox.Curve.Object.Connect, { objectForDrop: function (e) { return e }, objectForConnect: function (e) { return this.object } }), _t(Ce.ObjectBox.Curve.PosList.CurPos, { addPositions: function (e, t) { var n = t.env; e.push(n.c) } }), _t(Ce.ObjectBox.Curve.PosList.Pos, { addPositions: function (e, t) { var n = t.env; this.pos.toShape(t), e.push(n.c) } }), _t(Ce.ObjectBox.Curve.PosList.AddStack, { addPositions: function (e, t) { t.env.stack.reverse().foreach((function (t) { e.push(t) })) } }), _t(Ce.Coord.C, { position: function (e) { return e.env.c } }), _t(Ce.Coord.P, { position: function (e) { return e.env.p } }), _t(Ce.Coord.X, { position: function (e) { var t = e.env, n = t.p, r = t.c, i = t.origin, a = t.xBase, o = r.y - n.y, u = n.x - r.x, s = r.x * n.y - r.y * n.x, h = a.y, l = -a.x, m = a.x * i.y - a.y * i.x, p = o * l - h * u; if (Math.abs(p) < c.machinePrecision) return console.log("there is no intersection point."), Ot.originPosition; var f = -(l * s - u * m) / p, d = (h * s - o * m) / p; return new rt.Point(f, d) } }), _t(Ce.Coord.Y, { position: function (e) { var t = e.env, n = t.p, r = t.c, i = t.origin, a = t.yBase, o = r.y - n.y, u = n.x - r.x, s = r.x * n.y - r.y * n.x, h = a.y, l = -a.x, m = a.x * i.y - a.y * i.x, p = o * l - h * u; if (Math.abs(p) < c.machinePrecision) return console.log("there is no intersection point."), Ot.originPosition; var f = -(l * s - u * m) / p, d = (h * s - o * m) / p; return new rt.Point(f, d) } }), _t(Ce.Coord.Vector, { position: function (e) { var t = this.vector.xy(e); return new rt.Point(t.x, t.y) } }), _t(Ce.Coord.Id, { position: function (e) { return e.env.lookupPos(this.id).position(e) } }), _t(Ce.Coord.Group, { position: function (e) { var t = e.env, n = t.origin, r = t.xBase, i = t.yBase, a = t.p; return this.posDecor.toShape(e), t.p = a, t.origin = n, t.xBase = r, t.yBase = i, t.c } }), _t(Ce.Coord.StackPosition, { position: function (e) { return e.env.stackAt(this.number) } }), _t(Ce.Coord.DeltaRowColumn, { position: function (e) { var t = e.env, n = t.xymatrixRow, r = t.xymatrixCol; if (void 0 === n || void 0 === r) throw s("ExecutionError", "xymatrix rows and columns not found for " + this.toSring()); var i = this.prefix + (n + this.dr) + "," + (r + this.dc); return e.env.lookupPos(i, 'in entry "' + t.xymatrixRow + "," + t.xymatrixCol + '": No ' + this + " (is " + i + ") from here.").position(e) } }), _t(Ce.Coord.Hops, { position: function (e) { var t = e.env, n = t.xymatrixRow, r = t.xymatrixCol; if (void 0 === n || void 0 === r) throw s("ExecutionError", "xymatrix rows and columns not found for " + this.toSring()); this.hops.foreach((function (e) { switch (e) { case "u": n -= 1; break; case "d": n += 1; break; case "l": r -= 1; break; case "r": r += 1 } })); var i = this.prefix + n + "," + r; return e.env.lookupPos(i, 'in entry "' + t.xymatrixRow + "," + t.xymatrixCol + '": No ' + this + " (is " + i + ") from here.").position(e) } }), _t(Ce.Coord.HopsWithPlace, { position: function (e) { var t = e.env, n = t.xymatrixRow, r = t.xymatrixCol; if (void 0 === n || void 0 === r) throw s("ExecutionError", "xymatrix rows and columns not found for " + this.toSring()); this.hops.foreach((function (e) { switch (e) { case "u": n -= 1; break; case "d": n += 1; break; case "l": r -= 1; break; case "r": r += 1 } })); var i = this.prefix + n + "," + r, a = e.env.lookupPos(i, 'in entry "' + t.xymatrixRow + "," + t.xymatrixCol + '": No ' + this + " (is " + i + ") from here.").position(e), o = (t.c, t.duplicate()); o.p = t.c, o.c = a; var u, c = o.c.x - o.p.x, h = o.c.y - o.p.y; u = 0 === c && 0 === h ? 0 : Math.atan2(h, c), o.angle = u; var l = o.p.edgePoint(o.c.x, o.c.y), m = o.c.edgePoint(o.p.x, o.p.y); o.lastCurve = new Lt.Line(l, m, o.p, o.c, void 0); var p = new xt(ft.none, o), f = this.place.toShape(p); return o.lastCurve.position(f) } }), _t(Ce.Vector.InCurBase, { xy: function (e) { return e.env.absVector(this.x, this.y) }, angle: function (e) { var t = e.env.absVector(this.x, this.y); return Math.atan2(t.y, t.x) } }), _t(Ce.Vector.Abs, { xy: function (e) { return { x: pe.measure.length2em(this.x), y: pe.measure.length2em(this.y) } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Vector.Angle, { xy: function (e) { var t = Math.PI / 180 * this.degree, n = e.env.absVector(Math.cos(t), Math.sin(t)); return n }, angle: function (e) { return Math.PI / 180 * this.degree } }), _t(Ce.Vector.Dir, { xy: function (e) { var t = pe.measure.length2em(this.dimen), n = this.dir.angle(e); return { x: t * Math.cos(n), y: t * Math.sin(n) } }, angle: function (e) { return this.dir.angle(e) } }), _t(Ce.Vector.Corner, { xy: function (e) { var t = this.corner.xy(e); return { x: t.x * this.factor, y: t.y * this.factor } }, angle: function (e) { return this.corner.angle(e) } }), _t(Ce.Corner.L, { xy: function (e) { return { x: -e.env.c.l, y: 0 } }, angle: function (e) { return Math.PI } }), _t(Ce.Corner.R, { xy: function (e) { return { x: e.env.c.r, y: 0 } }, angle: function (e) { return 0 } }), _t(Ce.Corner.D, { xy: function (e) { return { x: 0, y: -e.env.c.d } }, angle: function (e) { return -Math.PI / 2 } }), _t(Ce.Corner.U, { xy: function (e) { return { x: 0, y: e.env.c.u } }, angle: function (e) { return Math.PI / 2 } }), _t(Ce.Corner.CL, { xy: function (e) { var t = e.env.c; return { x: -t.l, y: (t.u - t.d) / 2 } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.CR, { xy: function (e) { var t = e.env.c; return { x: t.r, y: (t.u - t.d) / 2 } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.CD, { xy: function (e) { var t = e.env.c; return { x: (t.r - t.l) / 2, y: -t.d } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.CU, { xy: function (e) { var t = e.env.c; return { x: (t.r - t.l) / 2, y: t.u } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.LU, { xy: function (e) { var t = e.env.c; return { x: -t.l, y: t.u } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.LD, { xy: function (e) { var t = e.env.c; return { x: -t.l, y: -t.d } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.RU, { xy: function (e) { var t = e.env.c; return { x: t.r, y: t.u } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.RD, { xy: function (e) { var t = e.env.c; return { x: t.r, y: -t.d } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.NearestEdgePoint, { xy: function (e) { var t = e.env, n = t.c, r = n.edgePoint(t.p.x, t.p.y); return { x: r.x - n.x, y: r.y - n.y } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.PropEdgePoint, { xy: function (e) { var t = e.env, n = t.c, r = n.proportionalEdgePoint(t.p.x, t.p.y); return { x: r.x - n.x, y: r.y - n.y } }, angle: function (e) { var t = this.xy(e); return Math.atan2(t.y, t.x) } }), _t(Ce.Corner.Axis, { xy: function (e) { return { x: 0, y: pe.measure.axisHeightLength } }, angle: function (e) { return Math.PI / 2 } }), _t(Ce.Modifier, { proceedModifyShape: function (e, t, n) { return n.isEmpty ? t : n.head.modifyShape(e, t, n.tail) } }), _t(Ce.Modifier.Vector, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = this.vector.xy(e), i = e.env; return i.c = i.c.shiftFrame(-r.x, -r.y), t = new ft.TranslateShape(-r.x, -r.y, t), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.RestoreOriginalRefPoint, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env, i = r.originalReferencePoint; if (void 0 !== i) { var a = r.c.x - i.x, o = r.c.y - i.y; r.c = r.c.shiftFrame(a, o), t = new ft.TranslateShape(a, o, t) } return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.Point, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env.c; return e.env.c = new rt.Point(r.x, r.y), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.Rect, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env.c; return e.env.c = new rt.Rect(r.x, r.y, { l: r.l, r: r.r, u: r.u, d: r.d }), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.Circle, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env.c; return e.env.c = new rt.Ellipse(r.x, r.y, r.l, r.r, r.u, r.d), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.L, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env, i = r.c; if (void 0 !== i) { var a, o, u = i.r + i.l, s = i.u + i.d; u < s ? (a = (i.l - i.r) / 2, o = (i.d - i.u) / 2) : (a = -i.r + s / 2, o = (i.d - i.u) / 2), r.c = r.c.shiftFrame(a, o), t = new ft.TranslateShape(a, o, t) } return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.R, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env, i = r.c; if (void 0 !== i) { var a, o, u = i.r + i.l, s = i.u + i.d; u < s ? (a = (i.l - i.r) / 2, o = (i.d - i.u) / 2) : (a = i.l - s / 2, o = (i.d - i.u) / 2), r.c = r.c.shiftFrame(a, o), t = new ft.TranslateShape(a, o, t) } return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.U, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env, i = r.c; if (void 0 !== i) { var a, o, u = i.r + i.l; u > i.u + i.d ? (a = (i.l - i.r) / 2, o = (i.d - i.u) / 2) : (a = (i.l - i.r) / 2, o = i.d - u / 2), r.c = r.c.shiftFrame(a, o), t = new ft.TranslateShape(a, o, t) } return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.D, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env, i = r.c; if (void 0 !== i) { var a, o, u = i.r + i.l; u > i.u + i.d ? (a = (i.l - i.r) / 2, o = (i.d - i.u) / 2) : (a = (i.l - i.r) / 2, o = -i.u + u / 2), r.c = r.c.shiftFrame(a, o), t = new ft.TranslateShape(a, o, t) } return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.C, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r, i, a = e.env, o = a.c; void 0 !== o && (r = (o.l - o.r) / 2, i = (o.d - o.u) / 2, a.c = a.c.shiftFrame(r, i), t = new ft.TranslateShape(r, i, t)); return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.ChangeColor, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { return t = this.proceedModifyShape(e, t, n), new ft.ChangeColorShape(this.colorName, t) } }), _t(Ce.Modifier.Shape.Alphabets, { preprocess: function (e, t) { var n = pe.repositories.modifierRepository.get(this.alphabets); if (void 0 !== n) return n.preprocess(e, t) }, modifyShape: function (e, t, n) { var r = pe.repositories.modifierRepository.get(this.alphabets); if (void 0 !== r) return r.modifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.DefineShape, { preprocess: function (e, t) { var n = t.reverse(); pe.repositories.modifierRepository.put(this.shape, new Ce.Modifier.Shape.CompositeModifiers(n)) }, modifyShape: function (e, t, n) { return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.CompositeModifiers, { preprocess: function (e, t) { this.modifiers.foreach((function (n) { n.preprocess(e, t), t = t.prepend(n) })) }, modifyShape: function (e, t, n) { return t = this.proceedModifyShape(e, t, this.modifiers), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Invisible, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { return t = this.proceedModifyShape(e, t, n), ft.none } }), _t(Ce.Modifier.Hidden, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Direction, { preprocess: function (e, t) { e.env.angle = this.direction.angle(e) }, modifyShape: function (e, t, n) { return e.env.angle = this.direction.angle(e), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.AddOp, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env.c; return e.env.c = this.op.apply(this.size, r, e), e.appendShapeToFront(new ft.InvisibleBoxShape(e.env.c)), this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.AddOp.Grow, { apply: function (e, t, n) { var r = n.env, i = e.isDefault ? { x: 2 * r.objectmargin, y: 2 * r.objectmargin } : e.vector.xy(n), a = Math.abs(i.x / 2), o = Math.abs(i.y / 2); return t.grow(a, o) }, applyToDimen: function (e, t) { return e + t } }), _t(Ce.Modifier.AddOp.Shrink, { apply: function (e, t, n) { var r = n.env, i = e.isDefault ? { x: 2 * r.objectmargin, y: 2 * r.objectmargin } : e.vector.xy(n), a = -Math.abs(i.x / 2), o = -Math.abs(i.y / 2); return t.grow(a, o) }, applyToDimen: function (e, t) { return e - t } }), _t(Ce.Modifier.AddOp.Set, { apply: function (e, t, n) { var r = n.env, i = e.isDefault ? { x: r.objectwidth, y: r.objectheight } : e.vector.xy(n), a = Math.abs(i.x), o = Math.abs(i.y); return t.toSize(a, o) }, applyToDimen: function (e, t) { return t } }), _t(Ce.Modifier.AddOp.GrowTo, { apply: function (e, t, n) { var r = Math.max(t.l + t.r, t.u + t.d), i = e.isDefault ? { x: r, y: r } : e.vector.xy(n), a = Math.abs(i.x), o = Math.abs(i.y); return t.growTo(a, o) }, applyToDimen: function (e, t) { return Math.max(Math.max(e, t), 0) } }), _t(Ce.Modifier.AddOp.ShrinkTo, { apply: function (e, t, n) { var r = Math.min(t.l + t.r, t.u + t.d), i = e.isDefault ? { x: r, y: r } : e.vector.xy(n), a = Math.abs(i.x), o = Math.abs(i.y); return t.shrinkTo(a, o) }, applyToDimen: function (e, t) { return Math.max(Math.min(e, t), 0) } }), _t(Ce.Modifier.Shape.Frame, { preprocess: function (e, t) { }, modifyShape: function (e, t, n) { var r = e.env; if (void 0 !== r.c) { this.main; var i = new Ce.ObjectBox.Frame.Radius.Default, a = "currentColor"; this.options.foreach((function (e) { i = e.getRadius(i) })), this.options.foreach((function (e) { a = e.getColorName(a) })); var o = r.duplicate(), u = new xt(ft.none, o), s = new Ce.ObjectBox.Frame(i, this.main).toDropFilledShape(u, a, r.c.isCircle()); t = new ft.CompositeShape(t, s) } return this.proceedModifyShape(e, t, n) } }), _t(Ce.Modifier.Shape.Frame.Radius, { getRadius: function (e) { return new Ce.ObjectBox.Frame.Radius.Vector(this.vector) }, getColorName: function (e) { return e } }), _t(Ce.Modifier.Shape.Frame.Color, { getRadius: function (e) { return e }, getColorName: function (e) { return this.colorName } }), _t(Ce.Direction.Compound, { angle: function (e) { var t = this.dir.angle(e); return this.rots.foreach((function (n) { t = n.rotate(t, e) })), t } }), _t(Ce.Direction.Diag, { angle: function (e) { return this.diag.angle(e) } }), _t(Ce.Direction.Vector, { angle: function (e) { return this.vector.angle(e) } }), _t(Ce.Direction.ConstructVector, { angle: function (e) { var t = e.env, n = t.origin, r = t.xBase, i = t.yBase, a = t.p, o = t.c; this.posDecor.toShape(e); var u = Math.atan2(t.c.y - t.p.y, t.c.x - t.p.x); return t.c = o, t.p = a, t.origin = n, t.xBase = r, t.yBase = i, u } }), _t(Ce.Direction.RotVector, { rotate: function (e, t) { return e + this.vector.angle(t) } }), _t(Ce.Direction.RotCW, { rotate: function (e, t) { return e + Math.PI / 2 } }), _t(Ce.Direction.RotAntiCW, { rotate: function (e, t) { return e - Math.PI / 2 } }), _t(Ce.Diag.Default, { isEmpty: !0, angle: function (e) { return e.env.angle } }), _t(Ce.Diag.Angle, { isEmpty: !1, angle: function (e) { return this.ang } }), _t(Ce.Decor, { toShape: function (e) { this.commands.foreach((function (t) { t.toShape(e) })) } }), _t(Ce.Command.Save, { toShape: function (e) { e.env.saveState(), this.pos.toShape(e) } }), _t(Ce.Command.Restore, { toShape: function (e) { e.env.restoreState() } }), _t(Ce.Command.Pos, { toShape: function (e) { this.pos.toShape(e) } }), _t(Ce.Command.AfterPos, { toShape: function (e) { this.pos.toShape(e), this.decor.toShape(e) } }), _t(Ce.Command.Drop, { toShape: function (e) { this.object.toDropShape(e) } }), _t(Ce.Command.Connect, { toShape: function (e) { this.object.toConnectShape(e) } }), _t(Ce.Command.Relax, { toShape: function (e) { } }), _t(Ce.Command.Ignore, { toShape: function (e) { } }), _t(Ce.Command.ShowAST, { toShape: function (e) { console.log(this.pos.toString() + " " + this.decor) } }), _t(Ce.Command.Ar, { toShape: function (e) { var t = e.env, n = t.origin, r = t.xBase, i = t.yBase, a = t.p, o = t.c; t.pathActionForBeforeSegment = g.empty, t.pathActionForAfterSegment = g.empty, t.labelsForNextSegmentOnly = g.empty, t.labelsForLastSegmentOnly = g.empty, t.labelsForEverySegment = g.empty, t.segmentSlideEm = g.empty, t.lastTurnDiag = g.empty, t.arrowVariant = "", t.tailTip = new Ce.Command.Ar.Form.Tip.Tipchars(""), t.headTip = new Ce.Command.Ar.Form.Tip.Tipchars(">"), t.stemConn = new Ce.Command.Ar.Form.Conn.Connchars("-"), t.reverseAboveAndBelow = !1, t.arrowObjectModifiers = L.empty, this.forms.foreach((function (t) { t.toShape(e) })), t.pathActionForBeforeSegment.isDefined || (t.pathActionForBeforeSegment = new g.Some(new Ce.PosDecor(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.ConnectObject(new Ce.Object(t.arrowObjectModifiers, t.stemConn.getObject(e))))), new Ce.Decor(L.empty)))), t.labelsForNextSegmentOnly = new g.Some(new Ce.Command.Path.Labels(L.empty.append(new Ce.Command.Path.Label.At(new Ce.Pos.Place(new Ce.Place(1, 1, new Ce.Place.Factor(0), new Ce.Slide(g.empty))), t.tailTip.getObject(e), g.empty)))), t.labelsForLastSegmentOnly = new g.Some(new Ce.Command.Path.Labels(L.empty.append(new Ce.Command.Path.Label.At(new Ce.Pos.Place(new Ce.Place(1, 1, new Ce.Place.Factor(1), new Ce.Slide(g.empty))), t.headTip.getObject(e), g.empty)))), this.path.toShape(e), t.c = o, t.p = a, t.origin = n, t.xBase = r, t.yBase = i } }), _t(Ce.Command.Ar.Form.BuildArrow, { toShape: function (e) { var t = e.env; t.arrowVariant = this.variant, t.tailTip = this.tailTip, t.stemConn = this.stemConn, t.headTip = this.headTip } }), _t(Ce.Command.Ar.Form.ChangeVariant, { toShape: function (e) { e.env.arrowVariant = this.variant } }), _t(Ce.Command.Ar.Form.ChangeStem, { toShape: function (e) { e.env.stemConn = new Ce.Command.Ar.Form.Conn.Connchars(this.connchar) } }), _t(Ce.Command.Ar.Form.DashArrowStem, { toShape: function (e) { } }), _t(Ce.Command.Ar.Form.CurveArrow, { toShape: function (e) { var t = e.env, n = pe.measure.em2length(2 * pe.measure.length2em(this.dist)); t.pathActionForBeforeSegment = new g.Some(new Ce.PosDecor(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.ConnectObject(new Ce.Object(t.arrowObjectModifiers, new Ce.ObjectBox.Curve(L.empty, L.empty.append(new Ce.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))), L.empty.append(new Ce.ObjectBox.Curve.PosList.Pos(new Ce.Pos.Coord(new Ce.Coord.Group(new Ce.PosDecor(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.ConnectObject(new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "")))).append(new Ce.Pos.Place(new Ce.Place(0, 0, void 0, new Ce.Slide(g.empty)))).append(new Ce.Pos.Plus(new Ce.Coord.Vector(new Ce.Vector.Dir(this.direction, n))))), new Ce.Decor(L.empty))), L.empty)))))))), new Ce.Decor(L.empty))) } }), _t(Ce.Command.Ar.Form.CurveFitToDirection, { toShape: function (e) { var t = e.env; t.pathActionForBeforeSegment = new g.Some(new Ce.PosDecor(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.ConnectObject(new Ce.Object(t.arrowObjectModifiers, new Ce.ObjectBox.Curve(L.empty, L.empty.append(new Ce.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))), L.empty.append(new Ce.ObjectBox.Curve.PosList.Pos(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.SwapPAndC(new Ce.Coord.C)).append(new Ce.Pos.Plus(new Ce.Coord.Vector(new Ce.Vector.Dir(this.outDirection, "3pc"))))))).append(new Ce.ObjectBox.Curve.PosList.Pos(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.SwapPAndC(new Ce.Coord.C)).append(new Ce.Pos.Plus(new Ce.Coord.Vector(new Ce.Vector.Dir(this.inDirection, "3pc")))))))))))), new Ce.Decor(L.empty))) } }), _t(Ce.Command.Ar.Form.CurveWithControlPoints, { toShape: function (e) { var t = e.env, n = t.duplicate(); n.startCapturePositions(); var r = new xt(ft.none, n); this.coord.position(r); var i = n.endCapturePositions(); i = i.append(n.c); var a = L.empty; i.reverse().foreach((function (e) { var n = t.inverseAbsVector(e.x, e.y); a = a.prepend(new Ce.ObjectBox.Curve.PosList.Pos(new Ce.Pos.Coord(new Ce.Coord.Vector(new Ce.Vector.InCurBase(n.x, n.y)), L.empty))) })), t.pathActionForBeforeSegment = new g.Some(new Ce.PosDecor(new Ce.Pos.Coord(new Ce.Coord.C, L.empty.append(new Ce.Pos.ConnectObject(new Ce.Object(t.arrowObjectModifiers, new Ce.ObjectBox.Curve(L.empty, L.empty.append(new Ce.ObjectBox.Curve.Object.Connect(t.stemConn.getObject(e))), a))))), new Ce.Decor(L.empty))) } }), _t(Ce.Command.Ar.Form.AddShape, { toShape: function (e) { e.env.arrowObjectModifiers = L.empty.append(this.shape) } }), _t(Ce.Command.Ar.Form.AddModifiers, { toShape: function (e) { e.env.arrowObjectModifiers = this.modifiers } }), _t(Ce.Command.Ar.Form.Slide, { toShape: function (e) { e.env.segmentSlideEm = new g.Some(pe.measure.length2em(this.slideDimen)) } }), _t(Ce.Command.Ar.Form.LabelAt, { toShape: function (e) { e.env.labelsForEverySegment = new g.Some(new Ce.Command.Path.Labels(L.empty.append(new Ce.Command.Path.Label.At(new Ce.Pos.Place(this.anchor), this.it, g.empty)))) } }), _t(Ce.Command.Ar.Form.LabelAbove, { toShape: function (e) { var t, n = e.env; t = n.reverseAboveAndBelow ? new Ce.Command.Path.Label.Below(new Ce.Pos.Place(this.anchor), this.it, g.empty) : new Ce.Command.Path.Label.Above(new Ce.Pos.Place(this.anchor), this.it, g.empty), n.labelsForEverySegment = new g.Some(new Ce.Command.Path.Labels(L.empty.append(t))) } }), _t(Ce.Command.Ar.Form.LabelBelow, { toShape: function (e) { var t, n = e.env; t = n.reverseAboveAndBelow ? new Ce.Command.Path.Label.Above(new Ce.Pos.Place(this.anchor), this.it, g.empty) : new Ce.Command.Path.Label.Below(new Ce.Pos.Place(this.anchor), this.it, g.empty), n.labelsForEverySegment = new g.Some(new Ce.Command.Path.Labels(L.empty.append(t))) } }), _t(Ce.Command.Ar.Form.ReverseAboveAndBelow, { toShape: function (e) { e.env.reverseAboveAndBelow = !0 } }), _t(Ce.Command.Ar.Form.Conn.Connchars, { getObject: function (e) { var t = e.env, n = new Ce.ObjectBox.Dir(t.arrowVariant, this.connchars); return new Ce.Object(t.arrowObjectModifiers, n) } }), _t(Ce.Command.Ar.Form.Conn.Object, { getObject: function (e) { var t = e.env.arrowObjectModifiers.concat(this.object.modifiers); return new Ce.Object(t, this.object.object) } }), _t(Ce.Command.Ar.Form.Conn.Dir, { getObject: function (e) { var t = e.env, n = this.dir, r = n; return "" === n.variant && "" !== t.arrowVariant && (r = new Ce.ObjectBox.Dir(t.arrowVariant, n.main)), new Ce.Object(t.arrowObjectModifiers, r) } }), _t(Ce.Command.Ar.Form.Tip.Tipchars, { getObject: function (e) { var t = e.env, n = new Ce.ObjectBox.Dir(t.arrowVariant, this.tipchars); return new Ce.Object(t.arrowObjectModifiers, n) } }), _t(Ce.Command.Ar.Form.Tip.Object, { getObject: function (e) { var t = e.env.arrowObjectModifiers.concat(this.object.modifiers); return new Ce.Object(t, this.object.object) } }), _t(Ce.Command.Ar.Form.Tip.Dir, { getObject: function (e) { var t = e.env, n = this.dir, r = n; return "" === n.variant && "" !== t.arrowVariant && (r = new Ce.ObjectBox.Dir(t.arrowVariant, n.main)), new Ce.Object(t.arrowObjectModifiers, r) } }), _t(Ce.Command.Path, { toShape: function (e) { var t = e.env, n = t.origin, r = t.xBase, i = t.yBase, a = t.p, o = t.c; t.pathActionForBeforeSegment = g.empty, t.pathActionForAfterSegment = g.empty, t.labelsForNextSegmentOnly = g.empty, t.labelsForLastSegmentOnly = g.empty, t.labelsForEverySegment = g.empty, t.segmentSlideEm = g.empty, t.lastTurnDiag = g.empty, this.path.toShape(e), t.c = o, t.p = a, t.origin = n, t.xBase = r, t.yBase = i } }), _t(Ce.Command.AfterPath, { toShape: function (e) { this.path.toShape(e), this.decor.toShape(e) } }), _t(Ce.Command.Path.Path, { toShape: function (e) { this.pathElements.foreach((function (t) { t.toShape(e) })) } }), _t(Ce.Command.Path.SetBeforeAction, { toShape: function (e) { e.env.pathActionForBeforeSegment = new g.Some(this.posDecor) } }), _t(Ce.Command.Path.SetAfterAction, { toShape: function (e) { e.env.pathActionForAfterSegment = new g.Some(this.posDecor) } }), _t(Ce.Command.Path.AddLabelNextSegmentOnly, { toShape: function (e) { e.env.labelsForNextSegmentOnly = new g.Some(this.labels) } }), _t(Ce.Command.Path.AddLabelLastSegmentOnly, { toShape: function (e) { e.env.labelsForLastSegmentOnly = new g.Some(this.labels) } }), _t(Ce.Command.Path.AddLabelEverySegment, { toShape: function (e) { e.env.labelsForEverySegment = new g.Some(this.labels) } }), _t(Ce.Command.Path.StraightSegment, { toShape: function (e) { var t = e.env; this.segment.setupPositions(e); var n = t.c; t.pathActionForBeforeSegment.foreach((function (t) { t.toShape(e) })), t.labelsForNextSegmentOnly.foreach((function (n) { n.toShape(e), t.labelsForNextSegmentOnly = g.empty })), t.labelsForEverySegment.foreach((function (t) { t.toShape(e) })), t.c = n, t.pathActionForAfterSegment.foreach((function (t) { t.toShape(e) })), this.segment.toLabelsShape(e) } }), _t(Ce.Command.Path.LastSegment, { toShape: function (e) { var t = e.env; this.segment.setupPositions(e); var n = t.c; t.pathActionForBeforeSegment.foreach((function (t) { t.toShape(e) })), t.labelsForNextSegmentOnly.foreach((function (n) { n.toShape(e), t.labelsForNextSegmentOnly = g.empty })), t.labelsForLastSegmentOnly.foreach((function (n) { n.toShape(e), t.labelsForNextSegmentOnly = g.empty })), t.labelsForEverySegment.foreach((function (t) { t.toShape(e) })), t.c = n, t.pathActionForAfterSegment.foreach((function (t) { t.toShape(e) })), this.segment.toLabelsShape(e) } }), _t(Ce.Command.Path.TurningSegment, { toShape: function (e) { var t = e.env, n = t.c; this.segment.pos.toShape(e), t.p = n; var r = this.turn.explicitizedCircle(e), i = this.turn.radius.radius(e); t.lastTurnDiag = new g.Some(r.endDiag); var a = r.startVector(e), o = r.endVector(e), u = t.segmentSlideEm.getOrElse(0); this.segment.slide.dimen.foreach((function (e) { u = pe.measure.length2em(e), t.segmentSlideEm = new g.Some(u) })), 0 !== u && (t.p = t.p.move(t.p.x - u * a.y, t.p.y + u * a.x), t.c = t.c.move(t.c.x - u * o.y, t.c.y + u * o.x), i = "^" === r.orient ? Math.max(0, i - u) : Math.max(0, i + u)); var s, h = t.p.edgePoint(t.p.x + a.x, t.p.y + a.y), l = t.c, m = r.relativeStartPoint(e, i), p = r.relativeEndPoint(e, i), f = r.relativeEndPoint(e, i + ("^" === r.orient ? u : -u)), d = a.x * o.y - a.y * o.x; if (Math.abs(d) < c.machinePrecision) s = 0; else { var y = l.x - h.x + m.x - p.x, v = l.y - h.y + m.y - p.y; (s = (o.y * y - o.x * v) / d) < 0 && (s = 0) } var x = h.x - m.x + s * a.x, w = h.y - m.y + s * a.y, S = (r.toDropShape(e, x, w, i), new rt.Point(x + f.x, w + f.y)); t.c = new rt.Point(x + m.x, w + m.y), t.pathActionForBeforeSegment.foreach((function (t) { t.toShape(e) })), t.labelsForNextSegmentOnly.foreach((function (n) { n.toShape(e), t.labelsForNextSegmentOnly = g.empty })), t.labelsForEverySegment.foreach((function (t) { t.toShape(e) })), t.c = S, t.pathActionForAfterSegment.foreach((function (t) { t.toShape(e) })), this.segment.toLabelsShape(e) } }), _t(Ce.Command.Path.Turn.Cir, { explicitizedCircle: function (e) { var t, n, r, i = e.env; return t = this.cir.startDiag.isEmpty ? i.lastTurnDiag.getOrElse(new Ce.Diag.R) : this.cir.startDiag, n = this.cir.orient, r = this.cir.endDiag.isEmpty ? t.turn(n) : this.cir.endDiag, new Ce.ObjectBox.Cir.Cir.Segment(t, n, r) } }), _t(Ce.ObjectBox.Cir.Cir.Segment, { startVector: function (e) { var t = this.startDiag.angle(e); return { x: Math.cos(t), y: Math.sin(t) } }, endVector: function (e) { var t = this.endDiag.angle(e); return { x: Math.cos(t), y: Math.sin(t) } }, relativeStartPointAngle: function (e) { return this.startPointDegree(e) / 180 * Math.PI }, relativeStartPoint: function (e, t) { var n = this.startPointDegree(e) / 180 * Math.PI; return { x: t * Math.cos(n), y: t * Math.sin(n) } }, relativeEndPoint: function (e, t) { var n; return n = this.endPointDegree(e, this.relativeStartPointAngle(e)) / 180 * Math.PI, { x: t * Math.cos(n), y: t * Math.sin(n) } } }), _t(Ce.Command.Path.Turn.Diag, { explicitizedCircle: function (e) { var t, n, r, i = e.env, a = (t = this.diag.isEmpty ? i.lastTurnDiag.getOrElse(new Ce.Diag.R) : this.diag).angle(e); return n = (i.c.x - i.p.x) * Math.sin(a) - (i.c.y - i.p.y) * Math.cos(a) < 0 ? "^" : "_", r = t.turn(n), new Ce.ObjectBox.Cir.Cir.Segment(t, n, r) } }), _t(Ce.Command.Path.TurnRadius.Default, { radius: function (e) { return pe.measure.turnradius } }), _t(Ce.Command.Path.TurnRadius.Dimen, { radius: function (e) { return pe.measure.length2em(this.dimen) } }), _t(Ce.Command.Path.Segment, { setupPositions: function (e) { var t = e.env; t.p = t.c, this.pos.toShape(e); var n = t.p, r = t.c, i = r.x - n.x, a = r.y - n.y, o = Math.atan2(a, i) + Math.PI / 2, u = t.segmentSlideEm.getOrElse(0); this.slide.dimen.foreach((function (e) { u = pe.measure.length2em(e), t.segmentSlideEm = new g.Some(u) })), 0 !== u && (n = n.move(n.x + u * Math.cos(o), n.y + u * Math.sin(o)), r = r.move(r.x + u * Math.cos(o), r.y + u * Math.sin(o))), t.p = n, t.c = r }, toLabelsShape: function (e) { var t = e.env, n = t.c, r = t.p; this.labels.toShape(e), t.c = n, t.p = r } }), _t(Ce.Command.Path.Labels, { toShape: function (e) { this.labels.foreach((function (t) { t.toShape(e) })) } }), _t(Ce.Command.Path.Label, { toShape: function (e) { var t = e.env, n = t.p, r = t.c, i = this.anchor.toShape(e), a = this.getLabelMargin(e); if (0 !== a) { var o; o = (w = t.lastCurve).isNone ? Math.atan2(r.y - n.y, r.x - n.x) + Math.PI / 2 : w.angle(i) + Math.PI / 2 + (a > 0 ? 0 : Math.PI); r = t.c; var u = new xt(ft.none, t); this.it.toDropShape(u); var s = u.shape, c = s.getBoundingBox(); if (void 0 !== c) { var h = c.x - r.x, l = c.y - r.y, m = c.l, p = c.r, f = c.u, d = c.d, y = Math.cos(o), v = Math.sin(o), x = Math.min((h - m) * y + (l - d) * v, (h - m) * y + (l + f) * v, (h + p) * y + (l - d) * v, (h + p) * y + (l + f) * v), g = Math.abs(a) - x; t.c = t.c.move(r.x + g * y, r.y + g * v), e.appendShapeToFront(new ft.TranslateShape(g * y, g * v, s)) } } else this.it.toDropShape(e); var w = t.lastCurve; this.shouldSliceHole && w.isDefined && void 0 !== i && w.sliceHole(t.c, i), this.aliasOption.foreach((function (e) { t.savePos(e, new Rt.Position(t.c)) })) } }), _t(Ce.Command.Path.Label.Above, { getLabelMargin: function (e) { return e.env.labelmargin }, shouldSliceHole: !1 }), _t(Ce.Command.Path.Label.Below, { getLabelMargin: function (e) { return -e.env.labelmargin }, shouldSliceHole: !1 }), _t(Ce.Command.Path.Label.At, { getLabelMargin: function (e) { return 0 }, shouldSliceHole: !0 }), _t(Ce.Command.Xymatrix, { toShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = t.duplicate(), r = new xt(ft.none, n); n.xymatrixPrefix = "", n.xymatrixRowSepEm = pe.measure.length2em("2pc"), n.xymatrixColSepEm = pe.measure.length2em("2pc"), n.xymatrixPretendEntryHeight = g.empty, n.xymatrixPretendEntryWidth = g.empty, n.xymatrixFixedRow = !1, n.xymatrixFixedCol = !1, n.xymatrixOrientationAngle = 0, n.xymatrixEntryModifiers = L.empty, this.setup.foreach((function (e) { e.toShape(r) })); var i, a, o = n.xymatrixOrientationAngle, u = 0, s = 0, c = new It(this.rows.map((function (e) { s += 1, a = 0; var t = new It.Row(e.entries.map((function (e) { a += 1; var t = n.duplicate(); t.origin = { x: 0, y: 0 }, t.p = t.c = Ot.originPosition, t.angle = 0, t.lastCurve = Lt.none, t.xymatrixRow = s, t.xymatrixCol = a; var r, i, o, u, c = new xt(ft.none, t), h = e.toShape(c), l = t.c; if (n.xymatrixPretendEntryHeight.isDefined) { var m = n.xymatrixPretendEntryHeight.get; o = m / 2, u = m / 2 } else o = l.u, u = l.d; if (n.xymatrixPretendEntryWidth.isDefined) { var p = n.xymatrixPretendEntryWidth.get; r = p / 2, i = p / 2 } else r = l.l, i = l.r; var f = new rt.Rect(0, 0, { l: r, r: i, u: o, d: u }); return new It.Entry(t.c, h, e.decor, f) })), o); return u = Math.max(u, a), t })), o); if (0 === (i = s)) return ft.none; c.rows.foreach((function (e) { a = 0, e.entries.foreach((function (e) { a += 1, c.getColumn(a).addEntry(e) })) })); var h, l, m = n.xymatrixColSepEm, p = [], f = t.c.x; if (p.push(f), n.xymatrixFixedCol) { var d = 0, y = 0; c.columns.foreach((function (e) { d = Math.max(d, e.getL()), y = Math.max(y, e.getR()) })), c.columns.tail.foreach((function (e) { f = f + y + m + d, p.push(f) })), h = d, l = p[p.length - 1] + y } else { var v = c.columns.head; c.columns.tail.foreach((function (e) { f = f + v.getR() + m + e.getL(), p.push(f), v = e })), h = c.columns.head.getL(), l = f + c.columns.at(u - 1).getR() - p[0] } var x, w, S = n.xymatrixRowSepEm, b = [], C = t.c.y; if (b.push(C), n.xymatrixFixedRow) { var k = 0, M = 0; c.rows.foreach((function (e) { k = Math.max(k, e.getU()), M = Math.max(M, e.getD()) })), c.rows.tail.foreach((function (e) { C -= M + S + k, b.push(C) })), x = k, w = b[0] - b[b.length - 1] + M } else { var P = c.rows.head; c.rows.tail.foreach((function (e) { C -= P.getD() + S + e.getU(), b.push(C), P = e })), x = c.rows.head.getU(), w = b[0] - C + c.rows.at(i - 1).getD() } t.c = new rt.Rect(t.c.x, t.c.y, { l: h, r: l, u: x, d: w }); var B = n.xymatrixPrefix, O = Math.cos(o), E = Math.sin(o), A = 0; c.rows.foreach((function (e) { var t = 0; e.entries.foreach((function (e) { var r = p[t], i = b[A], a = r * O - i * E, o = r * E + i * O, u = t + 1, s = A + 1, c = new Rt.Position(e.c.move(a, o)); n.savePos(s + "," + u, c), n.savePos(B + s + "," + u, c), t += 1 })), A += 1 })), r = new xt(ft.none, n); A = 0; c.rows.foreach((function (e) { var t = 0; e.entries.foreach((function (e) { var i = p[t], a = b[A], o = i * O - a * E, u = i * E + a * O, s = t + 1, c = A + 1, h = new ft.TranslateShape(o, u, e.objectShape); r.appendShapeToFront(h), n.c = e.c.move(o, u), n.xymatrixRow = c, n.xymatrixCol = s, e.decor.toShape(r), t += 1 })), A += 1 })); var j = r.shape; return e.appendShapeToFront(j), t.savedPosition = n.savedPosition, j } }); var It = function () { function e(t, n) { Ft(this, e), this.rows = t, this.columns = L.empty, this.orientation = n } return Vt(e, [{ key: "getColumn", value: function (t) { if (this.columns.length() >= t) return this.columns.at(t - 1); var n = new e.Column(this.orientation); return this.columns = this.columns.append(n), n } }, { key: "toString", value: function () { return "Xymatrix{\n" + this.rows.mkString("\\\\\n") + "\n}" } }]), e }(); function zt(e, t, n) { var r = [], i = [], a = { lastNoSuccess: void 0, whiteSpaceRegex: c.whiteSpaceRegex, createTextNode: function (t) { var n = new o.Z(t, e.stack.env, e.configuration).mml(), a = pe.textObjectIdCounter; return pe.textObjectIdCounter++, r.push(n), i.push(a), n } }, u = new Y(e.string, e.i, a), h = $.parse(t, u); if (e.i = h.next.offset, h.successful) { var l = "" + pe.xypicCommandIdCounter; pe.xypicCommandIdCounter++, pe.xypicCommandMap[l] = h.get(); var m = JSON.stringify(i); return e.create(n, { "data-cmd-id": l, "data-text-mml-ids": m }, r) } var p = a.lastNoSuccess.next.pos().lineContents(); throw s("SyntaxError", a.lastNoSuccess.msg + '. Parse error at or near "' + p + '".') } It.Row = function () { function e(t, n) { Ft(this, e), this.entries = t, this.orientation = n, Xe(this, "getU"), Xe(this, "getD") } return Vt(e, [{ key: "getU", value: function () { var e = this.orientation, t = 0; return this.entries.foreach((function (n) { t = Math.max(t, n.getU(e)) })), t } }, { key: "getD", value: function () { var e = this.orientation, t = 0; return this.entries.foreach((function (n) { t = Math.max(t, n.getD(e)) })), t } }, { key: "toString", value: function () { return this.entries.mkString(" & ") } }]), e }(), It.Column = function () { function e(t) { Ft(this, e), this.entries = L.empty, this.orientation = t, Xe(this, "getL"), Xe(this, "getR") } return Vt(e, [{ key: "addEntry", value: function (e) { this.entries = this.entries.append(e), this.getL.reset, this.getR.reset } }, { key: "getL", value: function () { var e = this.orientation, t = 0; return this.entries.foreach((function (n) { t = Math.max(t, n.getL(e)) })), t } }, { key: "getR", value: function () { var e = this.orientation, t = 0; return this.entries.foreach((function (n) { t = Math.max(t, n.getR(e)) })), t } }, { key: "toString", value: function () { return this.entries.mkString(" \\\\ ") } }]), e }(), It.Entry = function () { function e(t, n, r, i) { Ft(this, e), this.c = t, this.objectShape = n, this.decor = r, this.frame = i } return Vt(e, [{ key: "getDistanceToEdgePoint", value: function (e, t) { var n = e.edgePoint(e.x + Math.cos(t), e.y + Math.sin(t)), r = n.x - e.x, i = n.y - e.y; return Math.sqrt(r * r + i * i) } }, { key: "getU", value: function (e) { return 0 === e ? this.frame.u : this.getDistanceToEdgePoint(this.frame, e + Math.PI / 2) } }, { key: "getD", value: function (e) { return 0 === e ? this.frame.d : this.getDistanceToEdgePoint(this.frame, e - Math.PI / 2) } }, { key: "getL", value: function (e) { return 0 === e ? this.frame.l : this.getDistanceToEdgePoint(this.frame, e + Math.PI) } }, { key: "getR", value: function (e) { return 0 === e ? this.frame.r : this.getDistanceToEdgePoint(this.frame, e) } }, { key: "toString", value: function () { return this.objectShape.toString() + " " + this.decor } }]), e }(), _t(Ce.Command.Xymatrix.Setup.Prefix, { toShape: function (e) { e.env.xymatrixPrefix = this.prefix } }), _t(Ce.Command.Xymatrix.Setup.ChangeSpacing.Row, { toShape: function (e) { var t = e.env; t.xymatrixRowSepEm = this.addop.applyToDimen(t.xymatrixRowSepEm, pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.ChangeSpacing.Column, { toShape: function (e) { var t = e.env; t.xymatrixColSepEm = this.addop.applyToDimen(t.xymatrixColSepEm, pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.ChangeSpacing.RowAndColumn, { toShape: function (e) { var t = e.env, n = this.addop.applyToDimen(t.xymatrixRowSepEm, pe.measure.length2em(this.dimen)); t.xymatrixRowSepEm = n, t.xymatrixColSepEm = n } }), _t(Ce.Command.Xymatrix.Setup.PretendEntrySize.Height, { toShape: function (e) { e.env.xymatrixPretendEntryHeight = new g.Some(pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.PretendEntrySize.Width, { toShape: function (e) { e.env.xymatrixPretendEntryWidth = new g.Some(pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.PretendEntrySize.HeightAndWidth, { toShape: function (e) { var t = new g.Some(pe.measure.length2em(this.dimen)); e.env.xymatrixPretendEntryHeight = t, e.env.xymatrixPretendEntryWidth = t } }), _t(Ce.Command.Xymatrix.Setup.FixGrid.Row, { toShape: function (e) { e.env.xymatrixFixedRow = !0 } }), _t(Ce.Command.Xymatrix.Setup.FixGrid.Column, { toShape: function (e) { e.env.xymatrixFixedCol = !0 } }), _t(Ce.Command.Xymatrix.Setup.FixGrid.RowAndColumn, { toShape: function (e) { e.env.xymatrixFixedRow = !0, e.env.xymatrixFixedCol = !0 } }), _t(Ce.Command.Xymatrix.Setup.AdjustEntrySize.Margin, { toShape: function (e) { var t = e.env; t.objectmargin = this.addop.applyToDimen(t.objectmargin, pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.AdjustEntrySize.Width, { toShape: function (e) { var t = e.env; t.objectwidth = this.addop.applyToDimen(t.objectwidth, pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.AdjustEntrySize.Height, { toShape: function (e) { var t = e.env; t.objectheight = this.addop.applyToDimen(t.objectheight, pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.AdjustLabelSep, { toShape: function (e) { var t = e.env; t.labelmargin = this.addop.applyToDimen(t.labelmargin, pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Xymatrix.Setup.SetOrientation, { toShape: function (e) { e.env.xymatrixOrientationAngle = this.direction.angle(e) } }), _t(Ce.Command.Xymatrix.Setup.AddModifier, { toShape: function (e) { var t = e.env; t.xymatrixEntryModifiers = t.xymatrixEntryModifiers.prepend(this.modifier) } }), _t(Ce.Command.Xymatrix.Entry.SimpleEntry, { toShape: function (e) { var t = e.env, n = pe.measure.em2length(t.objectmargin + t.objectwidth), r = pe.measure.em2length(t.objectmargin + t.objectheight), i = new Ce.Modifier.AddOp(new Ce.Modifier.AddOp.GrowTo, new Ce.Modifier.AddOp.VactorSize(new Ce.Vector.Abs(n, r))), a = pe.measure.em2length(t.objectmargin), o = new Ce.Modifier.AddOp(new Ce.Modifier.AddOp.Grow, new Ce.Modifier.AddOp.VactorSize(new Ce.Vector.Abs(a, a))), u = this.modifiers.concat(t.xymatrixEntryModifiers).prepend(i).prepend(o); return new Ce.Object(u, this.objectbox).toDropShape(e) } }), _t(Ce.Command.Xymatrix.Entry.EmptyEntry, { toShape: function (e) { var t = e.env, n = pe.measure.em2length(t.objectmargin + t.objectwidth), r = pe.measure.em2length(t.objectmargin + t.objectheight), i = new Ce.Modifier.AddOp(new Ce.Modifier.AddOp.GrowTo, new Ce.Modifier.AddOp.VactorSize(new Ce.Vector.Abs(n, r))), a = pe.measure.em2length(t.objectmargin), o = new Ce.Modifier.AddOp(new Ce.Modifier.AddOp.Grow, new Ce.Modifier.AddOp.VactorSize(new Ce.Vector.Abs(a, a))), u = t.xymatrixEntryModifiers.prepend(i).prepend(o); return new Ce.Object(u, new Ce.ObjectBox.Empty).toDropShape(e) } }), _t(Ce.Command.Xymatrix.Entry.ObjectEntry, { toShape: function (e) { return this.object.toDropShape(e) } }), _t(Ce.Command.Twocell, { toShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = t.duplicate(), r = new xt(ft.none, n); n.twocellmodmapobject = t.twocellmodmapobject || new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "|")), n.twocellhead = t.twocellhead || new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", ">")), n.twocelltail = t.twocelltail || new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "")), n.twocellarrowobject = t.twocellarrowobject || new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "=>")), n.twocellUpperCurveObjectSpacer = t.twocellUpperCurveObjectSpacer, n.twocellUpperCurveObject = t.twocellUpperCurveObject, n.twocellLowerCurveObjectSpacer = t.twocellLowerCurveObjectSpacer, n.twocellLowerCurveObject = t.twocellLowerCurveObject, n.twocellUpperLabel = g.empty, n.twocellLowerLabel = g.empty, n.twocellCurvatureEm = g.empty, n.twocellShouldDrawCurve = !0, n.twocellShouldDrawModMap = !1, this.switches.foreach((function (e) { e.setup(r) })), this.twocell.toShape(r, this.arrow), e.appendShapeToFront(r.shape) } }), _t(Ce.Command.Twocell.Hops2cell, { toShape: function (e, t) { var n = e.env, r = n.c, i = n.angle, a = n.c, o = this.targetPosition(e); if (void 0 !== a && void 0 !== o) { var u = o.x - a.x, s = o.y - a.y; if (0 !== u || 0 !== s) { var c = new rt.Point(a.x + .5 * u, a.y + .5 * s), h = Math.atan2(s, u), l = h + Math.PI / 2, m = n.twocellCurvatureEm.getOrElse(this.getDefaultCurvature()), p = Math.cos(l), f = Math.sin(l), d = this.getUpperControlPoint(a, o, c, m, p, f), y = this.getLowerControlPoint(a, o, c, m, p, f); if (n.twocellShouldDrawCurve) { var v, x; if (x = void 0 === (v = n.twocellUpperCurveObjectSpacer) ? new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "-")) : void 0 !== n.twocellUpperCurveObject ? n.twocellUpperCurveObject.getOrElse(void 0) : void 0, this.toUpperCurveShape(e, a, d, o, v, x), n.lastCurve.isDefined) { n.angle = h; var g = this.getUpperLabelPosition(a, o, c, m, p, f), w = this.getUpperLabelAngle(l, a, o, c, m, p, f); n.twocellUpperLabel.foreach((function (t) { t.toShape(e, g, Math.cos(w), Math.sin(w), h) })), this.hasUpperTips && t.toUpperTipsShape(e) } if (x = void 0 === (v = n.twocellLowerCurveObjectSpacer) ? new Ce.Object(L.empty, new Ce.ObjectBox.Dir("", "-")) : void 0 !== n.twocellLowerCurveObject ? n.twocellLowerCurveObject.getOrElse(void 0) : void 0, this.toLowerCurveShape(e, a, y, o, v, x), n.lastCurve.isDefined) { n.angle = h; var S = this.getLowerLabelPosition(a, o, c, m, p, f), b = this.getLowerLabelAngle(l, a, o, c, m, p, f); n.twocellLowerLabel.foreach((function (t) { t.toShape(e, S, Math.cos(b), Math.sin(b), h) })), this.hasLowerTips && t.toLowerTipsShape(e) } } n.c = this.getDefaultArrowPoint(a, o, c, m, p, f), n.angle = l + Math.PI; var C = c; t.toArrowShape(e, C), n.c = r, n.angle = i } } }, _toCurveShape: function (e, t, n, r, i, a) { var o = e.env, u = new Et.QuadBezier(t, n, r), s = u.tOfShavedStart(t), c = u.tOfShavedEnd(r); if (void 0 === s || void 0 === c || s >= c) o.lastCurve = Lt.none; else { var h = u.toShape(e, i, a); o.lastCurve = new Lt.QuadBezier(u, s, c, h) } }, targetPosition: function (e) { var t = e.env, n = t.xymatrixRow, r = t.xymatrixCol; if (void 0 === n || void 0 === r) throw s("ExecutionError", "rows and columns not found for hops [" + this.hops + "]"); for (var i = 0; i < this.hops.length; i++)switch (this.hops[i]) { case "u": n -= 1; break; case "d": n += 1; break; case "l": r -= 1; break; case "r": r += 1 }var a = n + "," + r; return e.env.lookupPos(a, 'in entry "' + t.xymatrixRow + "," + t.xymatrixCol + '": No ' + this + " (is " + a + ") from here.").position(e) } }), _t(Ce.Command.Twocell.Twocell, { getUpperControlPoint: function (e, t, n, r, i, a) { return new rt.Point(n.x + r * i, n.y + r * a) }, getLowerControlPoint: function (e, t, n, r, i, a) { return new rt.Point(n.x - r * i, n.y - r * a) }, getUpperLabelPosition: function (e, t, n, r, i, a) { return new rt.Point(n.x + .5 * r * i, n.y + .5 * r * a) }, getLowerLabelPosition: function (e, t, n, r, i, a) { return new rt.Point(n.x - .5 * r * i, n.y - .5 * r * a) }, getUpperLabelAngle: function (e, t, n, r, i, a, o) { return e + (i < 0 ? Math.PI : 0) }, getLowerLabelAngle: function (e, t, n, r, i, a, o) { return e + (i < 0 ? 0 : Math.PI) }, getDefaultArrowPoint: function (e, t, n, r, i, a) { return n }, toUpperCurveShape: function (e, t, n, r, i, a) { this._toCurveShape(e, t, n, r, i, a) }, toLowerCurveShape: function (e, t, n, r, i, a) { this._toCurveShape(e, t, n, r, i, a) }, getDefaultCurvature: function () { return 3.5 * pe.measure.lineElementLength }, hasUpperTips: !0, hasLowerTips: !0 }), _t(Ce.Command.Twocell.UpperTwocell, { getUpperControlPoint: function (e, t, n, r, i, a) { return new rt.Point(n.x + r * i, n.y + r * a) }, getLowerControlPoint: function (e, t, n, r, i, a) { return n }, getUpperLabelPosition: function (e, t, n, r, i, a) { return new rt.Point(n.x + .5 * r * i, n.y + .5 * r * a) }, getLowerLabelPosition: function (e, t, n, r, i, a) { return n }, getUpperLabelAngle: function (e, t, n, r, i, a, o) { return e + (i < 0 ? Math.PI : 0) }, getLowerLabelAngle: function (e, t, n, r, i, a, o) { return e + (i < 0 ? 0 : Math.PI) }, getDefaultArrowPoint: function (e, t, n, r, i, a) { return new rt.Point(n.x + .25 * r * i, n.y + .25 * r * a) }, toUpperCurveShape: function (e, t, n, r, i, a) { this._toCurveShape(e, t, n, r, i, a) }, toLowerCurveShape: function (e, t, n, r, i, a) { var o = t.edgePoint(r.x, r.y), u = r.edgePoint(t.x, t.y); o.x !== u.x || o.y !== u.y ? e.env.lastCurve = new Lt.Line(o, u, t, r, void 0) : e.env.lastCurve = Lt.none }, getDefaultCurvature: function () { return 7 * pe.measure.lineElementLength }, hasUpperTips: !0, hasLowerTips: !1 }), _t(Ce.Command.Twocell.LowerTwocell, { getUpperControlPoint: function (e, t, n, r, i, a) { return n }, getLowerControlPoint: function (e, t, n, r, i, a) { return new rt.Point(n.x + r * i, n.y + r * a) }, getUpperLabelPosition: function (e, t, n, r, i, a) { return n }, getLowerLabelPosition: function (e, t, n, r, i, a) { return new rt.Point(n.x + .5 * r * i, n.y + .5 * r * a) }, getUpperLabelAngle: function (e, t, n, r, i, a, o) { return e + (i < 0 ? 0 : Math.PI) }, getLowerLabelAngle: function (e, t, n, r, i, a, o) { return e + (i < 0 ? Math.PI : 0) }, getDefaultArrowPoint: function (e, t, n, r, i, a) { return new rt.Point(n.x + .25 * r * i, n.y + .25 * r * a) }, toUpperCurveShape: function (e, t, n, r, i, a) { var o = t.edgePoint(r.x, r.y), u = r.edgePoint(t.x, t.y); o.x !== u.x || o.y !== u.y ? e.env.lastCurve = new Lt.Line(o, u, t, r, void 0) : e.env.lastCurve = Lt.none }, toLowerCurveShape: function (e, t, n, r, i, a) { this._toCurveShape(e, t, n, r, i, a) }, getDefaultCurvature: function () { return -7 * pe.measure.lineElementLength }, hasUpperTips: !1, hasLowerTips: !0 }), _t(Ce.Command.Twocell.CompositeMap, { getUpperControlPoint: function (e, t, n, r, i, a) { var o = this.getMidBoxSize(); return new rt.Ellipse(n.x + r * i, n.y + r * a, o, o, o, o) }, getLowerControlPoint: function (e, t, n, r, i, a) { var o = this.getMidBoxSize(); return new rt.Ellipse(n.x + r * i, n.y + r * a, o, o, o, o) }, getUpperLabelPosition: function (e, t, n, r, i, a) { var o = n.x + r * i - t.x, u = n.y + r * a - t.y; Math.sqrt(o * o + u * u); return new rt.Point(t.x + .5 * o, t.y + .5 * u) }, getLowerLabelPosition: function (e, t, n, r, i, a) { var o = n.x + r * i - e.x, u = n.y + r * a - e.y; Math.sqrt(o * o + u * u); return new rt.Point(e.x + .5 * o, e.y + .5 * u) }, getUpperLabelAngle: function (e, t, n, r, i, a, o) { var u = n.x - r.x + i * a, s = n.y - r.y + i * o, c = Math.atan2(s, u), h = i < 0 ? Math.PI : 0; return c + Math.PI / 2 + h }, getLowerLabelAngle: function (e, t, n, r, i, a, o) { var u = r.x + i * a - t.x, s = r.y + i * o - t.y, c = Math.atan2(s, u), h = i < 0 ? Math.PI : 0; return c + Math.PI / 2 + h }, getDefaultArrowPoint: function (e, t, n, r, i, a) { return n }, toUpperCurveShape: function (e, t, n, r, i, a) { var o = e.env, u = t, s = n, c = u.edgePoint(s.x, s.y), h = s.edgePoint(u.x, u.y), l = o.p, m = o.c; o.p = u, o.c = s, new Et.Line(c, h).toShape(e, void 0, "-", ""), o.p = l, o.c = m }, toLowerCurveShape: function (e, t, n, r, i, a) { var o = e.env, u = n, s = r, c = u.edgePoint(s.x, s.y), h = s.edgePoint(u.x, u.y), l = o.p, m = o.c; o.p = u, o.c = s, new Et.Line(c, h).toShape(e, void 0, "-", ""), o.p = l, o.c = m }, getMidBoxSize: function () { return .5 * pe.measure.lineElementLength }, getDefaultCurvature: function () { return 3.5 * pe.measure.lineElementLength }, hasUpperTips: !0, hasLowerTips: !0 }), _t(Ce.Command.Twocell.Switch.UpperLabel, { setup: function (e) { e.env.twocellUpperLabel = new g.Some(this) }, toShape: function (e, t, n, r, i) { this.label.toShape(e, t, n, r, i) } }), _t(Ce.Command.Twocell.Switch.LowerLabel, { setup: function (e) { e.env.twocellLowerLabel = new g.Some(this) }, toShape: function (e, t, n, r, i) { this.label.toShape(e, t, n, r, i) } }), _t(Ce.Command.Twocell.Switch.SetCurvature, { setup: function (e) { var t = e.env; this.nudge.isOmit ? t.twocellShouldDrawCurve = !1 : t.twocellCurvatureEm = new g.Some(this.nudge.number * pe.measure.lineElementLength) } }), _t(Ce.Command.Twocell.Switch.DoNotSetCurvedArrows, { setup: function (e) { e.env.twocellShouldDrawCurve = !1 } }), _t(Ce.Command.Twocell.Switch.PlaceModMapObject, { setup: function (e) { e.env.twocellShouldDrawModMap = !0 } }), _t(Ce.Command.Twocell.Switch.ChangeHeadTailObject, { setup: function (e) { var t = e.env; switch (this.what) { case "`": t.twocelltail = this.object; break; case "'": t.twocellhead = this.object } } }), _t(Ce.Command.Twocell.Switch.ChangeCurveObject, { setup: function (e) { var t = e.env; switch (this.what) { case "": t.twocellUpperCurveObjectSpacer = this.spacer, t.twocellUpperCurveObject = this.maybeObject, t.twocellLowerCurveObjectSpacer = this.spacer, t.twocellLowerCurveObject = this.maybeObject; break; case "^": t.twocellUpperCurveObjectSpacer = this.spacer, t.twocellUpperCurveObject = this.maybeObject; break; case "_": t.twocellLowerCurveObjectSpacer = this.spacer, t.twocellLowerCurveObject = this.maybeObject } } }), _t(Ce.Command.Twocell.Label, { toShape: function (e, t, n, r, i) { var a, o = this.maybeNudge; if (o.isDefined) { var u = o.get; if (u.isOmit) return; a = u.number * pe.measure.lineElementLength } else a = this.getDefaultLabelOffset(); var s = e.env, c = s.c; s.c = new rt.Point(t.x + a * n, t.y + a * r), this.labelObject.toDropShape(e), s.c = c }, getDefaultLabelOffset: function () { return pe.measure.lineElementLength } }), _t(Ce.Command.Twocell.Nudge.Number, { isOmit: !1 }), _t(Ce.Command.Twocell.Nudge.Omit, { isOmit: !0 }), _t(Ce.Command.Twocell.Arrow, { toTipsShape: function (e, t, n) { var r = e.env, i = r.lastCurve, a = r.c, o = r.angle, u = t ? Math.PI : 0, s = i.tOfPlace(!0, !0, t ? 0 : 1, 0); r.c = i.position(s), r.angle = i.angle(s) + u, r.twocellhead.toDropShape(e); s = i.tOfPlace(!0, !0, t ? 1 : 0, 0); if (r.c = i.position(s), r.angle = i.angle(s) + u, n ? r.twocellhead.toDropShape(e) : r.twocelltail.toDropShape(e), r.twocellShouldDrawModMap) { s = i.tOfPlace(!1, !1, .5, 0); r.c = i.position(s), r.angle = i.angle(s) + u, r.twocellmodmapobject.toDropShape(e) } r.c = a, r.angle = o } }), _t(Ce.Command.Twocell.Arrow.WithOrientation, { toUpperTipsShape: function (e) { switch (this.tok) { case "": case "^": case "_": case "=": case "\\omit": case "'": this.toTipsShape(e, !1, !1); break; case "`": this.toTipsShape(e, !0, !1); break; case '"': this.toTipsShape(e, !1, !0) } }, toLowerTipsShape: function (e) { switch (this.tok) { case "": case "^": case "_": case "=": case "\\omit": case "`": this.toTipsShape(e, !1, !1); break; case "'": this.toTipsShape(e, !0, !1); break; case '"': this.toTipsShape(e, !1, !0) } }, toArrowShape: function (e, t) { var n = e.env, r = n.c; switch (this.tok) { case "^": var i = n.angle; n.angle = i + Math.PI, n.twocellarrowobject.toDropShape(e), n.c = new rt.Point(r.x + pe.measure.lineElementLength * Math.cos(i - Math.PI / 2), r.y + pe.measure.lineElementLength * Math.sin(i - Math.PI / 2)), this.labelObject.toDropShape(e), n.angle = i; break; case "": case "_": i = n.angle; n.twocellarrowobject.toDropShape(e), n.c = new rt.Point(r.x + pe.measure.lineElementLength * Math.cos(i + Math.PI / 2), r.y + pe.measure.lineElementLength * Math.sin(i + Math.PI / 2)), this.labelObject.toDropShape(e); break; case "=": i = n.angle; var a = new ft.TwocellEqualityArrowheadShape(n.c, n.angle); e.appendShapeToFront(a), n.c = new rt.Point(r.x + pe.measure.lineElementLength * Math.cos(i + Math.PI / 2), r.y + pe.measure.lineElementLength * Math.sin(i + Math.PI / 2)), this.labelObject.toDropShape(e); break; default: this.labelObject.toDropShape(e) }n.c = r } }), _t(Ce.Command.Twocell.Arrow.WithPosition, { toUpperTipsShape: function (e) { this.toTipsShape(e, !1, !1) }, toLowerTipsShape: function (e) { this.toTipsShape(e, !1, !1) }, toArrowShape: function (e, t) { var n, r = e.env, i = r.c, a = r.angle, o = this.nudge; if (o.isOmit) n = i; else { var u = o.number * pe.measure.lineElementLength; n = new rt.Point(t.x + u * Math.cos(a), t.y + u * Math.sin(a)) } r.c = n, r.twocellarrowobject.toDropShape(e), o.isOmit || (r.c = new rt.Point(n.x + pe.measure.lineElementLength * Math.cos(a + Math.PI / 2), n.y + pe.measure.lineElementLength * Math.sin(a + Math.PI / 2)), this.labelObject.toDropShape(e)), r.c = i } }), _t(Ce.Pos.Xyimport.TeXCommand, { toShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = t.duplicate(), r = new xt(ft.none, n), i = this.graphics.toDropShape(r), a = this.width, o = this.height; if (0 === a || 0 === o) throw s("ExecutionError", "the 'width' and 'height' attributes of the \\xyimport should be non-zero."); var u = n.c, c = u.l + u.r, h = u.u + u.d; if (0 === c || 0 === h) throw s("ExecutionError", "the width and height of the graphics to import should be non-zero."); var l = this.xOffset, m = this.yOffset; t.c = u.toRect({ u: h / o * (o - m), d: h / o * m, l: c / a * l, r: c / a * (a - l) }), t.setXBase(c / a, 0), t.setYBase(0, h / o); var p = u.l - t.c.l, f = u.d - t.c.d; i = new ft.TranslateShape(p, f, r.shape); e.appendShapeToFront(i) } }), _t(Ce.Pos.Xyimport.Graphics, { toShape: function (e) { var t = e.env; if (void 0 === t.c) return ft.none; var n = t.duplicate(), r = new xt(ft.none, n), i = this.width, a = this.height; if (0 === i || 0 === a) throw s("ExecutionError", "the 'width' and 'height' attributes of the \\xyimport should be non-zero."); var o = this.graphics; if (o.setup(r), !n.includegraphicsWidth.isDefined || !n.includegraphicsHeight.isDefined) throw s("ExecutionError", "the 'width' and 'height' attributes of the \\includegraphics are required."); var u = n.includegraphicsWidth.get, c = n.includegraphicsHeight.get; if (0 === u || 0 === c) throw s("ExecutionError", "the 'width' and 'height' attributes of the \\includegraphics should be non-zero."); var h = this.xOffset, l = this.yOffset; t.c = n.c.toRect({ u: c / a * (a - l), d: c / a * l, l: u / i * h, r: u / i * (i - h) }), t.setXBase(u / i, 0), t.setYBase(0, c / a); var m = new ft.ImageShape(t.c, o.filepath); e.appendShapeToFront(m) } }), _t(Ce.Command.Includegraphics, { setup: function (e) { var t = e.env; t.includegraphicsWidth = g.empty, t.includegraphicsHeight = g.empty, this.attributeList.foreach((function (t) { t.setup(e) })) } }), _t(Ce.Command.Includegraphics.Attr.Width, { setup: function (e) { e.env.includegraphicsWidth = new g.Some(pe.measure.length2em(this.dimen)) } }), _t(Ce.Command.Includegraphics.Attr.Height, { setup: function (e) { e.env.includegraphicsHeight = new g.Some(pe.measure.length2em(this.dimen)) } }); var Qt = {}; Qt.Macro = i.Z.Macro, Qt.xybox = function (e, t, n) { var r = zt(e, Qe.xybox(), Ce.xypic.prototype.kind); e.Push(r) }, Qt.xymatrixbox = function (e, t, n) { var r = zt(e, Qe.xymatrixbox(), Ce.xypic.prototype.kind); e.Push(r) }, Qt.newdir = function (e, t, n) { var r = zt(e, Qe.newdir(), Ce.xypic.newdir.prototype.kind); e.Push(r) }, Qt.xyincludegraphics = function (e, t, n) { var r = zt(e, Qe.includegraphics(), Ce.xypic.includegraphics.prototype.kind); e.Push(r) }, Qt.xyEnvironment = function (e, t) { var n = zt(e, Qe.xy(), Ce.xypic.prototype.kind); return e.Push(t), n }; new r.QQ("xypic-command", { hole: ["Macro", "{\\style{visibility:hidden}{x}}"], objectstyle: ["Macro", "\\textstyle"], labelstyle: ["Macro", "\\scriptstyle"], twocellstyle: ["Macro", "\\scriptstyle"], xybox: ["xybox", "xybox"], xymatrix: ["xymatrixbox", "xymatrix"], newdir: ["newdir", "newdir"], includegraphics: ["xyincludegraphics", "includegraphics"] }, Qt), new r.QM("xypic-environment", a.Z.environment, { xy: ["xyEnvironment", null, !1] }, Qt); t.VK.create("xypic", { handler: { macro: ["xypic-command"], environment: ["xypic-environment"] }, preprocessors: [function (e) { e.math, e.document, e.data; pe.xypicCommandIdCounter = 0, pe.xypicCommandMap = {}, pe.textObjectIdCounter = 0, pe.wrapperOfTextObjectMap = {} }], nodes: { xypic: function (e, t, n) { var r = e.mmlFactory; return new Ce.xypic(r, t, n) }, "xypic-newdir": function (e, t, n) { var r = e.mmlFactory; return new Ce.xypic.newdir(r, t, n) }, "xypic-includegraphics": function (e, t, n) { var r = e.mmlFactory; return new Ce.xypic.includegraphics(r, t, n) } } }); me.embeddedModifierMap = { o: new Ce.Modifier.Shape.Circle, l: new Ce.Modifier.Shape.L, r: new Ce.Modifier.Shape.R, u: new Ce.Modifier.Shape.U, d: new Ce.Modifier.Shape.D, c: new Ce.Modifier.Shape.C, aliceblue: new Ce.Modifier.Shape.ChangeColor("aliceblue"), antiquewhite: new Ce.Modifier.Shape.ChangeColor("antiquewhite"), aqua: new Ce.Modifier.Shape.ChangeColor("aqua"), aquamarine: new Ce.Modifier.Shape.ChangeColor("aquamarine"), azure: new Ce.Modifier.Shape.ChangeColor("azure"), beige: new Ce.Modifier.Shape.ChangeColor("beige"), bisque: new Ce.Modifier.Shape.ChangeColor("bisque"), black: new Ce.Modifier.Shape.ChangeColor("black"), blanchedalmond: new Ce.Modifier.Shape.ChangeColor("blanchedalmond"), blue: new Ce.Modifier.Shape.ChangeColor("blue"), blueviolet: new Ce.Modifier.Shape.ChangeColor("blueviolet"), brown: new Ce.Modifier.Shape.ChangeColor("brown"), burlywood: new Ce.Modifier.Shape.ChangeColor("burlywood"), cadetblue: new Ce.Modifier.Shape.ChangeColor("cadetblue"), chartreuse: new Ce.Modifier.Shape.ChangeColor("chartreuse"), chocolate: new Ce.Modifier.Shape.ChangeColor("chocolate"), coral: new Ce.Modifier.Shape.ChangeColor("coral"), cornflowerblue: new Ce.Modifier.Shape.ChangeColor("cornflowerblue"), cornsilk: new Ce.Modifier.Shape.ChangeColor("cornsilk"), crimson: new Ce.Modifier.Shape.ChangeColor("crimson"), cyan: new Ce.Modifier.Shape.ChangeColor("cyan"), darkblue: new Ce.Modifier.Shape.ChangeColor("darkblue"), darkcyan: new Ce.Modifier.Shape.ChangeColor("darkcyan"), darkgoldenrod: new Ce.Modifier.Shape.ChangeColor("darkgoldenrod"), darkgray: new Ce.Modifier.Shape.ChangeColor("darkgray"), darkgreen: new Ce.Modifier.Shape.ChangeColor("darkgreen"), darkgrey: new Ce.Modifier.Shape.ChangeColor("darkgrey"), darkkhaki: new Ce.Modifier.Shape.ChangeColor("darkkhaki"), darkmagenta: new Ce.Modifier.Shape.ChangeColor("darkmagenta"), darkolivegreen: new Ce.Modifier.Shape.ChangeColor("darkolivegreen"), darkorange: new Ce.Modifier.Shape.ChangeColor("darkorange"), darkorchid: new Ce.Modifier.Shape.ChangeColor("darkorchid"), darkred: new Ce.Modifier.Shape.ChangeColor("darkred"), darksalmon: new Ce.Modifier.Shape.ChangeColor("darksalmon"), darkseagreen: new Ce.Modifier.Shape.ChangeColor("darkseagreen"), darkslateblue: new Ce.Modifier.Shape.ChangeColor("darkslateblue"), darkslategray: new Ce.Modifier.Shape.ChangeColor("darkslategray"), darkslategrey: new Ce.Modifier.Shape.ChangeColor("darkslategrey"), darkturquoise: new Ce.Modifier.Shape.ChangeColor("darkturquoise"), darkviolet: new Ce.Modifier.Shape.ChangeColor("darkviolet"), deeppink: new Ce.Modifier.Shape.ChangeColor("deeppink"), deepskyblue: new Ce.Modifier.Shape.ChangeColor("deepskyblue"), dimgray: new Ce.Modifier.Shape.ChangeColor("dimgray"), dimgrey: new Ce.Modifier.Shape.ChangeColor("dimgrey"), dodgerblue: new Ce.Modifier.Shape.ChangeColor("dodgerblue"), firebrick: new Ce.Modifier.Shape.ChangeColor("firebrick"), floralwhite: new Ce.Modifier.Shape.ChangeColor("floralwhite"), forestgreen: new Ce.Modifier.Shape.ChangeColor("forestgreen"), fuchsia: new Ce.Modifier.Shape.ChangeColor("fuchsia"), gainsboro: new Ce.Modifier.Shape.ChangeColor("gainsboro"), ghostwhite: new Ce.Modifier.Shape.ChangeColor("ghostwhite"), gold: new Ce.Modifier.Shape.ChangeColor("gold"), goldenrod: new Ce.Modifier.Shape.ChangeColor("goldenrod"), gray: new Ce.Modifier.Shape.ChangeColor("gray"), grey: new Ce.Modifier.Shape.ChangeColor("grey"), green: new Ce.Modifier.Shape.ChangeColor("green"), greenyellow: new Ce.Modifier.Shape.ChangeColor("greenyellow"), honeydew: new Ce.Modifier.Shape.ChangeColor("honeydew"), hotpink: new Ce.Modifier.Shape.ChangeColor("hotpink"), indianred: new Ce.Modifier.Shape.ChangeColor("indianred"), indigo: new Ce.Modifier.Shape.ChangeColor("indigo"), ivory: new Ce.Modifier.Shape.ChangeColor("ivory"), khaki: new Ce.Modifier.Shape.ChangeColor("khaki"), lavender: new Ce.Modifier.Shape.ChangeColor("lavender"), lavenderblush: new Ce.Modifier.Shape.ChangeColor("lavenderblush"), lawngreen: new Ce.Modifier.Shape.ChangeColor("lawngreen"), lemonchiffon: new Ce.Modifier.Shape.ChangeColor("lemonchiffon"), lightblue: new Ce.Modifier.Shape.ChangeColor("lightblue"), lightcoral: new Ce.Modifier.Shape.ChangeColor("lightcoral"), lightcyan: new Ce.Modifier.Shape.ChangeColor("lightcyan"), lightgoldenrodyellow: new Ce.Modifier.Shape.ChangeColor("lightgoldenrodyellow"), lightgray: new Ce.Modifier.Shape.ChangeColor("lightgray"), lightgreen: new Ce.Modifier.Shape.ChangeColor("lightgreen"), lightgrey: new Ce.Modifier.Shape.ChangeColor("lightgrey"), lightpink: new Ce.Modifier.Shape.ChangeColor("lightpink"), lightsalmon: new Ce.Modifier.Shape.ChangeColor("lightsalmon"), lightseagreen: new Ce.Modifier.Shape.ChangeColor("lightseagreen"), lightskyblue: new Ce.Modifier.Shape.ChangeColor("lightskyblue"), lightslategray: new Ce.Modifier.Shape.ChangeColor("lightslategray"), lightslategrey: new Ce.Modifier.Shape.ChangeColor("lightslategrey"), lightsteelblue: new Ce.Modifier.Shape.ChangeColor("lightsteelblue"), lightyellow: new Ce.Modifier.Shape.ChangeColor("lightyellow"), lime: new Ce.Modifier.Shape.ChangeColor("lime"), limegreen: new Ce.Modifier.Shape.ChangeColor("limegreen"), linen: new Ce.Modifier.Shape.ChangeColor("linen"), magenta: new Ce.Modifier.Shape.ChangeColor("magenta"), maroon: new Ce.Modifier.Shape.ChangeColor("maroon"), mediumaquamarine: new Ce.Modifier.Shape.ChangeColor("mediumaquamarine"), mediumblue: new Ce.Modifier.Shape.ChangeColor("mediumblue"), mediumorchid: new Ce.Modifier.Shape.ChangeColor("mediumorchid"), mediumpurple: new Ce.Modifier.Shape.ChangeColor("mediumpurple"), mediumseagreen: new Ce.Modifier.Shape.ChangeColor("mediumseagreen"), mediumslateblue: new Ce.Modifier.Shape.ChangeColor("mediumslateblue"), mediumspringgreen: new Ce.Modifier.Shape.ChangeColor("mediumspringgreen"), mediumturquoise: new Ce.Modifier.Shape.ChangeColor("mediumturquoise"), mediumvioletred: new Ce.Modifier.Shape.ChangeColor("mediumvioletred"), midnightblue: new Ce.Modifier.Shape.ChangeColor("midnightblue"), mintcream: new Ce.Modifier.Shape.ChangeColor("mintcream"), mistyrose: new Ce.Modifier.Shape.ChangeColor("mistyrose"), moccasin: new Ce.Modifier.Shape.ChangeColor("moccasin"), navajowhite: new Ce.Modifier.Shape.ChangeColor("navajowhite"), navy: new Ce.Modifier.Shape.ChangeColor("navy"), oldlace: new Ce.Modifier.Shape.ChangeColor("oldlace"), olive: new Ce.Modifier.Shape.ChangeColor("olive"), olivedrab: new Ce.Modifier.Shape.ChangeColor("olivedrab"), orange: new Ce.Modifier.Shape.ChangeColor("orange"), orangered: new Ce.Modifier.Shape.ChangeColor("orangered"), orchid: new Ce.Modifier.Shape.ChangeColor("orchid"), palegoldenrod: new Ce.Modifier.Shape.ChangeColor("palegoldenrod"), palegreen: new Ce.Modifier.Shape.ChangeColor("palegreen"), paleturquoise: new Ce.Modifier.Shape.ChangeColor("paleturquoise"), palevioletred: new Ce.Modifier.Shape.ChangeColor("palevioletred"), papayawhip: new Ce.Modifier.Shape.ChangeColor("papayawhip"), peachpuff: new Ce.Modifier.Shape.ChangeColor("peachpuff"), peru: new Ce.Modifier.Shape.ChangeColor("peru"), pink: new Ce.Modifier.Shape.ChangeColor("pink"), plum: new Ce.Modifier.Shape.ChangeColor("plum"), powderblue: new Ce.Modifier.Shape.ChangeColor("powderblue"), purple: new Ce.Modifier.Shape.ChangeColor("purple"), red: new Ce.Modifier.Shape.ChangeColor("red"), rosybrown: new Ce.Modifier.Shape.ChangeColor("rosybrown"), royalblue: new Ce.Modifier.Shape.ChangeColor("royalblue"), saddlebrown: new Ce.Modifier.Shape.ChangeColor("saddlebrown"), salmon: new Ce.Modifier.Shape.ChangeColor("salmon"), sandybrown: new Ce.Modifier.Shape.ChangeColor("sandybrown"), seagreen: new Ce.Modifier.Shape.ChangeColor("seagreen"), seashell: new Ce.Modifier.Shape.ChangeColor("seashell"), sienna: new Ce.Modifier.Shape.ChangeColor("sienna"), silver: new Ce.Modifier.Shape.ChangeColor("silver"), skyblue: new Ce.Modifier.Shape.ChangeColor("skyblue"), slateblue: new Ce.Modifier.Shape.ChangeColor("slateblue"), slategray: new Ce.Modifier.Shape.ChangeColor("slategray"), slategrey: new Ce.Modifier.Shape.ChangeColor("slategrey"), snow: new Ce.Modifier.Shape.ChangeColor("snow"), springgreen: new Ce.Modifier.Shape.ChangeColor("springgreen"), steelblue: new Ce.Modifier.Shape.ChangeColor("steelblue"), tan: new Ce.Modifier.Shape.ChangeColor("tan"), teal: new Ce.Modifier.Shape.ChangeColor("teal"), thistle: new Ce.Modifier.Shape.ChangeColor("thistle"), tomato: new Ce.Modifier.Shape.ChangeColor("tomato"), turquoise: new Ce.Modifier.Shape.ChangeColor("turquoise"), violet: new Ce.Modifier.Shape.ChangeColor("violet"), wheat: new Ce.Modifier.Shape.ChangeColor("wheat"), white: new Ce.Modifier.Shape.ChangeColor("white"), whitesmoke: new Ce.Modifier.Shape.ChangeColor("whitesmoke"), yellow: new Ce.Modifier.Shape.ChangeColor("yellow"), yellowgreen: new Ce.Modifier.Shape.ChangeColor("yellowgreen") }; var Wt = n(81), Nt = n(748), Ut = n(226); function Xt(e) { return Xt = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, Xt(e) } function Ht(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && qt(e, t) } function qt(e, t) { return qt = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, qt(e, t) } function Jt(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = $t(e); if (t) { var i = $t(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return Zt(this, n) } } function Zt(e, t) { if (t && ("object" === Xt(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return Yt(e) } function Yt(e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e } function $t(e) { return $t = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, $t(e) } function Kt(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function en(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function tn(e, t, n) { return t && en(e.prototype, t), n && en(e, n), e } var nn = He, rn = function () { function e() { Kt(this, e) } return tn(e, null, [{ key: "createSVG", value: function (e, t, n, r, i, a, o) { return new on(e, t, n, r, i, a, o) } }]), e }(), an = function () { function e(t) { Kt(this, e), this.xypicWrapper = t } return tn(e, [{ key: "createElement", value: function (e) { return this.xypicWrapper.svg(e) } }, { key: "createGroup", value: function (e) { return new hn(this, e) } }, { key: "createChangeColorGroup", value: function (e) { return new ln(this, e) } }, { key: "createSVGElement", value: function (e, t) { var n = this.createElement(e); if (t) for (var r in t) if (t.hasOwnProperty(r)) { var i = t[r].toString(); "xlink:href" === r ? this.xypicWrapper.setAttribute(n, r, i, "http://www.w3.org/1999/xlink") : this.xypicWrapper.setAttribute(n, r, i) } return this.appendChild(n), n } }, { key: "appendChild", value: function (e) { return this.xypicWrapper.adaptor.append(this.drawArea, e), e } }, { key: "transformBuilder", value: function () { return new un } }]), e }(), on = function (e) { Ht(n, e); var t = Jt(n); function n(e, r, i, a, o, u, s) { var c; Kt(this, n); var h = (c = t.call(this, e)).createElement("svg"); if (c.xypicWrapper.setAttribute(h, "xmlns", "http://www.w3.org/2000/svg"), c.xypicWrapper.setAttribute(h, "version", "1.1"), s) for (var l in s) s.hasOwnProperty(l) && c.xypicWrapper.setAttribute(h, l, s[l].toString()); h.style && (h.style.width = pe.measure.Em(a), h.style.height = pe.measure.Em(r + i)); s = { fill: "none", stroke: u, "stroke-linecap": "round", "stroke-width": pe.measure.em2px(o) }; for (var m in c.drawArea = c.createElement("g"), s) s.hasOwnProperty(m) && c.xypicWrapper.setAttribute(c.drawArea, m, s[m].toString()); return c.xypicWrapper.append(h, c.drawArea), c.svg = h, c.boundingBox = void 0, c.color = u, c } return tn(n, [{ key: "setHeight", value: function (e) { this.xypicWrapper.setStyle(this.svg, "height", pe.measure.Em(e)) } }, { key: "setWidth", value: function (e) { this.xypicWrapper.setStyle(this.svg, "width", pe.measure.Em(e)) } }, { key: "setAttribute", value: function (e, t) { this.xypicWrapper.setAttribute(this.svg, e, t.toString()) } }, { key: "extendBoundingBox", value: function (e) { this.boundingBox = rt.combineRect(this.boundingBox, e) } }, { key: "getOrigin", value: function () { return { x: 0, y: 0 } } }, { key: "getCurrentColor", value: function () { return this.color } }]), n }(an), un = function () { function e(t) { Kt(this, e), this.transform = t || L.empty } return tn(e, [{ key: "translate", value: function (t, n) { return new e(this.transform.append(new sn(t, n))) } }, { key: "rotateDegree", value: function (t) { return new e(this.transform.append(new cn(t / 180 * Math.PI))) } }, { key: "rotateRadian", value: function (t) { return new e(this.transform.append(new cn(t))) } }, { key: "toString", value: function () { var e = ""; return this.transform.foreach((function (t) { e += t.toTranslateForm() })), e } }, { key: "apply", value: function (e, t) { var n = { x: e, y: t }; return this.transform.foreach((function (e) { n = e.apply(n.x, n.y) })), n } }]), e }(), sn = function () { function e(t, n) { Kt(this, e), this.dx = t, this.dy = n } return tn(e, [{ key: "apply", value: function (e, t) { return { x: e - this.dx, y: t + this.dy } } }, { key: "toTranslateForm", value: function () { return "translate(" + pe.measure.em2px(this.dx) + "," + pe.measure.em2px(-this.dy) + ") " } }]), e }(), cn = function () { function e(t) { Kt(this, e), this.radian = t } return tn(e, [{ key: "apply", value: function (e, t) { var n = Math.cos(this.radian), r = Math.sin(this.radian); return { x: n * e + r * t, y: -r * e + n * t } } }, { key: "toTranslateForm", value: function () { return "rotate(" + nn(-180 * this.radian / Math.PI) + ") " } }]), e }(), hn = function (e) { Ht(n, e); var t = Jt(n); function n(e, r) { var i; Kt(this, n), (i = t.call(this, e.xypicWrapper)).parent = e, i.drawArea = e.createSVGElement("g", void 0 === r ? {} : { transform: r.toString() }); var a = e.getOrigin(); return i.origin = void 0 === r ? a : r.apply(a.x, a.y), Xe(Yt(i), "getCurrentColor"), i } return tn(n, [{ key: "remove", value: function () { this.xypicWrapper.remove(this.drawArea) } }, { key: "extendBoundingBox", value: function (e) { this.parent.extendBoundingBox(e) } }, { key: "getOrigin", value: function () { return this.origin } }, { key: "getCurrentColor", value: function () { return this.parent.getCurrentColor() } }]), n }(an), ln = function (e) { Ht(n, e); var t = Jt(n); function n(e, r) { var i; return Kt(this, n), (i = t.call(this, e.xypicWrapper)).parent = e, i.drawArea = e.createSVGElement("g", { stroke: r }), i.color = r, Xe(Yt(i), "getOrigin"), i } return tn(n, [{ key: "remove", value: function () { this.xypicWrapper.remove(this.drawArea) } }, { key: "extendBoundingBox", value: function (e) { this.parent.extendBoundingBox(e) } }, { key: "getOrigin", value: function () { return this.parent.getOrigin() } }, { key: "getCurrentColor", value: function () { return this.color } }]), n }(an); function mn(e) { return mn = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, mn(e) } function pn(e, t) { var n = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"]; if (!n) { if (Array.isArray(e) || (n = function (e, t) { if (!e) return; if ("string" == typeof e) return fn(e, t); var n = Object.prototype.toString.call(e).slice(8, -1); "Object" === n && e.constructor && (n = e.constructor.name); if ("Map" === n || "Set" === n) return Array.from(e); if ("Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return fn(e, t) }(e)) || t && e && "number" == typeof e.length) { n && (e = n); var r = 0, i = function () { }; return { s: i, n: function () { return r >= e.length ? { done: !0 } : { done: !1, value: e[r++] } }, e: function (e) { throw e }, f: i } } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") } var a, o = !0, u = !1; return { s: function () { n = n.call(e) }, n: function () { var e = n.next(); return o = e.done, e }, e: function (e) { u = !0, a = e }, f: function () { try { o || null == n.return || n.return() } finally { if (u) throw a } } } } function fn(e, t) { (null == t || t > e.length) && (t = e.length); for (var n = 0, r = new Array(t); n < t; n++)r[n] = e[n]; return r } function dn(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function yn(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function vn(e, t, n) { return t && yn(e.prototype, t), n && yn(e, n), e } function xn(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && gn(e, t) } function gn(e, t) { return gn = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, gn(e, t) } function wn(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = bn(e); if (t) { var i = bn(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return Sn(this, n) } } function Sn(e, t) { if (t && ("object" === mn(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function bn(e) { return bn = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, bn(e) } var Cn = "http://www.w3.org/2000/svg", kn = He; function Mn(e, t) { var n = function (e) { xn(n, e); var t = wn(n); function n(e, r) { var i, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; dn(this, n), i = t.call(this, e, r, a); for (var o = pe.wrapperOfTextObjectMap, u = r.textMmls, s = i.childNodes, c = u.length, h = 0; h < c; h++) { var l = u[h].xypicTextObjectId; o[l] = s[h] } return i._textObjects = [], i } return vn(n, [{ key: "getElement", value: function () { return this.chtml } }, { key: "appendTextObject", value: function (e) { this._textObjects.push(e) } }, { key: "getChildWrapper", value: function (e) { var t = e.xypicTextObjectId; if (null == t) throw s("IllegalStateError", "BUG"); var n = pe.wrapperOfTextObjectMap[t]; if (null == n) throw s("IllegalStateError", "unknown textObjectId:" + t); return n } }, { key: "toCHTML", value: function (e) { var t = pe.svgForDebug, n = pe.svgForTestLayout; this._textObjects = [], this.setupMeasure(this), this._toCHTML(e), pe.svgForDebug = t, pe.svgForTestLayout = n } }, { key: "setupMeasure", value: function (e) { var t = He, n = e.length2em("1em"), r = parseFloat(e.px(100).replace("px", "")) / 100, i = e.font.params.axis_height, a = e.length2em("0.15em"), o = function (t) { return Math.round(parseFloat(e.px(100 * t).replace("px", ""))) / 100 }; pe.measure = { length2em: function (n) { return t(e.length2em(n)) }, oneem: n, em2length: function (e) { return t(e / n) + "em" }, Em: function (t) { return e.em(t) }, em: r, em2px: o, axis_height: i, strokeWidth: e.length2em("0.04em"), thickness: a, jot: e.length2em("3pt"), objectmargin: e.length2em("3pt"), objectwidth: e.length2em("0pt"), objectheight: e.length2em("0pt"), labelmargin: e.length2em("2.5pt"), turnradius: e.length2em("10pt"), lineElementLength: e.length2em("5pt"), axisHeightLength: i * e.length2em("10pt"), dottedDasharray: n + " " + o(a) } } }, { key: "append", value: function (e, t) { this.adaptor.append(e, t) } }, { key: "remove", value: function (e) { this.adaptor.remove(e) } }, { key: "svg", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : []; return this.adaptor.node(e, t, n, Cn) } }, { key: "setAttribute", value: function (e, t, n, r) { return this.adaptor.setAttribute(e, t, n, r) } }, { key: "setStyle", value: function (e, t, n) { this.adaptor.setStyle(e, t, n) } }, { key: "drawTextObject", value: function (e, t, n) { var r = pe.measure.length2em("0.2em"), i = t.xypicWrapper, a = i.getChildWrapper(e.math), o = a.adaptor, u = a.getBBox(), s = u.scale, c = (u.h + r) * s, h = (u.d + r) * s, l = (u.w + 2 * r) * s, m = (c + h) / 2, p = l / 2, f = e.c; if (e.originalBBox = { H: c, D: h, W: l }, !n) { var d = a.html("mjx-xypic-object"); o.append(i.getElement(), d), o.setStyle(d, "color", t.getCurrentColor()), a.toCHTML(d); var y = t.getOrigin(); o.setAttribute(d, "data-x", f.x - p - y.x + r * s), o.setAttribute(d, "data-y", -f.y - m - y.y + r * s), o.setAttribute(d, "data-xypic-id", e.math.xypicTextObjectId), i.appendTextObject(d) } return f.toRect({ u: m, d: m, l: p, r: p }) } }]), n }(e), r = function (e) { xn(n, e); var t = wn(n); function n(e, r) { var i, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return dn(this, n), (i = t.call(this, e, r, a)).shape = null, i } return vn(n, [{ key: "computeBBox", value: function (e) { e.empty(); var t = this.node.cmd; if (t) { var n = this.length2em("0.2em"); if (null == this.shape) { var r = pe.svgForDebug, i = pe.svgForTestLayout; this._textObjects = [], this.setupMeasure(this); this.adaptor; var a = pe.measure.strokeWidth, o = 1, u = 0, s = 1, c = pe.measure.em2px, h = "black", l = rn.createSVG(this, o, u, s, a, h, { viewBox: [0, -c(o + u), c(s), c(o + u)].join(" "), role: "img", focusable: !1, overflow: "visible" }); pe.svgForDebug = l, pe.svgForTestLayout = l; var m = new Ot, p = new xt(ft.none, m); t.toShape(p); var f = p.shape; this.shape = f, pe.svgForDebug = r, pe.svgForTestLayout = i } var d = this.shape, y = d.getBoundingBox(); void 0 !== y && (y = new rt.Rect(0, 0, { l: Math.max(0, -(y.x - y.l)), r: Math.max(0, y.x + y.r), u: Math.max(0, y.y + y.u), d: Math.max(0, -(y.y - y.d)) }), e.updateFrom(new Ut.bK({ w: y.l + y.r + 2 * n, h: y.u + 2 * n, d: y.d }))) } } }, { key: "kind", get: function () { return Ce.xypic.prototype.kind } }, { key: "_toCHTML", value: function (e) { var t = this.standardCHTMLnode(e); this.cthml = t; var n = this.adaptor, r = this.length2em("0.2em"), i = pe.measure.strokeWidth, a = 1, o = 0, u = 1, s = pe.measure.em2px, c = rn.createSVG(this, a, o, u, i, "black", { viewBox: [0, -s(a + o), s(u), s(a + o)].join(" "), role: "img", focusable: !1, overflow: "visible" }); pe.svgForDebug = c, pe.svgForTestLayout = c, n.append(t, c.svg); var h = this.node.cmd; if (h) { if (null == this.shape) { var l = new Ot, m = new xt(ft.none, l); h.toShape(m); var p = m.shape; this.shape = p } var f = this.shape; f.draw(c); var d = f.getBoundingBox(); if (void 0 !== d) { var y = (d = new rt.Rect(0, 0, { l: Math.max(0, -(d.x - d.l)), r: Math.max(0, d.x + d.r), u: Math.max(0, d.y + d.u), d: Math.max(0, -(d.y - d.d)) })).x - d.l - r, v = -d.y - d.u - r, x = d.l + d.r + 2 * r, g = d.u + d.d + 2 * r; c.setWidth(x), c.setHeight(g), c.setAttribute("viewBox", [s(y), s(v), s(x), s(g)].join(" ")), n.setStyle(t, "vertical-align", kn(-d.d - r + pe.measure.axis_height) + "em"); var w, S = pn(this._textObjects); try { for (S.s(); !(w = S.n()).done;) { var b = w.value, C = parseFloat(n.getAttribute(b, "data-x")), k = parseFloat(n.getAttribute(b, "data-y")); n.setStyle(b, "left", kn(C - y) + "em"), n.setStyle(b, "top", kn(k + d.y - d.d - .5 * r) + "em") } } catch (e) { S.e(e) } finally { S.f() } } else n.remove(c.svg) } else n.remove(c.svg) } }], [{ key: "styles", get: function () { return { "mjx-xypic path": { "stroke-width": "inherit" }, ".MathJax mjx-xypic path": { "stroke-width": "inherit" }, "mjx-xypic-object": { "text-align": "center", position: "absolute" }, "mjx-xypic": { position: "relative" } } } }]), n }(n); t[r.prototype.kind] = r; var i = function (e) { xn(n, e); var t = wn(n); function n(e, r) { var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return dn(this, n), t.call(this, e, r, i) } return vn(n, [{ key: "kind", get: function () { return Ce.xypic.newdir.prototype.kind } }, { key: "_toCHTML", value: function (e) { var t = this.node.cmd; pe.repositories.dirRepository.put(t.dirMain, t.compositeObject) } }]), n }(n); t[i.prototype.kind] = i; var a = function (e) { xn(n, e); var t = wn(n); function n(e, r) { var i, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return dn(this, n), (i = t.call(this, e, r, a))._setupGraphics(), i.computeBBox(i.bbox), i.bboxComputed = !0, i } return vn(n, [{ key: "kind", get: function () { return Ce.xypic.includegraphics.prototype.kind } }, { key: "_setupGraphics", value: function () { this.setupMeasure(this); var e = new Ot, t = new xt(ft.none, e), n = this.node.cmd; if (n.setup(t), !e.includegraphicsWidth.isDefined || !e.includegraphicsHeight.isDefined) throw s("ExecutionError", "the 'width' and 'height' attributes of the \\includegraphics are required."); var r = e.includegraphicsWidth.get, i = e.includegraphicsHeight.get; this.imageWidth = this.length2em(r), this.imageHeight = this.length2em(i), this.filepath = n.filepath } }, { key: "computeBBox", value: function (e) { e.empty(), e.updateFrom(new Ut.bK({ w: this.imageWidth, h: this.imageHeight, d: 0 })) } }, { key: "_toCHTML", value: function (e) { var t = this.standardCHTMLnode(e); this.cthml = t, this.adaptor.setStyle(t, "position", "relative"), this.adaptor.setStyle(t, "vertical-align", "0em"); var n = this.html("img"); this.adaptor.setAttribute(n, "src", this.filepath), this.adaptor.setStyle(n, "width", kn(this.imageWidth) + "em"), this.adaptor.setStyle(n, "height", kn(this.imageHeight) + "em"), this.adaptor.append(t, n) } }]), n }(n); t[a.prototype.kind] = a } void 0 !== Wt.wO && Mn(Wt.wO, Nt.w); var Pn = n(952), Bn = n(84); function On(e) { return On = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) { return typeof e } : function (e) { return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e }, On(e) } function En(e, t) { var n = "undefined" != typeof Symbol && e[Symbol.iterator] || e["@@iterator"]; if (!n) { if (Array.isArray(e) || (n = function (e, t) { if (!e) return; if ("string" == typeof e) return An(e, t); var n = Object.prototype.toString.call(e).slice(8, -1); "Object" === n && e.constructor && (n = e.constructor.name); if ("Map" === n || "Set" === n) return Array.from(e); if ("Arguments" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return An(e, t) }(e)) || t && e && "number" == typeof e.length) { n && (e = n); var r = 0, i = function () { }; return { s: i, n: function () { return r >= e.length ? { done: !0 } : { done: !1, value: e[r++] } }, e: function (e) { throw e }, f: i } } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.") } var a, o = !0, u = !1; return { s: function () { n = n.call(e) }, n: function () { var e = n.next(); return o = e.done, e }, e: function (e) { u = !0, a = e }, f: function () { try { o || null == n.return || n.return() } finally { if (u) throw a } } } } function An(e, t) { (null == t || t > e.length) && (t = e.length); for (var n = 0, r = new Array(t); n < t; n++)r[n] = e[n]; return r } function Ln(e, t) { if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function") } function jn(e, t) { for (var n = 0; n < t.length; n++) { var r = t[n]; r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(e, r.key, r) } } function Dn(e, t, n) { return t && jn(e.prototype, t), n && jn(e, n), e } function Tn(e, t) { if ("function" != typeof t && null !== t) throw new TypeError("Super expression must either be null or a function"); e.prototype = Object.create(t && t.prototype, { constructor: { value: e, writable: !0, configurable: !0 } }), t && Rn(e, t) } function Rn(e, t) { return Rn = Object.setPrototypeOf || function (e, t) { return e.__proto__ = t, e }, Rn(e, t) } function Fn(e) { var t = function () { if ("undefined" == typeof Reflect || !Reflect.construct) return !1; if (Reflect.construct.sham) return !1; if ("function" == typeof Proxy) return !0; try { return Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], (function () { }))), !0 } catch (e) { return !1 } }(); return function () { var n, r = Vn(e); if (t) { var i = Vn(this).constructor; n = Reflect.construct(r, arguments, i) } else n = r.apply(this, arguments); return Gn(this, n) } } function Gn(e, t) { if (t && ("object" === On(t) || "function" == typeof t)) return t; if (void 0 !== t) throw new TypeError("Derived constructors may only return object or undefined"); return function (e) { if (void 0 === e) throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); return e }(e) } function Vn(e) { return Vn = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) { return e.__proto__ || Object.getPrototypeOf(e) }, Vn(e) } var _n = "http://www.w3.org/2000/svg", In = He; function zn(e, t) { var n = function (e) { Tn(n, e); var t = Fn(n); function n(e, r) { var i, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; Ln(this, n), i = t.call(this, e, r, a); for (var o = pe.wrapperOfTextObjectMap, u = r.textMmls, s = i.childNodes, c = u.length, h = 0; h < c; h++) { var l = u[h].xypicTextObjectId; o[l] = s[h] } return i._textObjects = [], i } return Dn(n, [{ key: "getElement", value: function () { return this.svgNode } }, { key: "appendTextObject", value: function (e) { this._textObjects.push(e) } }, { key: "getChildWrapper", value: function (e) { var t = e.xypicTextObjectId; if (null == t) throw s("IllegalStateError", "BUG"); var n = pe.wrapperOfTextObjectMap[t]; if (null == n) throw s("IllegalStateError", "unknown textObjectId:" + t); return n } }, { key: "toSVG", value: function (e) { var t = pe.svgForDebug, n = pe.svgForTestLayout; this._textObjects = [], this.setupMeasure(this), this._toSVG(e), pe.svgForDebug = t, pe.svgForTestLayout = n } }, { key: "setupMeasure", value: function (e) { var t = He, n = e.length2em("1em"), r = parseFloat(e.px(100).replace("px", "")) / 100, i = e.font.params.axis_height, a = e.length2em("0.15em"), o = function (t) { return Math.round(parseFloat(e.px(100 * t).replace("px", ""))) / 100 }; pe.measure = { length2em: function (n) { return t(e.length2em(n)) }, oneem: n, em2length: function (e) { return t(e / n) + "em" }, Em: function (t) { return e.em(t) }, em: r, em2px: o, axis_height: i, strokeWidth: e.length2em("0.04em"), thickness: a, jot: e.length2em("3pt"), objectmargin: e.length2em("3pt"), objectwidth: e.length2em("0pt"), objectheight: e.length2em("0pt"), labelmargin: e.length2em("2.5pt"), turnradius: e.length2em("10pt"), lineElementLength: e.length2em("5pt"), axisHeightLength: i * e.length2em("10pt"), dottedDasharray: n + " " + o(a) } } }, { key: "append", value: function (e, t) { this.adaptor.append(e, t) } }, { key: "remove", value: function (e) { this.adaptor.remove(e) } }, { key: "svg", value: function (e) { var t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {}, n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : []; return this.adaptor.node(e, t, n, _n) } }, { key: "setAttribute", value: function (e, t, n, r) { return this.adaptor.setAttribute(e, t, n, r) } }, { key: "setStyle", value: function (e, t, n) { this.adaptor.setStyle(e, t, n) } }, { key: "drawTextObject", value: function (e, t, n) { var r = pe.measure.length2em("0.2em"), i = t.xypicWrapper, a = i.getChildWrapper(e.math), o = a.adaptor, u = a.getBBox(), s = u.scale, c = (u.h + r) * s, h = (u.d + r) * s, l = (u.w + 2 * r) * s, m = (c + h) / 2, p = l / 2, f = e.c; if (e.originalBBox = { H: c, D: h, W: l }, !n) { var d = a.svg("g"); o.append(i.getElement(), d), o.setAttribute(d, "stroke", t.getCurrentColor()), o.setAttribute(d, "fill", t.getCurrentColor()), a.toSVG(d); var y = t.getOrigin(); o.setAttribute(d, "data-x", f.x - p - y.x + r * s), o.setAttribute(d, "data-y", -f.y + (c - h) / 2 - y.y), o.setAttribute(d, "data-xypic-id", e.math.xypicTextObjectId), i.appendTextObject(d) } return f.toRect({ u: m, d: m, l: p, r: p }) } }]), n }(e), r = function (e) { Tn(n, e); var t = Fn(n); function n(e, r) { var i, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return Ln(this, n), (i = t.call(this, e, r, a)).shape = null, i } return Dn(n, [{ key: "computeBBox", value: function (e) { e.empty(); var t = this.node.cmd; if (t) { var n = this.length2em("0.2em"); if (null == this.shape) { var r = pe.svgForDebug, i = pe.svgForTestLayout; this._textObjects = [], this.setupMeasure(this); this.adaptor; var a = pe.measure.strokeWidth, o = 1, u = 0, s = 1, c = pe.measure.em2px, h = "black", l = rn.createSVG(this, o, u, s, a, h, { viewBox: [0, -c(o + u), c(s), c(o + u)].join(" "), role: "img", focusable: !1, overflow: "visible" }); pe.svgForDebug = l, pe.svgForTestLayout = l; var m = new Ot, p = new xt(ft.none, m); t.toShape(p); var f = p.shape; this.shape = f, pe.svgForDebug = r, pe.svgForTestLayout = i } var d = this.shape, y = d.getBoundingBox(); void 0 !== y && (y = new rt.Rect(0, 0, { l: Math.max(0, -(y.x - y.l)), r: Math.max(0, y.x + y.r), u: Math.max(0, y.y + y.u), d: Math.max(0, -(y.y - y.d)) }), e.updateFrom(new Ut.bK({ w: y.l + y.r + 2 * n, h: y.u + 2 * n, d: y.d }))) } } }, { key: "kind", get: function () { return Ce.xypic.prototype.kind } }, { key: "_toSVG", value: function (e) { var t = this.standardSVGnode(e); this.svgNode = t; var n = this.adaptor, r = this.length2em("0.2em"), i = pe.measure.strokeWidth, a = 1, o = 0, u = 1, s = pe.measure.em2px, c = rn.createSVG(this, a, o, u, i, "black", { viewBox: [0, -s(a + o), s(u), s(a + o)].join(" "), role: "img", focusable: !1, overflow: "visible" }); pe.svgForDebug = c, pe.svgForTestLayout = c, n.append(t, c.drawArea); var h = this.node.cmd; if (h) { if (null == this.shape) { var l = new Ot, m = new xt(ft.none, l); h.toShape(m); var p = m.shape; this.shape = p } var f = this.shape; f.draw(c); var d = f.getBoundingBox(); if (void 0 !== d) { var y = (d = new rt.Rect(0, 0, { l: Math.max(0, -(d.x - d.l)), r: Math.max(0, d.x + d.r), u: Math.max(0, d.y + d.u), d: Math.max(0, -(d.y - d.d)) })).x - d.l - r, v = -d.y - d.u - r, x = d.l + d.r + 2 * r, g = d.u + d.d + 2 * r; c.setWidth(x), c.setHeight(g), c.setAttribute("viewBox", [s(y), s(v), s(x), s(g)].join(" ")); var w = this.fixed(1) / s(1); n.setAttribute(c.drawArea, "transform", "translate(" + this.fixed(-y) + "," + this.fixed(d.y + pe.measure.axis_height) + ") scale(" + w + ", " + -w + ")"); var S, b = En(this._textObjects); try { for (b.s(); !(S = b.n()).done;) { var C = S.value, k = parseFloat(n.getAttribute(C, "data-x")), M = parseFloat(n.getAttribute(C, "data-y")), P = k - y, B = -M + d.y + pe.measure.axis_height; this.place(P, B, C) } } catch (e) { b.e(e) } finally { b.f() } } else n.remove(c.drawArea) } else n.remove(c.drawArea) } }], [{ key: "styles", get: function () { return { 'g[data-mml-node="xypic"] path': { "stroke-width": "inherit" }, '.MathJax g[data-mml-node="xypic"] path': { "stroke-width": "inherit" } } } }]), n }(n); t[r.prototype.kind] = r; var i = function (e) { Tn(n, e); var t = Fn(n); function n(e, r) { var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return Ln(this, n), t.call(this, e, r, i) } return Dn(n, [{ key: "kind", get: function () { return Ce.xypic.newdir.prototype.kind } }, { key: "computeBBox", value: function (e) { var t = this.node.cmd; pe.repositories.dirRepository.put(t.dirMain, t.compositeObject) } }, { key: "_toSVG", value: function (e) { var t = this.node.cmd; pe.repositories.dirRepository.put(t.dirMain, t.compositeObject) } }]), n }(n); t[i.prototype.kind] = i; var a = function (e) { Tn(n, e); var t = Fn(n); function n(e, r) { var i, a = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null; return Ln(this, n), (i = t.call(this, e, r, a))._setupGraphics(), i.computeBBox(i.bbox), i.bboxComputed = !0, i } return Dn(n, [{ key: "kind", get: function () { return Ce.xypic.includegraphics.prototype.kind } }, { key: "_setupGraphics", value: function () { this.setupMeasure(this); var e = new Ot, t = new xt(ft.none, e), n = this.node.cmd; if (n.setup(t), !e.includegraphicsWidth.isDefined || !e.includegraphicsHeight.isDefined) throw s("ExecutionError", "the 'width' and 'height' attributes of the \\includegraphics are required."); var r = e.includegraphicsWidth.get, i = e.includegraphicsHeight.get; this.imageWidth = this.length2em(r), this.imageHeight = this.length2em(i), this.filepath = n.filepath } }, { key: "computeBBox", value: function (e) { e.empty(), e.updateFrom(new Ut.bK({ w: this.imageWidth, h: this.imageHeight, d: 0 })) } }, { key: "_toSVG", value: function (e) { var t = this.standardSVGnode(e); this.svgNode = t; var n = this.fixed(1), r = this.svg("image", { x: "0", y: "0", preserveAspectRatio: "none", width: In(this.imageWidth), height: In(this.imageHeight), transform: "scale(" + n + "," + -n + ") translate(0," + In(-this.imageHeight) + ")" }); this.adaptor.setAttribute(r, "xlink:href", this.filepath, "http://www.w3.org/1999/xlink"), this.adaptor.append(t, r) } }]), n }(n); t[a.prototype.kind] = a } void 0 !== Pn.y && zn(Pn.y, Bn.N); var Qn = MathJax._.components.loader.Loader; Qn && (MathJax._.output.chtml.Wrapper.CHTMLWrapper || Qn.ready("output/chtml").then((function () { var e = MathJax._.output.chtml; Mn(e.Wrapper.CHTMLWrapper, e.Wrappers_ts.CHTMLWrappers) })).catch((function (e) { return console.log("Caught", e) })), MathJax._.output.svg.Wrapper.SVGWrapper || Qn.ready("output/svg").then((function () { var e = MathJax._.output.svg; zn(e.Wrapper.SVGWrapper, e.Wrappers_ts.SVGWrappers) })).catch((function (e) { return console.log("Caught", e) }))) }() }();
